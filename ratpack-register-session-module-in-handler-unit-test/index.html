<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="author" content="Szymon Stepniak"><meta name="robots" content="index, follow"><meta name="monetization" content="$ilp.uphold.com/Jfxe9Qd9z8Mb"><title>Ratpack: register SessionModule in handler unit test</title><meta name="description" content="Unit testing Ratpack handlers has many benefits. In the previous post we have learned how to mock Session object to use it with GroovyRequestFixture. Today instead of mocking we will register Session"><meta property="og:type" content="article"><meta property="og:title" content="Ratpack: register SessionModule in handler unit test"><meta property="og:url" content="https://e.printstacktrace.blog/ratpack-register-session-module-in-handler-unit-test/"><meta property="og:site_name" content="Szymon Stepniak - Freelance Groovy Developer &amp; DevOps"><meta property="og:description" content="Unit testing Ratpack handlers has many benefits. In the previous post we have learned how to mock Session object to use it with GroovyRequestFixture. Today instead of mocking we will register Session"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://e.printstacktrace.blog/images/og/ratpack-session-module.jpg"><meta property="article:published_time" content="2018-06-26T20:55:38.000Z"><meta property="article:modified_time" content="2018-06-26T20:55:38.000Z"><meta property="article:author" content="Szymon Stepniak"><meta property="article:tag" content="groovy"><meta property="article:tag" content="ratpack"><meta property="article:tag" content="spock"><meta property="article:tag" content="unit-test"><meta property="article:tag" content="session"><meta property="article:tag" content="guice"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://e.printstacktrace.blog/images/og/ratpack-session-module.jpg"><meta name="twitter:creator" content="@wololock"><meta name="keywords" content="groovy,ratpack,spock,unit-test,session,guice"><link rel="dns-prefetch" href="//cdnjs.cloudflare.com"><link rel="dns-prefetch" href="//stackpath.bootstrapcdn.com"><link rel="dns-prefetch" href="//disqus.com"><link rel="dns-prefetch" href="//c.disquscdn.com"><link href="//fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;700&amp;display=swap" rel="stylesheet"><link href="//fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&amp;display=swap" rel="stylesheet"><link href="//fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&amp;display=swap" rel="stylesheet"><link href="//fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;0,700;1,400&amp;display=swap" rel="stylesheet"><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous"><link rel="shortcut icon" type="image/png" href="/favicon_new.png"><link rel="stylesheet" href="/css/main.css?v=64"><link rel="stylesheet" href="/css/highlightjs.css?v=64"><link rel="canonical" href="https://e.printstacktrace.blog/ratpack-register-session-module-in-handler-unit-test/"><script type="application/ld+json">{"@context":"https://schema.org","@graph":[{"@type":["Person","Organization"],"@id":"https://e.printstacktrace.blog/#/schema/person/wololock","name":"Szymon Stepniak","description":"Groovista, Upwork's Top Rated freelancer, Toruń Java User Group founder, open&nbsp;source contributor, Stack Overflow addict, bedroom guitar player. I walk through e.printStackTrace() so you don't have to.","image":{"@type":"ImageObject","@id":"https://e.printstacktrace.blog/#avatar","inLanguage":"en-US","url":"https://www.gravatar.com/avatar/b22c1842c6e8f7f2b9b3ed8c0d4efb4d?s=200","caption":"Szymon Stepniak"},"logo":{"@id":"https://e.printstacktrace.blog/#avatar"},"sameAs":["https://twitter.com/wololock","https://github.com/wololock","https://stackoverflow.com/users/2194470/szymon-stepniak","https://www.youtube.com/c/eprintstacktrace"]},{"@type":"WebSite","@id":"https://e.printstacktrace.blog/#website","url":"https://e.printstacktrace.blog","name":"Szymon Stepniak - Freelance Groovy Developer & DevOps","description":"Blog about programming, created by Upwork's Top Rated freelancer, 10+ years experienced Java/Groovy developer. Contact me if you are looking for an experienced and high quality consultant."},{"@type":"WebPage","@id":"https://e.printstacktrace.blog/ratpack-register-session-module-in-handler-unit-test/#webpage","url":"https://e.printstacktrace.blog/ratpack-register-session-module-in-handler-unit-test/","name":"Ratpack: register SessionModule in handler unit test","isPartOf":{"@id":"https://e.printstacktrace.blog/#website"},"datePublished":"2018-06-26T20:55:38.000Z","dateModified":"2018-06-26T20:55:38.000Z","description":"\nUnit testing Ratpack handlers has many benefits. In the previous post we have learned how to mock Session object\nto use it with GroovyRequestFixture. Today instead of mocking\nwe will register SessionModule and then we will use a real session object.\n","inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://e.printstacktrace.blog/ratpack-register-session-module-in-handler-unit-test/"]}]},{"@type":"Article","@id":"https://e.printstacktrace.blog/ratpack-register-session-module-in-handler-unit-test/#article","isPartOf":{"@id":"https://e.printstacktrace.blog/ratpack-register-session-module-in-handler-unit-test/#webpage"},"author":{"@id":"https://e.printstacktrace.blog/#/schema/person/wololock"},"headline":"Ratpack: register SessionModule in handler unit test","datePublished":"2018-06-26T20:55:38.000Z","dateModified":"2018-06-26T20:55:38.000Z","mainEntityOfPage":{"@id":"https://e.printstacktrace.blog/ratpack-register-session-module-in-handler-unit-test/#webpage"},"publisher":{"@id":"https://e.printstacktrace.blog/#/schema/person/wololock"},"keywords":"groovy,ratpack,spock,unit-test,session,guice","image":{"@type":"ImageObject","@id":"https://e.printstacktrace.blog/ratpack-register-session-module-in-handler-unit-test/#primaryimage","url":"https://e.printstacktrace.blog/images/og/ratpack-session-module.jpg","inLanguage":"en-US","caption":"Ratpack: register SessionModule in handler unit test"},"inLanguage":"en-US"},{"@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https://e.printstacktrace.blog","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@id":"https://e.printstacktrace.blog/ratpack-cookbook/","name":"Ratpack Cookbook"}},{"@type":"ListItem","position":3,"item":{"@id":"https://e.printstacktrace.blog/ratpack-register-session-module-in-handler-unit-test/","name":"Ratpack: register SessionModule in handler unit test"}}]}]}</script><meta name="generator" content="Hexo 5.1.1"><link rel="alternate" href="/atom.xml" title="Szymon Stepniak - Freelance Groovy Developer & DevOps" type="application/atom+xml">
<style>.img-lazyload-container{overflow:hidden;max-width:100%}.img-lazyload-container img{max-width:100%;display:block;height:auto;transition:opacity .5s ease-in-out}.img-lazyload-container img:not([src]){height:0;opacity:0}</style></head><body class="layout-post"><header class="fixed-top" id="header"><div class="container-fluid px-md-auto px-0"><nav class="navbar navbar-expand-lg"><h3 class="logo mr-auto position-relative">e.printstacktrace.blog<a class="stretched-link gatr" href="/" data-type="logo" data-name="e.printstacktrace.blog"></a></h3><button class="navbar-toggler" data-toggle="collapse" data-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="mainNav"><ul class="navbar-nav ml-lg-auto text-center text-md-left d-block d-lg-flex"><li class="nav-item"><a class="nav-link" href="/">Start here</a></li><li class="nav-item"><a class="nav-link" href="/about">About</a></li><li class="nav-item"><a class="nav-link" href="/support-me">Support the blog</a></li><li class="nav-item"><a class="nav-link" href="/archives">Archives</a></li><li class="nav-item"><a class="nav-link" href="/resources">Resources</a></li><li class="nav-item d-inline-block d-lg-block mx-2 mx-lg-0"><a class="nav-link gatr" target="_blank" rel="noopener" href="https://twitter.com/wololock" data-type="social" data-name="Twitter"><em class="fa fa-twitter"></em></a></li><li class="nav-item d-inline-block d-lg-block mx-2 mx-lg-0"><a class="nav-link gatr" target="_blank" rel="noopener" href="https://github.com/wololock" data-type="social" data-name="GitHub"><em class="fa fa-github"></em></a></li><li class="nav-item d-inline-block d-lg-block mx-2 mx-lg-0"><a class="nav-link gatr" target="_blank" rel="noopener" href="https://stackoverflow.com/users/2194470/szymon-stepniak" data-type="social" data-name="Stack Overflow"><em class="fa fa-stack-overflow"></em></a></li><li class="nav-item d-inline-block d-lg-block mx-2 mx-lg-0"><a class="nav-link gatr" target="_blank" rel="noopener" href="https://youtube.com/c/eprintstacktrace" data-type="social" data-name="YouTube"><em class="fa fa-youtube"></em></a></li></ul></div></nav></div></header><main id="page-post"><header class="jumbotron text-center pb-5" style="background-image:url(/images/ratpack-cookbook-bg.jpg)"><div class="mask"></div><div class="container pt-5 pb-1"><a class="category mark" href="/ratpack-cookbook/">Ratpack Cookbook</a><h1 class="mt-2 mt-md-0">Ratpack: register SessionModule in handler unit test</h1><section class="post-meta"><ul><li><time datetime="2018-06-26T20:55:38.000Z">Jun 26, 2018</time></li><li>7 min. read</li><li><a href="https://e.printstacktrace.blog/ratpack-register-session-module-in-handler-unit-test/#disqus_thread">0 Comments</a></li></ul></section></div></header><article class="post-content" role="article"><div class="container"><div class="row"><div class="col-12 offset-0 col-md-10 offset-md-1 pt-4 pt-md-5"><div class="paragraph"><p>Unit testing Ratpack handlers has many benefits. In the previous post we have learned how to <a href="/ratpack-mocking-Session-object-in-GroovyRequestFixture-test/" title="mock Session object">mock Session object</a> to use it with <a target="_blank" rel="noopener" href="https://ratpack.io/manual/1.5.4/api/ratpack/groovy/test/handling/GroovyRequestFixture.html"><code>GroovyRequestFixture</code></a>. Today instead of mocking we will register <code>SessionModule</code> and then we will use a real session object.</p></div><a id="more"></a><div class="paragraph"><p>Let&#8217;s say we have a handler that uses a session object and we want to unit test this handler using <code>GroovyRequestFixture</code> to avoid booting up the application. Our handler under test class looks like this:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">class HandlerUnderTest implements Handler &#123;

    @Override
    void handle(Context ctx) throws Exception &#123;
        ctx.get(Session).get('foo').map &#123; Optional&lt;String&gt; o -&gt;
            o.orElse(null)
        &#125;.flatMap &#123; value -&gt;
            Promise.value(value)
        &#125;.then &#123; foo -&gt;
            ctx.render(json([foo: foo]))
        &#125;
    &#125;
&#125;</code></pre></div></div><div class="paragraph"><p>Nothing fancy - we retrieve value with key <code>foo</code> from session object and we return a simple JSON object like:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">&#123;"foo": "here is foo value"&#125;</code></pre></div></div><div class="paragraph"><p><code>GroovyRequestFixture</code> class has a method called <code>handle(chainAction, closure)</code> that expects two parameters:</p></div><div class="ulist"><ul><li><p><code>Action&lt;? super Chain&gt; chainAction</code>, a handler chain builder class that allows us to create a chain containing our handler under test class,</p></li><li><p><code>Closure&lt;?&gt; closure</code>, a closure with request fixture specification.</p></li></ul></div><div class="paragraph"><p>Let&#8217;s begin with defining <code>GroovyChainAction</code> object that implements <code>Action&lt;Chain&gt;</code> that we can use later on.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">import ratpack.exec.Promise
import ratpack.groovy.handling.GroovyChainAction
import ratpack.handling.Context
import ratpack.handling.Handler
import ratpack.session.Session
import spock.lang.Specification
import spock.lang.Subject

import static ratpack.jackson.Jackson.json

class RetrieveFooValueFromSessionSpec extends Specification &#123;

    @Subject
    final GroovyChainAction handlerChainAction = new GroovyChainAction() &#123;
        @Override
        void execute() throws Exception &#123;
            get(new HandlerUnderTest())
        &#125;
    &#125;

    static class HandlerUnderTest implements Handler &#123;

        @Override
        void handle(Context ctx) throws Exception &#123;
            ctx.get(Session).get('foo').map &#123; Optional&lt;String&gt; o -&gt;
                o.orElse(null)
            &#125;.flatMap &#123; value -&gt;
                Promise.value(value)
            &#125;.then &#123; foo -&gt;
                ctx.render(json([foo: foo]))
            &#125;
        &#125;
    &#125;
&#125;</code></pre></div></div><div class="paragraph"><p>The definition of <code>handlerChainAction</code> object says that there is a handler for <code>GET</code> request sent without any path and this handler is our <code>HandlerUnderTest</code>. No single test case so far, let&#8217;s add one:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">import ratpack.exec.Promise
import ratpack.groovy.handling.GroovyChainAction
import ratpack.groovy.test.handling.GroovyRequestFixture
import ratpack.handling.Context
import ratpack.handling.Handler
import ratpack.http.Status
import ratpack.jackson.internal.DefaultJsonRender
import ratpack.session.Session
import spock.lang.Specification
import spock.lang.Subject

import static ratpack.jackson.Jackson.json

class RetrieveFooValueFromSessionSpec extends Specification &#123;

    @Subject
    final GroovyChainAction handlerChainAction = new GroovyChainAction() &#123;
        @Override
        void execute() throws Exception &#123;
            get(new HandlerUnderTest())
        &#125;
    &#125;

    def "should retrieve value for foo key from Session"() &#123;
        given:
        def result = GroovyRequestFixture.handle(handlerChainAction) &#123;
            method 'GET'
        &#125;

        expect:
        result.status == Status.OK

        and:
        result.rendered(DefaultJsonRender).object == [foo: 'Foo value is 42']
    &#125;

    static class HandlerUnderTest implements Handler &#123;

        @Override
        void handle(Context ctx) throws Exception &#123;
            ctx.get(Session).get('foo').map &#123; Optional&lt;String&gt; o -&gt;
                o.orElse(null)
            &#125;.flatMap &#123; value -&gt;
                Promise.value(value)
            &#125;.then &#123; foo -&gt;
                ctx.render(json([foo: foo]))
            &#125;
        &#125;
    &#125;
&#125;</code></pre></div></div><div class="paragraph"><p>Now our specification class contains first test case scenario - in this test we expect that calling <code>GET</code> request on predefined <code>handlerChainAction</code> returns a map object like:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">[foo: 'Foo value is 42']</code></pre></div></div><div class="paragraph"><p>Let&#8217;s see what happens if we run this test:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">ratpack.test.handling.UnexpectedHandlerException: ratpack.registry.NotInRegistryException: No object for type 'ratpack.session.Session' in registry

    at ratpack.test.handling.internal.DefaultHandlingResult.rendered(DefaultHandlingResult.java:263)
    at RetrieveFooValueFromSessionSpec.should retrieve value for foo key from Session(RetrieveFooValueFromSessionSpec.groovy:34)
Caused by: ratpack.registry.NotInRegistryException: No object for type 'ratpack.session.Session' in registry
    at ratpack.registry.Registry.get(Registry.java:136)
    at ratpack.handling.internal.DefaultContext.get(DefaultContext.java:375)
    at ratpack.registry.Registry.get(Registry.java:120)
    at RetrieveFooValueFromSessionSpec$HandlerUnderTest.handle(RetrieveFooValueFromSessionSpec.groovy:41)
    at ratpack.handling.internal.DefaultContext.next(DefaultContext.java:157)
    ....</code></pre></div></div><div class="paragraph"><p>This exception is pretty straightforward - there is no session object available in the registry. In this test specification we want to avoid mocking session object and use the real one provided with <code>SessionModule</code> instead. To make it happened we need to register <code>SessionModule</code> using Guice registry. Luckily <code>GroovyChainAction</code> class has a method called <code>register(Registry registry)</code> that allows us to override existing registry. Here we will use <code>Guice.registry(Action&lt;? super BindingsSpec&gt; bindings)</code> method that returns <code>Function&lt;Registry, Registry&gt;</code>:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">static final Function&lt;Registry, Registry&gt; guiceRegistry = Guice.registry &#123; bindings -&gt;
    bindings.module(new SessionModule())
&#125;</code></pre></div></div><div class="paragraph"><p>This <code>guiceRegistry</code> function will return a Guice registry with <code>SessionModule</code> bind correctly. The next step is to call this <code>GroovyChainAction.register(guiceRegistry.apply(registry))</code> method inside <code>execute()</code> method we override for this test. The updated specification class looks like this:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">import ratpack.exec.Promise
import ratpack.func.Function
import ratpack.groovy.handling.GroovyChainAction
import ratpack.groovy.test.handling.GroovyRequestFixture
import ratpack.guice.Guice
import ratpack.handling.Context
import ratpack.handling.Handler
import ratpack.http.Status
import ratpack.jackson.internal.DefaultJsonRender
import ratpack.registry.Registry
import ratpack.session.Session
import ratpack.session.SessionModule
import spock.lang.Specification
import spock.lang.Subject

import static ratpack.jackson.Jackson.json

class RetrieveFooValueFromSessionSpec extends Specification &#123;

    static final Function&lt;Registry, Registry&gt; guiceRegistry = Guice.registry &#123; bindings -&gt;
        bindings.module(new SessionModule())
    &#125;

    @Subject
    final GroovyChainAction handlerChainAction = new GroovyChainAction() &#123;
        @Override
        void execute() throws Exception &#123;
            register(guiceRegistry.apply(registry))

            get(new HandlerUnderTest())
        &#125;
    &#125;

    def "should retrieve value for foo key from Session"() &#123;
        given:
        def result = GroovyRequestFixture.handle(handlerChainAction) &#123;
            method 'GET'
        &#125;

        expect:
        result.status == Status.OK

        and:
        result.rendered(DefaultJsonRender).object == [foo: 'Foo value is 42']
    &#125;

    static class HandlerUnderTest implements Handler &#123;

        @Override
        void handle(Context ctx) throws Exception &#123;
            ctx.get(Session).get('foo').map &#123; Optional&lt;String&gt; o -&gt;
                o.orElse(null)
            &#125;.flatMap &#123; value -&gt;
                Promise.value(value)
            &#125;.then &#123; foo -&gt;
                ctx.render(json([foo: foo]))
            &#125;
        &#125;
    &#125;
&#125;</code></pre></div></div><div class="paragraph"><p>Let&#8217;s run the test and see what happens:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">Condition not satisfied:

result.rendered(DefaultJsonRender).object == [foo: 'Foo value is 42']
|      |                           |      |
|      |                           |      false
|      |                           [foo:null]
|      ratpack.jackson.internal.DefaultJsonRender@9f6e406
ratpack.test.handling.internal.DefaultHandlingResult@400d912a

Expected :foo: Foo value is 42

Actual   :foo: null</code></pre></div></div><div class="paragraph"><p>Great! <code>SessionModule</code> gets bind correctly, there is no <code>No object for type 'ratpack.session.Session' in registry</code> exception anymore. To finalize this specification we need to satisfy the expectation. For purpose of this test we will add <code>all()</code> handler to the <code>GroovyChainAction</code> and in this handler we will initialize value in session for key <code>foo</code>.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content"><h4>The <code>all()</code> handler</h4><div class="paragraph"><p>This handler is useful in some scenarios - when it&#8217;s added at the top of the chain it inspects every incoming request. It&#8217;s important to remember that if we want to keep chain continuing we have to call <code>next()</code> method that instructs Ratpack that this handler does not terminate request processing and it has to continue. Otherwise request handling ends up inside <code>all()</code> handler.</p></div></td></tr></table></div><div class="paragraph"><p>The simplest <code>all()</code> handler that sets value for session key`foo` may look like this:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">all &#123; Session session -&gt;
    session.set('foo', 'Foo value is 42').then &#123;
        next()
    &#125;
&#125;</code></pre></div></div><div class="paragraph"><p>It&#8217;s important to call <code>next()</code> inside <code>then()</code> operation to let Ratpack&#8217;s execution model does its job. Otherwise the next handler may start processing before session object stores value for <code>foo</code> key.</p></div><div class="paragraph"><p>And here is what the full working specification looks like:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">import ratpack.exec.Promise
import ratpack.func.Function
import ratpack.groovy.handling.GroovyChainAction
import ratpack.groovy.test.handling.GroovyRequestFixture
import ratpack.guice.Guice
import ratpack.handling.Context
import ratpack.handling.Handler
import ratpack.http.Status
import ratpack.jackson.internal.DefaultJsonRender
import ratpack.registry.Registry
import ratpack.session.Session
import ratpack.session.SessionModule
import spock.lang.Specification
import spock.lang.Subject

import static ratpack.jackson.Jackson.json

class RetrieveFooValueFromSessionSpec extends Specification &#123;

    static final Function&lt;Registry, Registry&gt; guiceRegistry = Guice.registry &#123; bindings -&gt;
        bindings.module(new SessionModule())
    &#125;

    @Subject
    final GroovyChainAction handlerChainAction = new GroovyChainAction() &#123;
        @Override
        void execute() throws Exception &#123;
            register(guiceRegistry.apply(registry))

            all &#123; Session session -&gt;
                session.set('foo', 'Foo value is 42').then &#123;
                    next()
                &#125;
            &#125;

            get(new HandlerUnderTest())
        &#125;
    &#125;

    def "should retrieve value for foo key from Session"() &#123;
        given:
        def result = GroovyRequestFixture.handle(handlerChainAction) &#123;
            method 'GET'
        &#125;

        expect:
        result.status == Status.OK

        and:
        result.rendered(DefaultJsonRender).object == [foo: 'Foo value is 42']
    &#125;

    static class HandlerUnderTest implements Handler &#123;

        @Override
        void handle(Context ctx) throws Exception &#123;
            ctx.get(Session).get('foo').map &#123; Optional&lt;String&gt; o -&gt;
                o.orElse(null)
            &#125;.flatMap &#123; value -&gt;
                Promise.value(value)
            &#125;.then &#123; foo -&gt;
                ctx.render(json([foo: foo]))
            &#125;
        &#125;
    &#125;
&#125;</code></pre></div></div><div class="paragraph"><p>This final specification passes as we expect:</p></div><div class="paragraph"><p></p><div class="img-lazyload-container" style="width:1265px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==);background-repeat:no-repeat;background-position:center"><img data-original="/images/ratpack-session-test-passed.png" height="205" width="1265" style="padding-top:16.205533596837945%"></div><p></p></div><h2 id="thank-you" class="discrete">Thank you!</h2><div class="paragraph"><p>Thank you so much for reading up to this point! I hope this article met your expectations, and you have learned something valuable from it. If you have one more minute, leave me a comment below, please. This way, I can thank you for your time more in person.</p></div><div class="paragraph"><p>And last but not least. If you find this blog post valuable, help me spread the word, please. You can share it on <span class="icon color-twitter"><i class="fa fa-twitter"></i></span> <a href="https://twitter.com/intent/tweet?text=%22Ratpack:%20register%20SessionModule%20in%20handler%20unit%20test%22%20https://e.printstacktrace.blog/ratpack-register-session-module-in-handler-unit-test/%20via%20@wololock" target="_blank" rel="noopener">Twitter</a>, <span class="icon color-linkedin"><i class="fa fa-linkedin-square"></i></span> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://e.printstacktrace.blog/ratpack-register-session-module-in-handler-unit-test/&title=Ratpack:%20register%20SessionModule%20in%20handler%20unit%20test" target="_blank" rel="noopener">LinkedIn</a>, or anywhere else you can think of. This single tweet or post on social media helps a lot. One more time - thank you so much! <strong>You&#8217;re awesome!</strong> <span class="icon color-red"><i class="fa fa-heart"></i></span></p></div><div class="paragraph"><p><em>(PS: Check "Related posts" below for more content like this one.)</em></p></div></div><div class="col-12 offset-0 col-md-10 offset-md-1"><div class="post-tags"><ul><li class="text"><em class="far fa-calendar-alt mr-1"></em>Published: Jun 26, 2018 in <a class="mark" href="/ratpack-cookbook/">Ratpack Cookbook</a></li></ul><ul class="mt-2"><li class="text"><em class="fas fa-tags"></em></li><li><a href="/t/groovy/">groovy</a></li><li><a href="/t/guice/">guice</a></li><li><a href="/t/ratpack/">ratpack</a></li><li><a href="/t/session/">session</a></li><li><a href="/t/spock/">spock</a></li><li><a href="/t/unit-test/">unit-test</a></li></ul></div></div></div></div><footer class="post-footer"><div class="container"><div class="row"><div class="col-12 offset-0 col-md-10 offset-md-1"><div class="about-author"><div class="row"><div class="col-md-2 col-6 offset-md-0 offset-3 text-center mt-4"><img class="rounded-circle img-fluid" src="https://www.gravatar.com/avatar/b22c1842c6e8f7f2b9b3ed8c0d4efb4d?s=200"></div><div class="col-md-10 col-12 text-md-left text-center mt-md-4 mt-1"><h4 class="text-md-left text-center"><a class="gatr" href="/about" data-type="post-footer" data-name="About">Szymon Stepniak</a></h4><p class="bio"><span>Groovista, Upwork's Top Rated freelancer, Toruń Java User Group founder, open&nbsp;source contributor, Stack Overflow addict, bedroom guitar player. I walk through e.printStackTrace() so you don't have to.</span><span class="ml-2"><a href="/about">More about me &raquo;</a></span></p><ul class="social-links text-md-left text-center"><li><a class="gatr" target="_blank" rel="noopener" href="https://twitter.com/wololock" onclick="return window.open(this.href),!1" data-type="post-footer" data-name="twitter"><span class="fa fa-twitter"></span></a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://github.com/wololock" onclick="return window.open(this.href),!1" data-type="post-footer" data-name="github"><span class="fa fa-github"></span></a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://stackoverflow.com/users/2194470/szymon-stepniak?tab=profile" onclick="return window.open(this.href),!1" data-type="post-footer" data-name="stackoverflow"><span class="fa fa-stack-overflow"></span></a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://www.youtube.com/c/eprintstacktrace" onclick="return window.open(this.href),!1" data-type="post-footer" data-name="youtube"><span class="fa fa-youtube"></span></a></li></ul></div></div></div></div></div><div class="row mt-lg-2 mt-3 h6 pager"><div class="col-lg-6 col-12 text-lg-left text-center py-3"><a class="gatr" href="/ratpack-mocking-Session-object-in-GroovyRequestFixture-test/" data-type="prev-post" data-name="Ratpack: mocking Session object in GroovyRequestFixture test" title="Ratpack: mocking Session object in GroovyRequestFixture test">&laquo; Previous: <b>Ratpack: mocking Session object in GroovyRequestFixture test</b></a></div><div class="col-lg-6 col-12 text-lg-right text-center py-3"><a class="gatr" href="/groovy-split-string-and-avoid-getting-index-out-of-bounds-exception/" data-type="next-post" data-name="Groovy: split string and avoid getting IndexOutOfBoundsException" title="Groovy: split string and avoid getting IndexOutOfBoundsException">Next: <b>Groovy: split string and avoid getting IndexOutOfBoundsException</b> &raquo;</a></div></div></div></footer></article></main><section class="related-posts"><div class="container"><h3>Related posts</h3><div class="card-deck pt-2"><article class="card shadow-sm"><div class="card-header" style="background-image:url(/images/og/ratpack-mocking-session.jpg)"><div class="mask"></div><h3 class="h5 text-left font-weight-bold text-white"><div><a class="category">Ratpack Cookbook</a></div><div class="title">Ratpack: mocking Session object in GroovyRequestFixture test</div></h3></div><div class="card-body"><section class="post-meta"><ul><li><time datetime="2018-06-24T09:59:57.000Z">Jun 24, 2018</time></li><li>2 min. read</li><li><a href="https://e.printstacktrace.blog/ratpack-mocking-Session-object-in-GroovyRequestFixture-test/#disqus_thread">0 Comments</a></li></ul></section><p class="card-text pt-3">Ratpack allows you unit test handlers using GroovyRequestFixture class. The good thing about this approach is that it does not require running the whole application and you can quickly test if the handler does what you expect. However, if you retrieve objects from Raptack&#8217;s registry you ...</p></div><a class="stretched-link gatr" href="/ratpack-mocking-Session-object-in-GroovyRequestFixture-test/" data-type="related" data-name="Ratpack: mocking Session object in GroovyRequestFixture test"></a></article><article class="card shadow-sm"><div class="card-header" style="background-image:url(/images/cards/groovy-01.jpg)"><div class="mask"></div><h3 class="h5 text-left font-weight-bold text-white"><div><a class="category">Groovy Cookbook</a></div><div class="title">Spock random order of tests - how to?</div></h3></div><div class="card-body"><section class="post-meta"><ul><li><time datetime="2019-04-06T08:52:11.000Z">Apr 6, 2019</time></li><li>5 min. read</li><li><a href="https://e.printstacktrace.blog/spock-random-order-of-tests-how-to/#disqus_thread">0 Comments</a></li></ul></section><p class="card-text pt-3">Spock Framework executes test methods (features) in a single class (specification) in the declaration order. There is nothing wrong in this default behavior - we should write tests with their isolation in mind. However, in some cases, we would like to randomize test methods execution. Today we ...</p></div><a class="stretched-link gatr" href="/spock-random-order-of-tests-how-to/" data-type="related" data-name="Spock random order of tests - how to?"></a></article><article class="card shadow-sm"><div class="card-header" style="background-image:url(/images/og/gr8conf.jpg)"><div class="mask"></div><h3 class="h5 text-left font-weight-bold text-white"><div><a class="category">Conferences</a></div><div class="title">GR8Conf EU 2019 Recap</div></h3></div><div class="card-body"><section class="post-meta"><ul><li><time datetime="2019-06-06T10:03:44.000Z">Jun 6, 2019</time></li><li>9 min. read</li><li><a href="https://e.printstacktrace.blog/gr8conf-eu-2019-recap/#disqus_thread">0 Comments</a></li></ul></section><p class="card-text pt-3">It&#8217;s been a week since GR8Conf EU 2019 is over, so it is the right time to write some recap of this outstanding event. It was my first time at GR8Conf, both as a speaker and an attendee. I spent an awesome six days in the beautiful city of Copenhagen, and I brought a lot of good memories ...</p></div><a class="stretched-link gatr" href="/gr8conf-eu-2019-recap/" data-type="related" data-name="GR8Conf EU 2019 Recap"></a></article></div></div><div class="col-12 text-center mt-5 serif"><h5 class="h3"><span class="small d-block mb-2">More posts from</span><span class="font-weight-bold mark">Ratpack Cookbook</span></h5><div><em class="fas fa-angle-down"></em></div><a class="stretched-link" href="/ratpack-cookbook/"></a></div></section><div class="container py-5"><div class="disqus-comments"><div class="alert alert-info small"><em class="fa fa-info-circle"></em> Want to paste code in the comment and make the formatting look good? Read this - <a target="_blank" rel="noopener" href="https://help.disqus.com/en/articles/1717236-syntax-highlighting"><b>Syntax highlighting</b></a>.</div><div class="comments"><div id="disqus_thread"><div id="disqus_empty" style="display:none">Empty</div></div></div><div class="text-center pt-4"><a class="gatr" target="_blank" rel="noopener" href="https://www.jdoqocy.com/click-100191173-10952823" data-type="grammarly-comments" data-name="Grammar Check"><img class="d-none d-lg-inline" src="/images/yml/grammarly-comments-banner.png" width="728" height="90" alt="Grammar Check " border="0"><img class="d-inline d-lg-none" src="/images/yml/grammarly-square.png" alt="Grammar Check " border="0"></a></div></div><script>function load_disqus(e){var t=document.getElementById("disqus_empty");if(document.contains(t)){var d=document.getElementById("disqus_thread"),n=document.createElement("script"),s=document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0];d&&t&&(t.remove(),n.type="text/javascript",n.async=!0,n.src="//"+e+".disqus.com/embed.js",s.appendChild(n))}}window.addEventListener("scroll",function(e){document.scrollingElement.scrollTop>document.getElementById("disqus_thread").offsetTop-500&&load_disqus("eprintstacktrace")},!1)</script></div><script>var _a={},_b={id:"learn-anything-jjkw2",src:"/images/yml/learn-anything-float.jpg",url:"https://click.linksynergy.com/fs-bin/click?id=uow2LCEuhvQ&offerid=507388.1628&subid=0&type=4",name:"Learn Anything Floating"},udemy={id:_a.id||_b.id,src:_a.src||_b.src,url:_a.url||_b.url,name:_a.name||_b.name}</script><footer class="page-footer"><section class="links"><div class="container"><div class="row"><div class="col-12 col-md-2"><h5 class="text-md-left text-center">Useful links</h5><ul class="text-md-left text-center mb-md-0 mb-5"><li><a class="gatr" href="/" data-type="footer-useful-links" data-name="Start here">Start here</a></li><li><a class="gatr" href="/about" data-type="footer-useful-links" data-name="About">About</a></li><li><a class="gatr" href="/archives" data-type="footer-useful-links" data-name="Archives">Archives</a></li><li><a class="gatr" href="/resources" data-type="footer-useful-links" data-name="Resources">Resources</a></li><li><a class="gatr" href="/privacy-policy" data-type="footer-useful-links" data-name="Privacy Policy">Privacy Policy</a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://teespring.com/stores/eprintstacktrace" data-type="footer-useful-links" data-name="Merchandise">Merchandise</a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://kit.co/wololock" data-type="footer-useful-links" data-name="My Kit">My Kit</a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://feeds.feedburner.com/Eprintstacktracenet" data-type="footer-useful-links" data-name="RSS">RSS</a></li><li><a class="gatr" href="/support-me" data-type="footer-useful-links" data-name="Support me">Support the blog <em class="fas fa-heart color-red ml-2"></em></a></li></ul></div><div class="col-12 col-md-3"><h5 class="text-md-left text-center">Popular categories</h5><ul class="text-md-left text-center mb-md-0 mb-5"><li><a class="gatr" href="/groovy-cookbook/" data-type="footer-category" data-name="Groovy Cookbook">Groovy Cookbook<span class="count ml-2">28</span></a></li><li><a class="gatr" href="/jenkins-pipeline-cookbook/" data-type="footer-category" data-name="Jenkins Pipeline Cookbook">Jenkins Pipeline Cookbook<span class="count ml-2">8</span></a></li><li><a class="gatr" href="/programmers-bookshelf/" data-type="footer-category" data-name="Programmer's Bookshelf">Programmer's Bookshelf<span class="count ml-2">6</span></a></li><li><a class="gatr" href="/micronaut-cookbook/" data-type="footer-category" data-name="Micronaut Cookbook">Micronaut Cookbook<span class="count ml-2">4</span></a></li><li><a class="gatr" href="/ratpack-cookbook/" data-type="footer-category" data-name="Ratpack Cookbook">Ratpack Cookbook<span class="count ml-2">4</span></a></li><li><a class="gatr" href="/learning-java/" data-type="footer-category" data-name="Learning Java">Learning Java<span class="count ml-2">4</span></a></li><li><a class="gatr" href="/how-to/" data-type="footer-category" data-name="How to">How to<span class="count ml-2">3</span></a></li><li><a class="gatr" href="/blog-reports/" data-type="footer-category" data-name="Blog Reports">Blog Reports<span class="count ml-2">2</span></a></li><li><a class="gatr" href="/conferences/" data-type="footer-category" data-name="Conferences">Conferences<span class="count ml-2">2</span></a></li></ul></div><div class="col-12 col-md-4 text-center"><h5 class="text-md-left text-center">Latest posts</h5><ul class="text-md-left text-center mb-md-0 mb-5"><li><a class="gatr" href="/groovy-ecosystem-usage-report-2020/" data-type="footer-latest-posts" data-name="Groovy Ecosystem Usage Report (2020)">Groovy Ecosystem Usage Report (2020)</a></li><li><a class="gatr" href="/how-to-convert-json-to-csv-from-the-command-line/" data-type="footer-latest-posts" data-name="How to convert JSON to CSV from the command-line?">How to convert JSON to CSV from the command-line?</a></li><li><a class="gatr" href="/5-common-jenkins-pipeline-mistakes/" data-type="footer-latest-posts" data-name="5 Common Jenkins Pipeline Mistakes">5 Common Jenkins Pipeline Mistakes</a></li><li><a class="gatr" href="/how-to-merge-two-maps-in-groovy/" data-type="footer-latest-posts" data-name="How to merge two maps in Groovy?">How to merge two maps in Groovy?</a></li><li><a class="gatr" href="/building-stackoverflow-cli-with-java-11-micronaut-picocli-and-graalvm/" data-type="footer-latest-posts" data-name="Building stackoverflow-cli with Java 11, Micronaut, Picocli, and GraalVM">Building stackoverflow-cli with Java 11, Micronaut, Picocli, and GraalVM</a></li><li><a class="gatr" href="/how-to-catch-curl-response-in-jenkins-pipeline/" data-type="footer-latest-posts" data-name="How to catch curl response in Jenkins Pipeline?">How to catch curl response in Jenkins Pipeline?</a></li><li><a class="gatr" href="/atomic-habits-book-review/" data-type="footer-latest-posts" data-name="Atomic Habits - book review">Atomic Habits - book review</a></li></ul></div><div class="col-12 col-md-3 text-center"><a class="gatr" target="_blank" rel="noopener" href="https://amzn.to/2ZdC8ib" data-type="banner" data-name="Audible Free Trial"><img class="img-fluid" src="/images/yml/audible-free-trial.jpg"></a></div></div></div></section><section class="bottom"><div class="container"><ul class="text-center py-2"><li class="d-inline-block mb-md-0 mb-2">Designed by <a class="gatr" target="_blank" rel="noopener" href="https://twitter.com/wololock" data-type="footer" data-name="designed">@wololock</a></li><li class="d-inline-block mb-md-0 mb-2">Created with <a class="gatr" target="_blank" rel="noopener" href="https://hexo.io" data-type="footer" data-name="hexo">Hexo</a></li><li class="d-inline-block mb-md-0 mb-2">Hosted on <a class="gatr" target="_blank" rel="noopener" href="https://github.com/wololock/wololock.github.io" data-type="footer" data-name="github">GitHub</a></li><li class="d-inline-block mb-md-0 mb-2">Deployed with <a class="gatr" target="_blank" rel="noopener" href="https://circleci.com/gh/wololock/wololock.github.io" data-type="footer" data-name="circleci">Circle CI</a></li><li class="d-inline-block mb-md-0 mb-2">License <a class="gatr" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" data-type="footer" data-name="license">CC BY-NC-SA 4.0</a></li><li class="d-inline-block mb-md-0 mb-2"><a class="gatr" target="_blank" rel="noopener" href="https://github.com/wololock/wololock.github.io/commits/develop" data-type="footer" data-name="last-commit"><img src="https://badgen.net/github/last-commit/wololock/wololock.github.io?color=blue&amp;scale=0.8"></a></li></ul></div></section></footer><script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script><script async src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script><script async src="https://kit.fontawesome.com/25fc8ffdd1.js" crossorigin="anonymous"></script><script async id="cookiebanner" src="//cdnjs.cloudflare.com/ajax/libs/cookie-banner/1.2.2/cookiebanner.min.js" data-moreinfo="/privacy-policy/" data-message="This blog uses cookies to enhance your experience. By continuing to visit it you agree to its use of cookies." data-link="#ffad33" data-font-family="Lora,serif" data-font-size="15px" data-bg="#444"></script><script src="/js/highlight.pack.js?v=9.18.1"></script><script>hljs.initHighlightingOnLoad()</script><script async src="/js/main.js?v=9"></script><script async id="dsq-count-scr" src="//eprintstacktrace.disqus.com/count.js"></script><script>!function(a,e,t,n,c,g,o){a.GoogleAnalyticsObject=c,a.ga=a.ga||function(){(a.ga.q=a.ga.q||[]).push(arguments)},a.ga.l=1*new Date,g=e.createElement(t),o=e.getElementsByTagName(t)[0],g.async=1,g.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(g,o)}(window,document,"script",0,"ga"),ga("create","UA-42400890-5","auto"),ga("send","pageview"),jQuery(document).on("click","a.gatr",function(){var a=jQuery(this),e=a.attr("data-type"),t=a.attr("data-name");return ga("send","event",e,"click",t),!0})</script><script>!function(){"use strict";function r(e){var t=e.getAttribute("data-original"),n=new Image;n.onload=function(){e.setAttribute("src",t),e.style.paddingTop=""},n.src=t}document.addEventListener("DOMContentLoaded",function(){var t,e,n,i=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));i.length&&("undefined"!=typeof IntersectionObserver?(t=new IntersectionObserver(function(e,t){e.filter(function(e){return e.isIntersecting}).forEach(function(e){r(e.target),t.unobserve(e.target)})}),i.forEach(function(e){t.observe(e)})):(n=function(){clearTimeout(e),e=setTimeout(function(){return(i=i.filter(function(e){return!e.src})).length?void i.filter(function(e){e.getBoundingClientRect().top<window.innerHeight&&r(e)}):(window.removeEventListener("scroll",n),void window.removeEventListener("resize",n))},100)},window.addEventListener("scroll",n),window.addEventListener("resize",n),n()))},!1)}();</script></body></html>