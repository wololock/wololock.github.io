<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="robots" content="all"><meta name="ir-site-verification-token" value="626123791"><title>Groovy Trampoline Closure - a step into recursive closures</title><meta name="keywords" content="jmh,groovy,benchmark,recursion,closures,tail-recursive"><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel="dns-prefetch" href="//cdnjs.cloudflare.com"><link rel="dns-prefetch" href="//stackpath.bootstrapcdn.com"><link rel="shortcut icon" type="image/png" href="/favicon_new.png"><link rel="canonical" href="https://e.printstacktrace.blog/groovy-trampoline-closure-a-step-into-recursive-closures/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro:wght@400;500;700|Poppins:300,400,400i,700|Montserrat:400,600,700|Roboto:300,400,400i,700|Lora:400,400i,700,700i&amp;display=swap"><link rel="stylesheet" href="//stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous"><link rel="stylesheet" href="/css/main.css?v=71"><link rel="stylesheet" href="/css/highlight.css?v=71"><meta name="description" content="A few weeks ago an interesting question was asked on the StackOverflow. Someone experimented with a recursion in Groovy and stepped into Closure.trampoline() [1]. It quickly turned out that using Tra"><meta property="og:type" content="article"><meta property="og:title" content="Groovy Trampoline Closure - a step into recursive closures"><meta property="og:url" content="https://e.printstacktrace.blog/groovy-trampoline-closure-a-step-into-recursive-closures/"><meta property="og:site_name" content="e.printstacktrace.blog - I help you become a better software developer."><meta property="og:description" content="A few weeks ago an interesting question was asked on the StackOverflow. Someone experimented with a recursion in Groovy and stepped into Closure.trampoline() [1]. It quickly turned out that using Tra"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://e.printstacktrace.blog/images/cards/27.png"><meta property="article:published_time" content="2019-06-25T11:54:04.000Z"><meta property="article:modified_time" content="2019-06-25T11:54:04.000Z"><meta property="article:author" content="Szymon Stepniak"><meta property="article:tag" content="jmh"><meta property="article:tag" content="groovy"><meta property="article:tag" content="benchmark"><meta property="article:tag" content="recursion"><meta property="article:tag" content="closures"><meta property="article:tag" content="tail-recursive"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://e.printstacktrace.blog/images/cards/27.png"><meta name="twitter:creator" content="@wololock"><script type="application/ld+json">{"@context":"https://schema.org","@graph":[{"@type":["Person","Organization"],"@id":"https://e.printstacktrace.blog/#/schema/person/wololock","name":"Szymon Stepniak","description":"I help you become a better software developer.","image":{"@type":"ImageObject","@id":"https://e.printstacktrace.blog/#avatar","inLanguage":"en-US","url":"https://www.gravatar.com/avatar/b22c1842c6e8f7f2b9b3ed8c0d4efb4d?s=200","caption":"Szymon Stepniak"},"logo":{"@id":"https://e.printstacktrace.blog/#avatar"},"sameAs":["https://twitter.com/wololock","https://github.com/wololock","https://stackoverflow.com/users/2194470/szymon-stepniak","https://www.youtube.com/c/eprintstacktrace"]},{"@type":"WebSite","@id":"https://e.printstacktrace.blog/#website","url":"https://e.printstacktrace.blog","name":"e.printstacktrace.blog - I help you become a better software developer.","description":"Blog about programming, created by Upwork's Top Rated freelancer, 10+ years experienced Java/Groovy developer. Contact me if you are looking for an experienced and high quality consultant."},{"@type":"WebPage","@id":"https://e.printstacktrace.blog/groovy-trampoline-closure-a-step-into-recursive-closures/#webpage","url":"https://e.printstacktrace.blog/groovy-trampoline-closure-a-step-into-recursive-closures/","name":"Groovy Trampoline Closure - a step into recursive closures","isPartOf":{"@id":"https://e.printstacktrace.blog/#website"},"datePublished":"2019-06-25T11:54:04.000Z","dateModified":"2019-06-25T11:54:04.000Z","description":"\nA few weeks ago an interesting question was asked on the StackOverflow.\nSomeone experimented with a recursion in Groovy and stepped into Closure.trampoline() [1].\nIt quickly turned out that using TrampolineClosure makes a recursive execution slower.\nIs this a valid behavior, or do we do something wrong?\n","inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://e.printstacktrace.blog/groovy-trampoline-closure-a-step-into-recursive-closures/"]}]},{"@type":"Article","@id":"https://e.printstacktrace.blog/groovy-trampoline-closure-a-step-into-recursive-closures/#article","isPartOf":{"@id":"https://e.printstacktrace.blog/groovy-trampoline-closure-a-step-into-recursive-closures/#webpage"},"author":{"@id":"https://e.printstacktrace.blog/#/schema/person/wololock"},"headline":"Groovy Trampoline Closure - a step into recursive closures","datePublished":"2019-06-25T11:54:04.000Z","dateModified":"2019-06-25T11:54:04.000Z","mainEntityOfPage":{"@id":"https://e.printstacktrace.blog/groovy-trampoline-closure-a-step-into-recursive-closures/#webpage"},"publisher":{"@id":"https://e.printstacktrace.blog/#/schema/person/wololock"},"keywords":"jmh,groovy,benchmark,recursion,closures,tail-recursive","image":{"@type":"ImageObject","@id":"https://e.printstacktrace.blog/groovy-trampoline-closure-a-step-into-recursive-closures/#primaryimage","url":"https://e.printstacktrace.blog/images/cards/27.png","inLanguage":"en-US","caption":"Groovy Trampoline Closure - a step into recursive closures"},"inLanguage":"en-US"},{"@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://e.printstacktrace.blog"},{"@type":"ListItem","position":2,"name":"Groovy Cookbook","item":"https://e.printstacktrace.blog/groovy-cookbook/"},{"@type":"ListItem","position":3,"name":"Groovy Trampoline Closure - a step into recursive closures"}]}]}</script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="e.printstacktrace.blog - I help you become a better software developer." type="application/atom+xml">
<style>.img-lazyload-container{overflow:hidden;max-width:100%}.img-lazyload-container img{max-width:100%;display:block;height:auto;transition:opacity .5s ease-in-out}.img-lazyload-container img:not([src]){height:0;opacity:0}</style></head><body><header class="fixed-top" id="header"><div class="container"><nav class="navbar navbar-light mx-0 px-0 justify-content-start"><a class="gatr" href="/" data-type="nav" data-name="Home">Home</a><a class="gatr" href="/about" data-type="nav" data-name="About">About</a><a class="gatr" href="/archives" data-type="nav" data-name="Archives">Archives</a><a class="gatr" href="/resources" data-type="nav" data-name="Tools &amp; Resources">Tools & Resources</a><a class="gatr" href="/support-me" data-type="nav" data-name="Support me">Support me</a></nav></div></header><main id="main"><section class="sidebar-enabled" id="content"><div class="container"><div class="row"><div class="col-lg-3 bg-primary sidebar pt-5 d-flex align-items-start flex-column order-1 pr-lg-0"><div class="mb-auto"><div class="text-center pt-lg-5 pl-3"><a href="/about"><img class="rounded-circle mb-4" src="https://www.gravatar.com/avatar/b22c1842c6e8f7f2b9b3ed8c0d4efb4d?s=200" height="96"></a><h5>Hi! üëã I'm Szymon</h5><p class="small">I help you become a better software developer.</p></div><div class="my-4 pl-2 text-lg-right text-center"><ul class="social-media"><li><a class="gatr" target="_blank" rel="noopener" href="https://twitter.com/wololock" data-type="social-media" data-name="Twitter" title="Twitter"><i class="fa fa-twitter"></i><span class="number">1.13k</span><span class="description">Followers</span></a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://www.youtube.com/eprintstacktrace" data-type="social-media" data-name="YouTube" title="YouTube"><i class="fa fa-youtube"></i><span class="number">2.08k</span><span class="description">Subscribers</span></a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://github.com/wololock" data-type="social-media" data-name="Github" title="Github"><i class="fa fa-github"></i><span class="number">103</span><span class="description">Followers</span></a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://stackoverflow.com/users/2194470/szymon-stepniak" data-type="social-media" data-name="StackOverflow" title="StackOverflow"><i class="fa fa-stack-overflow"></i><span class="number">29.6k</span><span class="description">Reputation</span></a></li></ul></div><div class="pl-4 mt-lg-5 pt-lg-2"><h4 class="h4 pt-4 mb-4 sans-serif">Latest posts from the <span class="h3 font-weight-bold">Groovy Cookbook</span></h4><div class="media align-items-center pb-1 mb-3"><a class="d-block gatr" href="/groovy-ecosystem-usage-report-2020/" data-type="latest-sidebar" data-name="Groovy Ecosystem Usage Report (2020)"><img class="rounded" src="/images/icons/3.png" width="64"></a><div class="media-body pl-2 ml-1"><h5 class="m-0 small" style="font-size:14px;font-weight:600;line-height:22px"><a class="sans-serif gatr" href="/groovy-ecosystem-usage-report-2020/" data-type="latest-sidebar" data-name="Groovy Ecosystem Usage Report (2020)">Groovy Ecosystem Usage Report (2020)</a></h5></div></div><div class="media align-items-center pb-1 mb-3"><a class="d-block gatr" href="/how-to-merge-two-maps-in-groovy/" data-type="latest-sidebar" data-name="How to merge two maps in Groovy?"><img class="rounded" src="/images/icons/28.png" width="64"></a><div class="media-body pl-2 ml-1"><h5 class="m-0 small" style="font-size:14px;font-weight:600;line-height:22px"><a class="sans-serif gatr" href="/how-to-merge-two-maps-in-groovy/" data-type="latest-sidebar" data-name="How to merge two maps in Groovy?">How to merge two maps in Groovy?</a></h5></div></div><div class="media align-items-center pb-1 mb-3"><a class="d-block gatr" href="/groovy-dynamic-maps-generic-type-erasure-and-raw-types/" data-type="latest-sidebar" data-name="Groovy dynamic Maps, generic type erasure, and raw types - an interesting use case to learn from"><img class="rounded" src="/images/icons/15.png" width="64"></a><div class="media-body pl-2 ml-1"><h5 class="m-0 small" style="font-size:14px;font-weight:600;line-height:22px"><a class="sans-serif gatr" href="/groovy-dynamic-maps-generic-type-erasure-and-raw-types/" data-type="latest-sidebar" data-name="Groovy dynamic Maps, generic type erasure, and raw types - an interesting use case to learn from">Groovy dynamic Maps, generic type erasure, and raw types - an...</a></h5></div></div><div class="media align-items-center pb-1 mb-3"><a class="d-block gatr" href="/groovy-3-nullcheck-annotation-less-code-and-less-npe/" data-type="latest-sidebar" data-name="Groovy 3 @NullCheck annotation - less code and less NPE"><img class="rounded" src="/images/icons/6.png" width="64"></a><div class="media-body pl-2 ml-1"><h5 class="m-0 small" style="font-size:14px;font-weight:600;line-height:22px"><a class="sans-serif gatr" href="/groovy-3-nullcheck-annotation-less-code-and-less-npe/" data-type="latest-sidebar" data-name="Groovy 3 @NullCheck annotation - less code and less NPE">Groovy 3 @NullCheck annotation - less code and less NPE</a></h5></div></div><div class="media align-items-center pb-1 mb-3"><a class="d-block gatr" href="/groovy-3-string-gdk-improvements-takeright-takebetween-and-a-few-others/" data-type="latest-sidebar" data-name="Groovy 3 String GDK improvements - takeRight, takeBetween, and a few others"><img class="rounded" src="/images/icons/12.png" width="64"></a><div class="media-body pl-2 ml-1"><h5 class="m-0 small" style="font-size:14px;font-weight:600;line-height:22px"><a class="sans-serif gatr" href="/groovy-3-string-gdk-improvements-takeright-takebetween-and-a-few-others/" data-type="latest-sidebar" data-name="Groovy 3 String GDK improvements - takeRight, takeBetween, and a few others">Groovy 3 String GDK improvements - takeRight, takeBetween, an...</a></h5></div></div><div class="media align-items-center pb-1 mb-3"><a class="d-block gatr" href="/groovy-string-methods-that-will-make-your-life-groovier/" data-type="latest-sidebar" data-name="Three Groovy String methods that will make your life Groovier!"><img class="rounded" src="/images/icons/6.png" width="64"></a><div class="media-body pl-2 ml-1"><h5 class="m-0 small" style="font-size:14px;font-weight:600;line-height:22px"><a class="sans-serif gatr" href="/groovy-string-methods-that-will-make-your-life-groovier/" data-type="latest-sidebar" data-name="Three Groovy String methods that will make your life Groovier!">Three Groovy String methods that will make your life Groovier!</a></h5></div></div><div class="media align-items-center pb-1 mb-3"><a class="d-block gatr" href="/quicksort-in-groovy-can-it-be-as-fast-as-implemented-in-java/" data-type="latest-sidebar" data-name="Quicksort in Groovy - can it be as fast as implemented in Java?"><img class="rounded" src="/images/icons/41.png" width="64"></a><div class="media-body pl-2 ml-1"><h5 class="m-0 small" style="font-size:14px;font-weight:600;line-height:22px"><a class="sans-serif gatr" href="/quicksort-in-groovy-can-it-be-as-fast-as-implemented-in-java/" data-type="latest-sidebar" data-name="Quicksort in Groovy - can it be as fast as implemented in Java?">Quicksort in Groovy - can it be as fast as implemented in Java?</a></h5></div></div><div class="text-center"><a class="view-all" href="/groovy-cookbook/" data-type="latest-sidebar" data-name="More &amp;raquo;"><span class="d-block m-0">More</span><i class="fas fa-chevron-down d-block m-0"></i></a></div></div><div class="pl-4 mt-5"><h4 class="mb-3">Popular categories</h4><ul class="list-unstyled"><li class="my-1"><a class="gatr" href="/groovy-cookbook/" data-type="sidebar-category" data-name="Groovy Cookbook">Groovy Cookbook<span class="count ml-2 mark">28</span></a></li><li class="my-1"><a class="gatr" href="/jenkins-pipeline-cookbook/" data-type="sidebar-category" data-name="Jenkins Pipeline Cookbook">Jenkins Pipeline Cookbook<span class="count ml-2 mark">9</span></a></li><li class="my-1"><a class="gatr" href="/programmers-bookshelf/" data-type="sidebar-category" data-name="Programmer's Bookshelf">Programmer's Bookshelf<span class="count ml-2 mark">6</span></a></li><li class="my-1"><a class="gatr" href="/micronaut-cookbook/" data-type="sidebar-category" data-name="Micronaut Cookbook">Micronaut Cookbook<span class="count ml-2 mark">4</span></a></li><li class="my-1"><a class="gatr" href="/ratpack-cookbook/" data-type="sidebar-category" data-name="Ratpack Cookbook">Ratpack Cookbook<span class="count ml-2 mark">4</span></a></li><li class="my-1"><a class="gatr" href="/learning-java/" data-type="sidebar-category" data-name="Learning Java">Learning Java<span class="count ml-2 mark">4</span></a></li><li class="my-1"><a class="gatr" href="/jq-cookbook/" data-type="sidebar-category" data-name="jq cookbook">jq cookbook<span class="count ml-2 mark">3</span></a></li><li class="my-1"><a class="gatr" href="/how-to/" data-type="sidebar-category" data-name="How to">How to<span class="count ml-2 mark">3</span></a></li><li class="my-1"><a class="gatr" href="/blog-reports/" data-type="sidebar-category" data-name="Blog Reports">Blog Reports<span class="count ml-2 mark">2</span></a></li></ul></div><div class="text-center"><div class="d-none d-lg-inline-block mb-5 pt-5"><a class="gatr" href="https://e.printstacktrace.blog/bluehost" data-type="banner" data-name="bluehost-02" target="_blank"><img class="img-fluid" data-lazy="/images/yml/bluehost-02.png"></a></div><div class="d-inline-block d-lg-none py-3"><a class="gatr" href="https://e.printstacktrace.blog/bluehost" data-type="banner" data-name="bluehost-01" target="_blank"><img class="img-fluid" data-lazy="/images/yml/bluehost-01.png"></a></div></div></div><div class="spread-the-love pt-4 mt-lg-5"><div class="mb-lg-5 pb-5 pl-lg-4"><h3 class="mb-3">Don't miss anything - join my newsletter</h3><p class="text-justify">Additional materials and updates for subscribers. <b>No spam guaranteed</b>.<br>Unsubscribe at any time.</p><div id="ck-5bc70426c4-box"></div><script>function load_newsletter(e){var t=document.getElementById("ck-5bc70426c4-box");if(document.contains(t)){var n=t.parentElement;t.remove();var o=document.createElement("script");o.type="text/javascript",o.async=!0,o.src="https://tremendous-motivator-1432.ck.page/"+e+"/index.js",o.setAttribute("data-uid",e),n.appendChild(o),console.log("Convertkit "+e+" loaded.")}}window.addEventListener("scroll",function(e){var t=document.scrollingElement.scrollTop,n=document.getElementById("ck-5bc70426c4-box");document.contains(n)&&t>n.getBoundingClientRect().top- -500&&load_newsletter("5bc70426c4")})</script></div><div class="pl-lg-3 text-lg-left text-center"><p class="m-0 serif">Did you like this article?</p><h5 class="text-uppercase">Spread the <i class="fa fa-heart"></i>!</h5><ul class="mb-5"><li><a class="gatr" target="_blank" rel="noopener" href="https://twitter.com/intent/tweet?text=Groovy Trampoline Closure - a step into recursive closures https://e.printstacktrace.blog/groovy-trampoline-closure-a-step-into-recursive-closures/ via @wololock" data-type="share" data-name="Shared on Twitter"><i class="fa fa-twitter"></i></a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://www.linkedin.com/shareArticle?url=https://e.printstacktrace.blog/groovy-trampoline-closure-a-step-into-recursive-closures/" data-type="share" data-name="Shared on LinkedIn"><i class="fa fa-linkedin"></i></a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://www.facebook.com/sharer.php?u=https://e.printstacktrace.blog/groovy-trampoline-closure-a-step-into-recursive-closures/" data-type="share" data-name="Shared on Facebook"><i class="fa fa-facebook-square"></i></a></li><li><a class="gatr" target="_blank" rel="noopener" href="http://www.reddit.com/submit?url=https://e.printstacktrace.blog/groovy-trampoline-closure-a-step-into-recursive-closures/&amp;title=Groovy Trampoline Closure - a step into recursive closures" data-type="share" data-name="Shared on Reddit"><i class="fa fa-reddit"></i></a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/button/?url=https://e.printstacktrace.blog/groovy-trampoline-closure-a-step-into-recursive-closures/&amp;media=https://e.printstacktrace.blog/images/cards/27.png&amp;description=Groovy Trampoline Closure - a step into recursive closures" data-type="share" data-name="Shared on Pinterest"><i class="fa fa-pinterest"></i></a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://ko-fi.com/eprintstacktrace" data-type="share" data-name="Clicked on Ko-Fi">‚òïÔ∏è</a></li></ul></div></div></div><div class="col-lg-9 py-5 order-0"><div class="pr-lg-4 px-1 pt-lg-5"><nav aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a class="gatr" href="/" data-type="breadcrumb" data-name="/">e.printstacktrace.blog</a></li><li class="breadcrumb-item"><a class="gatr" href="/groovy-cookbook/" data-type="breadcrumb" data-name="Groovy Cookbook">Groovy Cookbook</a></li></ol></nav><article class="post-body"><h1>Groovy Trampoline Closure - a step into recursive closures</h1><div class="post-meta mb-4"><ul><li><time datetime="2019-06-25T11:54:04.000Z">June 25, 2019</time></li><li>10 min. read</li><li><a href="https://e.printstacktrace.blog/groovy-trampoline-closure-a-step-into-recursive-closures/#disqus_thread">0 Comments</a></li></ul></div><div class="content"><div class="paragraph"><p>A few weeks ago an interesting question was <a target="_blank" rel="noopener" href="https://stackoverflow.com/q/56578937/2194470">asked on the StackOverflow</a>. Someone experimented with a recursion in Groovy and stepped into <code>Closure.trampoline()</code> <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>. It quickly turned out that using <code>TrampolineClosure</code> makes a recursive execution slower. Is this a valid behavior, or do we do something wrong?</p></div><a id="more"></a><div class="sect1"><h2 id="why-closure-trampoline">Why <code>Closure.trampoline()</code>?</h2><div class="sectionbody"><div class="paragraph"><p>Recursive algorithms in Groovy (or Java in general) are quite tricky. Every recursive call adds a frame to the call stack. If we make too many recursive calls, we can hit the call stack limit and cause <code>StackOverflowError</code>. We used to use recursive method calls, but the same problem applies to recursive closure calls. Consider the following example.</p></div><div class="listingblock"><div class="title">Listing 1. Recursive factorial function defined as a closure</div><div class="content"><pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">def factorial
factorial = &#123; n, acc = 1G -&gt; 1 &gt;= n ? acc : factorial(n - 1, acc * n ) &#125; <i class="conum" data-value="1"></i><b>(1)</b>

assert factorial(13) == 6227020800</code></pre></div></div><div class="paragraph"><p>In this simple Groovy snippet we define a recursive closure call <em class="conum" data-value="1"></em> to compute the factorial of a given number. This recursive closure allows me to compute factorial of <code>706</code>, but it hits the <code>StackOverflowError</code> for any number starting from <code>707</code>.</p></div><div class="paragraph"><p>This is where <code>TrampolineClosure</code> comes with a help.</p></div><div class="quoteblock source-quote"><blockquote><div class="paragraph"><p>Closures are wrapped in a <code>TrampolineClosure</code>. Upon calling, a trampolined <code>Closure</code> will call the original <code>Closure</code> waiting for its result. If the outcome of the call is another instance of a <code>TrampolineClosure</code>, created perhaps as a result to a call to the <code>trampoline()</code> method, the <code>Closure</code> will again be invoked. This repetitive invocation of returned trampolined <code>Closures</code> instances will continue until a value other than a trampolined <code>Closure</code> is returned. That value will become the final result of the trampoline. That way, calls are made serially, rather than filling the stack.</p><hr>Source: <a target="_blank" rel="noopener" href="http://groovy-lang.org/closures.html#_trampoline" class="bare">http://groovy-lang.org/closures.html#_trampoline</a><p></p></div></blockquote></div><div class="paragraph"><p>The above example refactored to the trampoline version may look like this:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">def factorial
factorial = &#123; n, acc = 1G -&gt; 1 &gt;= n ? acc : factorial.trampoline(n - 1, acc * n ) &#125;.trampoline()

assert factorial(13) == 6227020800</code></pre></div></div><div class="paragraph"><p>The <code>TrampolineClosure</code> makes all recursive calls serial, so in this case computing factorial of numbers larger than <code>707</code> is doable.</p></div></div></div><div class="sect1"><h2 id="the-performance">The performance</h2><div class="sectionbody"><div class="paragraph"><p>What about the performance? Running a quick JMH benchmark shows that:</p></div><div class="ulist"><ul><li><p>computing <code>factorial(500)</code> without the trampoline takes <strong>0.111 ms</strong> (in average) on my computer</p></li><li><p>computing <code>factorial(500)</code> with the trampoline takes <strong>0.196 ms</strong> (in average) on my computer</p></li></ul></div><div class="paragraph"><p>For a single call the difference is not huge. However, in the question asked on the StackOverflow we had to deal with a slightly different scenario. The person who asked this question compared the execution time of computing factorial 100,000 times for a pseudo-random number between 0 and 39.</p></div><div class="admonitionblock important"><table><tr><td class="icon"><i class="fa icon-important" title="Important"></i></td><td class="content"><strong>REMEMBER:</strong> The numbers below are just data. To gain reusable insights, you need to follow up on why the numbers are the way they are. Use profilers (see -prof, -lprof), design factorial experiments, perform baseline and negative tests that provide experimental control, make sure the benchmarking environment is safe on JVM/OS/HW level, ask for reviews from the domain experts. Do not assume the numbers tell you what you want them to tell.</td></tr></table></div></div></div><div class="sect1"><h2 id="the-benchmark">The benchmark</h2><div class="sectionbody"><div class="paragraph"><p>I created a benchmark that simulates a very similar scenario. In this test we benchmark the execution of calculating factorial 100,000 time using pseudo-random numbers from range <code>&lt;30,34&gt;</code>. This way we can eliminate anomalies (e.g. calculating <code>factorial(0)</code> or <code>factorial(1)</code>) and prevent JIT compiler from inlining method call with fixed argument.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">You can clone the JMH benchmark test source code from: <span class="icon"><i class="fa fa-github"></i></span> <a target="_blank" rel="noopener" href="https://github.com/wololock/groovy-closure-trampoline-example">wololock/groovy-closure-trampoline-example</a></td></tr></table></div><div class="paragraph"><p>The benchmark tests the following scenarios:</p></div><div class="ulist"><ul><li><p>calculating factorial using recursive closure call,</p></li><li><p>calculating factorial using recursive trampoline closure call,</p></li><li><p>calculating factorial using tail recursive method.</p></li></ul></div><div class="paragraph"><p>Each scenario is tested in the dynamic and statically compiled variant.</p></div><div class="listingblock"><div class="title">Listing 2. JMH benchmark test of a factorial function defined with closures</div><div class="content"><pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">package bench

import groovy.transform.CompileStatic
import groovy.transform.TailRecursive
import org.openjdk.jmh.annotations.Benchmark
import org.openjdk.jmh.annotations.Scope
import org.openjdk.jmh.annotations.State

@State(Scope.Benchmark)
class FactorialBench &#123;

    static final Random random = new Random()
    static final int limit = 100000

    @Benchmark
    void a_standard() &#123;
        def factorial
        factorial = &#123; n, acc = 1G -&gt; 1 &gt;= n ? acc : factorial(n - 1, acc * n ) &#125;

        for (int i = 0; i &lt; limit; i++) &#123;
            factorial(30 + random.nextInt(5))
        &#125;
    &#125;

    @Benchmark
    @CompileStatic
    void a_standard_sc() &#123;
        Closure factorial
        factorial = &#123; int n, acc = 1G -&gt; 1 &gt;= n ? acc : factorial(n - 1, ((BigInteger) acc) * BigInteger.valueOf((long) n)) &#125;

        for (int i = 0; i &lt; limit; i++) &#123;
            factorial(30 + random.nextInt(5))
        &#125;
    &#125;

    @Benchmark
    void b_trampoline() &#123;
        def factorial
        factorial = &#123; n, acc = 1G -&gt; 1 &gt;= n ? acc : factorial.trampoline(n - 1, acc * n ) &#125;.trampoline()

        for (int i = 0; i &lt; limit; i++) &#123;
            factorial(30 + random.nextInt(5))
        &#125;
    &#125;

    @Benchmark
    @CompileStatic
    void b_trampoline_sc() &#123;
        Closure factorial
        factorial = &#123; int n, acc = 1G -&gt; 1 &gt;= n ? acc : factorial.trampoline(n - 1, ((BigInteger) acc) * BigInteger.valueOf((long) n)) &#125;.trampoline()

        for (int i = 0; i &lt; limit; i++) &#123;
            factorial(30 + random.nextInt(5))
        &#125;
    &#125;

    @Benchmark
    void c_tailRecursive() &#123;
        for (int i = 0; i &lt; limit; i++) &#123;
            factorialTailRecursive(30 + random.nextInt(5))
        &#125;
    &#125;

    @Benchmark
    @CompileStatic
    void c_tailRecursive_sc() &#123;
        for (int i = 0; i &lt; limit; i++) &#123;
            factorialTailRecursiveSC(30 + random.nextInt(5))
        &#125;
    &#125;


    @TailRecursive
    static factorialTailRecursive(n, acc = 1G) &#123;
        1 &gt;= n ? acc : factorialTailRecursive(n - 1, n * acc)
    &#125;

    @TailRecursive
    @CompileStatic
    static BigInteger factorialTailRecursiveSC(int n, BigInteger acc = 1G) &#123;
        1 &gt;= n ? acc : factorialTailRecursiveSC(n - 1, acc * BigInteger.valueOf((long) n))
    &#125;
&#125;</code></pre></div></div><div class="paragraph"><p>I use JMH Gradle plugin, so executing the following benchmark looks like this:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ ./gradlew clean jmh --no-daemon</code></pre></div></div></div></div><div class="sect1"><h2 id="the-results">The results</h2><div class="sectionbody"><div class="paragraph"><p>The execution of all benchmark scenarios takes about 8-9 minutes. I run it twice for Groovy 2.5.7 and for Groovy 3.0.0-beta-1 just to check if the upcoming version 3 introduces any performance improvements.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">Laptop specs: JDK 1.8.0_201 (Java HotSpot&#8482; 64-Bit Server VM, 25.201-b09), Groovy 2.5.7, Intel&#174; Core&#8482; i7-4900MQ CPU @ 2.80GHz (4 cores, cache size 8192 KB), 16 GB RAM, OS: Fedora 29 (64 bit)</td></tr></table></div><div class="sect2"><h3 id="1-standard-recursive-closure">1) Standard recursive closure</h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">Benchmark                                 Mode  Cnt     Score   Error  Units
FactorialBench.a_standard                 avgt   42   472,114 ¬± 1,315  ms/op
FactorialBench.a_standard_sc              avgt   42   428,717 ¬± 1,063  ms/op</code></pre></div></div><div class="paragraph"><p>This is our starting point. We can see that running statically compiled code is approximately <strong>9%</strong>&nbsp;faster.</p></div><div class="paragraph"><p>And here is the <code>stack</code> profiler output.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">....[Thread state: RUNNABLE]........................................................................
 43,6%  43,6% org.codehaus.groovy.runtime.metaclass.ClosureMetaClass.pickClosureMethod
 21,6%  21,6% sun.reflect.DelegatingMethodAccessorImpl.invoke
 21,2%  21,2% org.codehaus.groovy.runtime.callsite.PojoMetaMethodSite$PojoCachedMethodSiteNoUnwrap.invoke
  5,5%   5,6% groovy.lang.MetaMethod.doMethodInvoke
  3,6%   3,6% groovy.lang.MetaClassImpl.invokeMethod
  3,1%   3,1% sun.reflect.GeneratedMethodAccessor2.invoke
  0,4%   0,4% java.math.BigInteger.multiply
  0,3%   0,3% org.codehaus.groovy.runtime.ArrayUtil.createArray
  0,2%   0,2% java.util.Arrays.copyOf
  0,2%   0,2% java.util.Arrays.copyOfRange
  0,4%   0,4% &lt;other&gt;</code></pre></div></div></div><div class="sect2"><h3 id="2-trampoline-closure">2) Trampoline closure</h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">Benchmark                                 Mode  Cnt     Score   Error  Units
FactorialBench.b_trampoline               avgt   42  1054,703 ¬± 3,805  ms/op
FactorialBench.b_trampoline_sc            avgt   42   683,293 ¬± 2,191  ms/op</code></pre></div></div><div class="paragraph"><p>The benchmark test shows that the (dynamic) trampoline variant of the factorial function is about <strong>2.23 times</strong> slower compared to the standard recursive closure approach.</p></div><div class="paragraph"><p>Here is the <code>stack</code> profiler output for the trampoline closure variant:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">....[Thread state: RUNNABLE]........................................................................
 22,6%  22,6% org.codehaus.groovy.reflection.ParameterTypes.isValidMethod
 21,8%  21,8% org.codehaus.groovy.reflection.ParameterTypes.coerceArgumentsToClasses
 15,5%  15,5% org.codehaus.groovy.reflection.ParameterTypes.correctArguments
 11,5%  11,5% groovy.lang.Closure.&lt;init&gt;
  9,4%   9,4% sun.reflect.DelegatingMethodAccessorImpl.invoke
  8,5%   8,5% groovy.lang.TrampolineClosure.&lt;init&gt;
  7,1%   7,1% org.codehaus.groovy.runtime.metaclass.ClosureMetaClass.pickClosureMethod
  0,4%   0,4% groovy.lang.MetaClassImpl.invokeMethod
  0,3%   0,3% org.codehaus.groovy.runtime.callsite.PojoMetaMethodSite$PojoCachedMethodSiteNoUnwrap.invoke
  0,3%   0,3% java.math.BigInteger.multiply
  2,6%   2,6% &lt;other&gt;</code></pre></div></div><div class="paragraph"><p>There are two major differences between trampoline and the standard recursive closure:</p></div><div class="ulist"><ul><li><p>Creating <code>TrampolineClosure</code> objects for each recursive call comes with a cost. In this specific case it took <strong>210.8 ms</strong> (20% of the total time).</p></li><li><p>Calling <code>Closure.trampoline(args)</code> requires arguments coercion, which takes <strong>~393 ms</strong> (37.3% of the total time).</p></li></ul></div><div class="paragraph"><p>Static compilation helps a bit - it executes in <strong>683.293 ms</strong> average time. If we take a look at the call stack from the profiler, we see that static compilation removed the need of the arguments coercion. The main additional cost comes with the <code>TrampolineClosure</code> objects creation - it takes <strong>185.172 ms</strong> (27,1% of the total time).</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">....[Thread state: RUNNABLE].....................................................................
 29,2%  29,2% org.codehaus.groovy.reflection.ParameterTypes.isValidMethod
 24,5%  24,5% java.math.BigInteger.multiply
 16,7%  16,7% groovy.lang.Closure.&lt;init&gt;
 10,4%  10,4% groovy.lang.TrampolineClosure.&lt;init&gt;
  9,8%   9,8% org.codehaus.groovy.runtime.metaclass.ClosureMetaClass.pickClosureMethod
  4,0%   4,0% org.codehaus.groovy.runtime.metaclass.MetaMethodIndex.getMethods
  2,4%   2,4% org.codehaus.groovy.reflection.ParameterTypes.correctArguments
  0,7%   0,7% sun.reflect.GeneratedMethodAccessor1.invoke
  0,5%   0,5% groovy.lang.MetaClassImpl.invokeMethod
  0,3%   0,3% java.util.Arrays.copyOf
  1,3%   1,3% &lt;other&gt;</code></pre></div></div></div><div class="sect2"><h3 id="3-tail-recursive-method">3) Tail recursive method</h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">Benchmark                                 Mode  Cnt     Score   Error  Units
FactorialBench.c_tailRecursive            avgt   42   322,019 ¬± 1,409  ms/op
FactorialBench.c_tailRecursive_sc         avgt   42   104,385 ¬± 1,380  ms/op</code></pre></div></div><div class="paragraph"><p>The best performance comes with a tail recursive method. And it shouldn&#8217;t be a surprise - Groovy compiler compiles a method annotated with <code>@TailRecursive</code> to a bytecode that uses while-loop instead of the recursive calls. <em>(Read more about in the <a href="/tail-recursive-methods-in-groovy/" title="Tail-recursive methods in Groovy">Tail-recursive methods in Groovy</a> post.)</em> That is why the call stack is dominated by two operations:</p></div><div class="ulist"><ul><li><p><code>java.math.BigInteger</code> object initialization,</p></li><li><p>and <code>java.math.BigInteger.multiply()</code> method call.</p></li></ul></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">....[Thread state: RUNNABLE]........................................................................
 41,5%  41,5% java.math.BigInteger.&lt;init&gt;
 26,8%  26,8% java.math.BigInteger.multiply
 15,9%  15,9% java.lang.Integer.getChars
 14,2%  14,2% java.lang.Integer.stringSize
  0,5%   0,5% java.math.BigInteger.multiplyByInt
  0,3%   0,3% bench.FactorialBench.factorialTailRecursive
  0,2%   0,2% java.lang.Integer.toString
  0,2%   0,2% org.codehaus.groovy.runtime.typehandling.NumberMath.toBigInteger
  0,2%   0,2% java.util.Arrays.copyOfRange
  0,0%   0,0% org.openjdk.jmh.runner.BenchmarkHandler$BenchmarkTask.call</code></pre></div></div><div class="paragraph"><p>The statically compiled variant of the tail recursive method does even better. In this case it spends 97.1% of the time calling <code>NumberMath.multiply</code>.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">....[Thread state: RUNNABLE]........................................................................
 97,1%  97,2% org.codehaus.groovy.runtime.typehandling.NumberMath.multiply
  1,1%   1,1% bench.FactorialBench.factorialTailRecursiveSC
  0,8%   0,8% java.math.BigInteger.multiplyByInt
  0,2%   0,2% java.math.BigInteger.valueOf
  0,2%   0,2% bench.FactorialBench.c_tailRecursive_sc
  0,2%   0,2% java.util.Arrays.copyOfRange
  0,1%   0,1% java.lang.Thread.isInterrupted
  0,1%   0,1% java.math.BigInteger.&lt;init&gt;
  0,1%   0,1% java.lang.System.nanoTime
  0,0%   0,0% sun.misc.Unsafe.unpark</code></pre></div></div></div></div></div><div class="sect1"><h2 id="does-groovy-3-0-0-beta-1-do-better">Does Groovy <code>3.0.0-beta-1</code> do better?</h2><div class="sectionbody"><div class="paragraph"><p>Short answer - no. The results comparable. Even if Groovy 2.5.7 of 3.0.0-beta-1 does a little bit better in one variant or another, it doesn&#8217;t prove anything. The tendencies are the same in both cases.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/groovy-trampoline-01.png"><div class="img-lazyload-container" style="width:1372px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==);background-repeat:no-repeat;background-position:center"><img data-original="/images/groovy-trampoline-01.png" height="716" width="1372" style="padding-top:52.1865889212828%"></div></a></div></div></div></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content"><div class="paragraph"><p>Here you can find the full console output from the benchmark tests I use:</p></div><div class="ulist"><ul><li><p><a target="_blank" rel="noopener" href="https://gist.github.com/wololock/6e3c52785c412ef19444ecc549489110">Groovy 2.5.7 output</a></p></li><li><p><a target="_blank" rel="noopener" href="https://gist.github.com/wololock/4062fd3916c3278c27f60b21446fe5bf">Groovy 3.0.0-beta-1 output</a></p></li></ul></div></td></tr></table></div></div></div><div class="sect1"><h2 id="conclusion">Conclusion</h2><div class="sectionbody"><div class="paragraph"><p>The final question is - should we avoid using <code>Closure.trampoline()</code> then? <strong>Absolutely not.</strong> If you use recursive calls in the closure, you should consider using the <code>TrampolineClosure</code> to avoid hitting the call stack size limit. The cost of using <code>TrampolineClosure</code> in the statically compiled Groovy code becomes a trouble only when you need to handle hundreds of thousands calls that invoke recursive closure. However, in this case you can also consider refactoring to the tail recursive method call for the best performance. But remember what Donald Knuth said: <em>"Premature optimization is the root of all evil."</em> <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> <span class="icon"><i class="fa fa-smile-o"></i></span> Use whatever programming construction that works for you (and your team) best, and solve performance problems when they start occurring.</p></div></div></div><div id="footnotes"><hr><div class="footnote" id="_footnotedef_1"><a href="#_footnoteref_1">1</a>. <a target="_blank" rel="noopener" href="http://groovy-lang.org/closures.html#_trampoline" class="bare">http://groovy-lang.org/closures.html#_trampoline</a></div><div class="footnote" id="_footnotedef_2"><a href="#_footnoteref_2">2</a>. Donald Knuth, "Computer Programming as an Art (1974)", p. 671</div></div></div><ul class="tags-list mt-4"><li><a href="/t/jmh/">jmh</a></li><li><a href="/t/groovy/">groovy</a></li><li><a href="/t/benchmark/">benchmark</a></li><li><a href="/t/recursion/">recursion</a></li><li><a href="/t/closures/">closures</a></li><li><a href="/t/tail-recursive/">tail-recursive</a></li></ul></article></div></div></div></div></section><section class="bg-dark posts-layout-01" id="related" data-debug="Scrolled to related posts"><div class="container py-5"><div class="row py-lg-5"><div class="col-12 col-lg-7 d-flex align-items-start mb-lg-0 mb-4"><div class="px-3 px-lg-0 pr-lg-5"><article><a href="/jenkins-pipeline-environment-variables-the-definitive-guide/"><img class="mb-4 shadow" data-lazy="/images/cards/1.png" width="100%"></a><p class="subtitle m-0"><a href="/jenkins-pipeline-cookbook/">Jenkins Pipeline Cookbook</a></p><h3 class="m-0 serif"><a href="/jenkins-pipeline-environment-variables-the-definitive-guide/">Jenkins Pipeline Environment Variables - The Definitive Guide</a></h3><div class="post-meta mb-4"><ul><li><time datetime="2019-11-02T17:27:57.000Z">November 2, 2019</time></li><li>10 min. read</li><li><a href="https://e.printstacktrace.blog/jenkins-pipeline-environment-variables-the-definitive-guide/#disqus_thread">0 Comments</a></li></ul></div><p class="small">Have you run into troubles when you started using Jenkins Environment Variables in your Jenkinsfile? In this blog post, I show you how to use environment variables, how to override them, how to work with boolean values, and how to store a result of sh step in the env variable. After reading this article, Jenkins env variables won&#8217;t surprise you anymore!</p></article></div></div><div class="col-12 col-lg-5"><div class="px-3 px-lg-0"><article class="tile"><div class="row mb-4"><div class="col-9"><p class="subtitle m-0"><a href="/groovy-cookbook/">Groovy Cookbook</a></p><h4 class="m-0 serif"><a href="/what-is-the-most-efficient-way-to-iterate-collection-in-groovy-jmh/">What is the most efficient way to iterate collection in Groovy? Let's play with JMH!</a></h4><div class="post-meta mb-4"><ul><li><time datetime="2018-10-02T10:43:26.000Z">October 2, 2018</time></li><li>10 min. read</li><li><a href="https://e.printstacktrace.blog/what-is-the-most-efficient-way-to-iterate-collection-in-groovy-jmh/#disqus_thread">0 Comments</a></li></ul></div><p class="small">I guess you may heard about Groovy&#8217;s Collection.each(Closure cl) method - it was introduce...</p></div><div class="col-3"><a href="/what-is-the-most-efficient-way-to-iterate-collection-in-groovy-jmh/"><img class="img-fluid rounded shadow-sm mt-3 mb-lg-0" data-lazy="/images/icons/6.png"></a></div></div></article><article class="tile"><div class="row mb-4"><div class="col-9"><p class="subtitle m-0"><a href="/groovy-cookbook/">Groovy Cookbook</a></p><h4 class="m-0 serif"><a href="/tail-recursive-methods-in-groovy/">Tail-recursive methods in Groovy</a></h4><div class="post-meta mb-4"><ul><li><time datetime="2018-11-12T09:53:17.000Z">November 12, 2018</time></li><li>10 min. read</li><li><a href="https://e.printstacktrace.blog/tail-recursive-methods-in-groovy/#disqus_thread">0 Comments</a></li></ul></div><p class="small">Most of the object-oriented programmers prefer constructing algorithms using imperative style ov...</p></div><div class="col-3"><a href="/tail-recursive-methods-in-groovy/"><img class="img-fluid rounded shadow-sm mt-3 mb-lg-0" data-lazy="/images/icons/6.png"></a></div></div></article><article class="tile"><div class="row mb-4"><div class="col-9"><p class="subtitle m-0"><a href="/groovy-cookbook/">Groovy Cookbook</a></p><h4 class="m-0 serif"><a href="/groovy-regular-expressions-the-benchmark/">Groovy Regular Expressions - The Benchmark (Part 2)</a></h4><div class="post-meta mb-4"><ul><li><time datetime="2019-03-19T11:46:39.000Z">March 19, 2019</time></li><li>10 min. read</li><li><a href="https://e.printstacktrace.blog/groovy-regular-expressions-the-benchmark/#disqus_thread">0 Comments</a></li></ul></div><p class="small">In the second part of the "Groovy Regular Expression" blog post, I want to show you some benchma...</p></div><div class="col-3"><a href="/groovy-regular-expressions-the-benchmark/"><img class="img-fluid rounded shadow-sm mt-3 mb-lg-0" data-lazy="/images/icons/15.png"></a></div></div></article><a class="gatr" href="https://click.linksynergy.com/fs-bin/click?id=uow2LCEuhvQ&amp;offerid=572706.11&amp;type=3&amp;subid=0" data-type="banner" data-name="nordvpn-03" target="_blank"><img class="img-fluid" data-lazy="/images/yml/nord-vpn-03.png"></a></div></div></div></div></section><section class="sidebar-enabled" id="comments" data-debug="Scrolled to comments"><div class="container"><div class="row"><div class="col-12 col-lg-3 sidebar order-lg-1 order-0"><div class="py-lg-5 py-3 position-sticky text-center" style="top:20px"><div class="d-inline-block d-lg-none"><a class="gatr" href="https://www.jdoqocy.com/click-100191173-10952823" data-type="banner" data-name="grammarly-02" target="_blank"><img class="img-fluid" data-lazy="/images/yml/grammarly-02.png"></a></div><div class="d-none d-lg-inline-block"><a class="gatr" href="https://www.jdoqocy.com/click-100191173-10952823" data-type="banner" data-name="grammarly-01" target="_blank"><img class="img-fluid" data-lazy="/images/yml/grammarly-tower.png"></a></div></div></div><div class="col-12 col-lg-9 order-0 order-lg-0 order-1"><div class="pr-lg-5 py-5"><p class="m-0 serif small text-muted">Any thoughts or ideas?</p><h2 class="mb-4">Let's talk in the comment's section üí¨</h2><div class="disqus-comments"><div class="tip mb-5">Want to put a code sample in the comment? Read the <a target="_blank" rel="noopener" href="https://help.disqus.com/en/articles/1717236-syntax-highlighting"><b>Syntax highlighting</b></a> guide for more information.</div><div class="comments"><div id="disqus_thread"><div id="disqus_empty" style="display:none">Empty</div></div></div></div><script>function load_disqus(e){var t=document.getElementById("disqus_empty");if(document.contains(t)){var d=document.getElementById("disqus_thread"),n=document.createElement("script"),s=document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0];d&&t&&(t.remove(),n.type="text/javascript",n.async=!0,n.src="//"+e+".disqus.com/embed.js",s.appendChild(n))}}window.addEventListener("scroll",function(e){document.scrollingElement.scrollTop>document.getElementById("disqus_thread").offsetTop-500&&load_disqus("eprintstacktrace")},!1)</script></div></div></div></div></section></main><footer class="bg-dark" id="footer" data-debug="Scrolled to footer"><div class="container py-5"><div class="px-lg-0 px-3"><div class="row py-lg-3"><div class="col-12 col-md-6"><h5 class="mb-4">Latest blog posts</h5><ul class="list-unstyled mb-5"><li><a href="/merging-json-files-recursively-in-the-command-line/">Merging JSON files recursively in the command-line</a></li><li><a href="/jenkins-declarative-pipeline-dynamic-agent/">Jenkins Declarative Pipeline with the dynamic agent - how to configure it?</a></li><li><a href="/groovy-ecosystem-usage-report-2020/">Groovy Ecosystem Usage Report (2020)</a></li><li><a href="/how-to-convert-json-to-csv-from-the-command-line/">How to convert JSON to CSV from the command-line?</a></li><li><a href="/5-common-jenkins-pipeline-mistakes/">5 Common Jenkins Pipeline Mistakes</a></li><li><a href="/how-to-merge-two-maps-in-groovy/">How to merge two maps in Groovy?</a></li><li><a href="/building-stackoverflow-cli-with-java-11-micronaut-picocli-and-graalvm/">Building stackoverflow-cli with Java 11, Micronaut, Picocli, and GraalVM</a></li><li><a href="/how-to-catch-curl-response-in-jenkins-pipeline/">How to catch curl response in Jenkins Pipeline?</a></li><li><a href="/atomic-habits-book-review/">Atomic Habits - book review</a></li><li><a href="/parsing-json-in-command-line-with-jq-basic-filters-and-functions-part-1/">Parsing JSON in command-line with jq: basic filters and functions (part 1)</a></li></ul></div><div class="col-12 col-md-6"><h5 class="mb-4">Trending videos</h5><div class="youtube-row mb-4"><div class="row"><div class="col-12 col-lg-6 text-lg-left text-center mb-lg-0 mb-4"><a class="d-inline-block thumb gatr" target="_blank" rel="noopener" href="https://youtu.be/RPdugI8eZgo" data-type="youtube" data-name="Using GraalVM native-image with a Groovy script - from 2.1s to 0.013s startup time üöÄ" data-time="15:51"><img class="img-fluid shadow" data-lazy="https://i3.ytimg.com/vi/RPdugI8eZgo/mqdefault.jpg"></a></div><div class="col-12 col-lg-6"><h6 class="m-0 p-0 mb-3 sans-serif text-lg-left text-center px-lg-0 px-4"><a class="gatr" target="_blank" rel="noopener" href="https://youtu.be/RPdugI8eZgo" data-type="youtube" data-name="Using GraalVM native-image with a Groovy script - from 2.1s to 0.013s startup time üöÄ">Using GraalVM native-image with a Groovy script - from 2.1s to 0.013s startup time üöÄ</a></h6><p class="sans-serif small text-justify">GraalVM native-image compiler uses ahead-of-time compilation to produce a highly optimized standalone executable file that ca...</p></div></div></div><div class="youtube-row mb-4"><div class="row"><div class="col-12 col-lg-6 text-lg-left text-center mb-lg-0 mb-4"><a class="d-inline-block thumb gatr" target="_blank" rel="noopener" href="https://youtu.be/uIKvYgix-L4" data-type="youtube" data-name="How to merge two JSON files in the command-line using jq? | #jq #json #curl" data-time="9:00"><img class="img-fluid shadow" data-lazy="https://i3.ytimg.com/vi/uIKvYgix-L4/mqdefault.jpg"></a></div><div class="col-12 col-lg-6"><h6 class="m-0 p-0 mb-3 sans-serif text-lg-left text-center px-lg-0 px-4"><a class="gatr" target="_blank" rel="noopener" href="https://youtu.be/uIKvYgix-L4" data-type="youtube" data-name="How to merge two JSON files in the command-line using jq? | #jq #json #curl">How to merge two JSON files in the command-line using jq? | #jq #json #curl</a></h6><p class="sans-serif small text-justify">In this jq tutorial video, I show you how you can merge two JSON files in the command-line using jq JSON processor. I explain...</p></div></div></div></div></div><div class="row text-lg-left text-center"><div class="col-12 col-md-3 mb-lg-0 mb-4"><h5 class="mb-4">Useful links</h5><ul class="list-unstyled"><li><a class="gatr" href="/" data-type="footer-useful-links" data-name="Start here">Start here</a></li><li><a class="gatr" href="/about" data-type="footer-useful-links" data-name="About">About</a></li><li><a class="gatr" href="/archives" data-type="footer-useful-links" data-name="Archives">Archives</a></li><li><a class="gatr" href="/resources" data-type="footer-useful-links" data-name="Resources">Resources</a></li><li><a class="gatr" href="/privacy-policy" data-type="footer-useful-links" data-name="Privacy Policy">Privacy Policy</a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://teespring.com/stores/eprintstacktrace" data-type="footer-useful-links" data-name="Merchandise">Merchandise</a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://kit.co/wololock" data-type="footer-useful-links" data-name="My Kit">My Kit</a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://feeds.feedburner.com/Eprintstacktracenet" data-type="footer-useful-links" data-name="RSS">RSS</a></li><li><a class="gatr" href="/support-me" data-type="footer-useful-links" data-name="Support me">Support the blog <em class="fas fa-heart color-red ml-2"></em></a></li></ul></div><div class="col-12 col-md-3 mb-lg-0 mb-4"><h5 class="mb-4">Popular categories</h5><ul class="list-unstyled"><li><a class="gatr" href="/groovy-cookbook/" data-type="footer-category" data-name="Groovy Cookbook">Groovy Cookbook<span class="count ml-2 text-muted">28</span></a></li><li><a class="gatr" href="/jenkins-pipeline-cookbook/" data-type="footer-category" data-name="Jenkins Pipeline Cookbook">Jenkins Pipeline Cookbook<span class="count ml-2 text-muted">9</span></a></li><li><a class="gatr" href="/programmers-bookshelf/" data-type="footer-category" data-name="Programmer's Bookshelf">Programmer's Bookshelf<span class="count ml-2 text-muted">6</span></a></li><li><a class="gatr" href="/micronaut-cookbook/" data-type="footer-category" data-name="Micronaut Cookbook">Micronaut Cookbook<span class="count ml-2 text-muted">4</span></a></li><li><a class="gatr" href="/ratpack-cookbook/" data-type="footer-category" data-name="Ratpack Cookbook">Ratpack Cookbook<span class="count ml-2 text-muted">4</span></a></li><li><a class="gatr" href="/learning-java/" data-type="footer-category" data-name="Learning Java">Learning Java<span class="count ml-2 text-muted">4</span></a></li><li><a class="gatr" href="/jq-cookbook/" data-type="footer-category" data-name="jq cookbook">jq cookbook<span class="count ml-2 text-muted">3</span></a></li><li><a class="gatr" href="/how-to/" data-type="footer-category" data-name="How to">How to<span class="count ml-2 text-muted">3</span></a></li><li><a class="gatr" href="/blog-reports/" data-type="footer-category" data-name="Blog Reports">Blog Reports<span class="count ml-2 text-muted">2</span></a></li></ul></div><div class="col-12 col-md-6"><h5 class="mb-4">Popular tags</h5><section class="tagcloud"><a href="/t/affiliate/" style="font-size:1.8em;color:#7b828b">affiliate</a> <a href="/t/async/" style="font-size:1.4em;color:#696f76">async</a> <a href="/t/benchmark/" style="font-size:1.6em;color:#727880">benchmark</a> <a href="/t/blogging/" style="font-size:1.2em;color:#60666b">blogging</a> <a href="/t/book/" style="font-size:2em;color:#848b95">book</a> <a href="/t/career/" style="font-size:1.2em;color:#60666b">career</a> <a href="/t/cicd/" style="font-size:2.4em;color:#969daa">cicd</a> <a href="/t/continuous-integration/" style="font-size:1.4em;color:#696f76">continuous-integration</a> <a href="/t/curl/" style="font-size:1.6em;color:#727880">curl</a> <a href="/t/devops/" style="font-size:2.2em;color:#8d94a0">devops</a> <a href="/t/docker/" style="font-size:1.6em;color:#727880">docker</a> <a href="/t/git/" style="font-size:1.2em;color:#60666b">git</a> <a href="/t/github/" style="font-size:1.4em;color:#696f76">github</a> <a href="/t/graalvm/" style="font-size:2.4em;color:#969daa">graalvm</a> <a href="/t/gradle/" style="font-size:1.2em;color:#60666b">gradle</a> <a href="/t/grails/" style="font-size:1.4em;color:#696f76">grails</a> <a href="/t/groovy/" style="font-size:3em;color:#b1b9ca">groovy</a> <a href="/t/haskell/" style="font-size:1.4em;color:#696f76">haskell</a> <a href="/t/hexo/" style="font-size:1.2em;color:#60666b">hexo</a> <a href="/t/java/" style="font-size:2.8em;color:#a8b0bf">java</a> <a href="/t/java-8/" style="font-size:1.4em;color:#696f76">java-8</a> <a href="/t/jenkins/" style="font-size:2.6em;color:#9fa7b5">jenkins</a> <a href="/t/jenkins-pipeline/" style="font-size:2.6em;color:#9fa7b5">jenkins-pipeline</a> <a href="/t/jenkinsfile/" style="font-size:1.4em;color:#696f76">jenkinsfile</a> <a href="/t/jmh/" style="font-size:1.8em;color:#7b828b">jmh</a> <a href="/t/jq/" style="font-size:1.6em;color:#727880">jq</a> <a href="/t/json/" style="font-size:1.6em;color:#727880">json</a> <a href="/t/junit/" style="font-size:1.4em;color:#696f76">junit</a> <a href="/t/learning/" style="font-size:1.6em;color:#727880">learning</a> <a href="/t/maven/" style="font-size:1.4em;color:#696f76">maven</a> <a href="/t/metaprogramming/" style="font-size:1.2em;color:#60666b">metaprogramming</a> <a href="/t/micronaut/" style="font-size:2em;color:#848b95">micronaut</a> <a href="/t/native-image/" style="font-size:1.8em;color:#7b828b">native-image</a> <a href="/t/non-blocking/" style="font-size:1.6em;color:#727880">non-blocking</a> <a href="/t/progress/" style="font-size:1.2em;color:#60666b">progress</a> <a href="/t/ratpack/" style="font-size:2.4em;color:#969daa">ratpack</a> <a href="/t/reactive-programming/" style="font-size:1.4em;color:#696f76">reactive-programming</a> <a href="/t/reading/" style="font-size:1.4em;color:#696f76">reading</a> <a href="/t/recursion/" style="font-size:1.4em;color:#696f76">recursion</a> <a href="/t/review/" style="font-size:2em;color:#848b95">review</a> <a href="/t/rxjava/" style="font-size:1.4em;color:#696f76">rxjava</a> <a href="/t/sdkman/" style="font-size:1.6em;color:#727880">sdkman</a> <a href="/t/session/" style="font-size:1.2em;color:#60666b">session</a> <a href="/t/split/" style="font-size:1.2em;color:#60666b">split</a> <a href="/t/spock/" style="font-size:1.6em;color:#727880">spock</a> <a href="/t/stackoverflow/" style="font-size:1.4em;color:#696f76">stackoverflow</a> <a href="/t/string/" style="font-size:1.4em;color:#696f76">string</a> <a href="/t/tail-call/" style="font-size:1.2em;color:#60666b">tail-call</a> <a href="/t/tail-recursion/" style="font-size:1.2em;color:#60666b">tail-recursion</a> <a href="/t/unit-test/" style="font-size:1.6em;color:#727880">unit-test</a></section></div></div></div></div><section class="bottom"><div class="container"><ul class="text-center py-1 m-0"><li class="d-inline-block">Designed by <a class="gatr" target="_blank" rel="noopener" href="https://twitter.com/wololock" data-type="footer" data-name="designed">@wololock</a></li><li class="d-inline-block">Created with <a class="gatr" target="_blank" rel="noopener" href="https://hexo.io" data-type="footer" data-name="hexo">Hexo</a></li><li class="d-inline-block">Hosted on <a class="gatr" target="_blank" rel="noopener" href="https://github.com/wololock/wololock.github.io" data-type="footer" data-name="github">GitHub</a></li><li class="d-inline-block">Deployed with <a class="gatr" target="_blank" rel="noopener" href="https://circleci.com/gh/wololock/wololock.github.io" data-type="footer" data-name="circleci">Circle CI</a></li><li class="d-inline-block">License <a class="gatr" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" data-type="footer" data-name="license">CC BY-NC-SA 4.0</a></li><li class="d-inline-block"><a class="gatr" target="_blank" rel="noopener" href="https://github.com/wololock/wololock.github.io/commits/develop" data-type="footer" data-name="last-commit"><img data-lazy="https://badgen.net/github/last-commit/wololock/wololock.github.io?color=blue&amp;scale=0.8"></a></li></ul></div></section></footer><script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/48c5da59c9.js" crossorigin="anonymous" async></script><script async id="cookiebanner" src="//cdnjs.cloudflare.com/ajax/libs/cookie-banner/1.2.2/cookiebanner.min.js" data-moreinfo="/privacy-policy/" data-message="This blog uses cookies to enhance your experience. By continuing to visit it you agree to its use of cookies." data-link="#5fc4ff" data-font-family="Lora,serif" data-font-size="16px" data-bg="#1d2b36"></script><script src="/js/main.js?v=11"></script><script src="/js/highlightjs/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad()</script><script async id="dsq-count-scr" src="//eprintstacktrace.disqus.com/count.js"></script><script>!function(e,t,a,c,n,i,r){e.GoogleAnalyticsObject=n,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,i=t.createElement(a),r=t.getElementsByTagName(a)[0],i.async=1,i.src="//www.google-analytics.com/analytics.js",r.parentNode.insertBefore(i,r)}(window,document,"script",0,"ga"),ga("create","UA-42400890-5","auto"),ga("send","pageview"),jQuery(document).on("mousedown","a.gatr",function(e){var t=jQuery(this),a=t.attr("data-type"),c=t.attr("data-name"),n=1===e.which?"click":2===e.which?"middle-click":"right-click";return ga("send","event",a,n,c),!0}),jQuery(document).on("mousedown","#related a",function(e){var t=jQuery(this),a=1===e.which?"click":2===e.which?"middle-click":"right-click";return ga("send","event","related",a,t.attr("href")),!0}),jQuery(document).on("mousedown","#footer a",function(e){var t=jQuery(this),a=1===e.which?"click":2===e.which?"middle-click":"right-click";return ga("send","event","footer",a,t.attr("href")),!0})</script><script>!function(){"use strict";function r(e){var t=e.getAttribute("data-original"),n=new Image;n.onload=function(){e.setAttribute("src",t),e.style.paddingTop=""},n.src=t}document.addEventListener("DOMContentLoaded",function(){var t,e,n,i=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));i.length&&("undefined"!=typeof IntersectionObserver?(t=new IntersectionObserver(function(e,t){e.filter(function(e){return e.isIntersecting}).forEach(function(e){r(e.target),t.unobserve(e.target)})}),i.forEach(function(e){t.observe(e)})):(n=function(){clearTimeout(e),e=setTimeout(function(){return(i=i.filter(function(e){return!e.src})).length?void i.filter(function(e){e.getBoundingClientRect().top<window.innerHeight&&r(e)}):(window.removeEventListener("scroll",n),void window.removeEventListener("resize",n))},100)},window.addEventListener("scroll",n),window.addEventListener("resize",n),n()))},!1)}();</script></body></html>