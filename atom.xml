<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>e.printStackTrace(); // Blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://e.printstacktrace.blog/"/>
  <updated>2020-02-14T13:34:38.000Z</updated>
  <id>https://e.printstacktrace.blog/</id>
  
  <author>
    <name>Szymon Stepniak</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Groovy 3 @NullCheck annotation - less code and less NPE</title>
    <link href="https://e.printstacktrace.blog/groovy-3-nullcheck-annotation-less-code-and-less-npe/"/>
    <id>https://e.printstacktrace.blog/groovy-3-nullcheck-annotation-less-code-and-less-npe/</id>
    <published>2020-02-14T13:34:38.000Z</published>
    <updated>2020-02-14T13:34:38.000Z</updated>
    
    <content type="html"><![CDATA[<div class="paragraph"><p>Groovy 3 helps you write less, but more secure code. Today I want to show you one of the features added in the latest release - <code>@NullCheck</code> annotation.</p></div><a id="more"></a><div class="sect1"><h2 id="what-is-nullcheck">What is <code>@NullCheck</code>?</h2><div class="sectionbody"><div class="paragraph"><p>The <code>@groovy.transform.NullCheck</code> belongs to the category of annotations that trigger specific AST transformations at the compilation time. This specific annotation can be added to class, constructor, or method. When it is present, it adds if-statement that checks if a variable (or variables) is not <code>null</code>, and throws <code>IllegalArgumentException</code> otherwise.</p></div><div class="paragraph"><p>Here is Groovy =&lt;2.5 class example that does all <code>null</code> checks manually.</p></div><div class="listingblock"><div class="title">Listing 1. Groovy 2.5 solution.</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import groovy.transform.CompileStatic@CompileStaticclass Foo {    private final String str    Foo(final String str) {        if (str == null) { <i class="conum" data-value="1"></i><b>(1)</b>            throw new IllegalArgumentException("str cannot be null")        }        this.str = str    }    String bar(final BigDecimal value) {        if (value == null) { <i class="conum" data-value="2"></i><b>(2)</b>            throw new IllegalArgumentException("value cannot be null")        }        return str.toUpperCase() + " = " + value.toString()    }}assert new Foo("test").bar(BigDecimal.TEN) == "TEST = 10"new Foo("test").bar(null) <i class="conum" data-value="3"></i><b>(3)</b></code></pre></div></div><div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Explicit null check in the constructor.</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Explicit null check in the method body.</td></tr><tr><td><i class="conum" data-value="3"></i><b>3</b></td><td>Calling <code>bar(null)</code> to get <code>IllegalArgumentException</code>.</td></tr></table></div><div class="paragraph"><p>When you run such a Groovy script, you will see <code>IllegalArgumentException</code> as expected.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ groovy test.groovyCaught: java.lang.IllegalArgumentException: value cannot be nulljava.lang.IllegalArgumentException: value cannot be nullat Foo.bar(test.groovy:17)at Foo$bar.call(Unknown Source)at test.run(test.groovy:26)</code></pre></div></div><div class="paragraph"><p>When using Groovy 3 (and higher) and <code>@NullCheck</code> annotation we can get replace all explicit checks with a single annotation. The AST transformation that runs at the compile-time produces the same bytecode as in the explicit Groovy 2.5 use case.</p></div><div class="listingblock"><div class="title">Listing 2. Groovy 3+ solution.</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import groovy.transform.CompileStaticimport groovy.transform.NullCheck@CompileStatic@NullCheck <i class="conum" data-value="1"></i><b>(1)</b>class Foo {    private final String str    Foo(final String str) {        this.str = str    }    String bar(final BigDecimal value) {        return str.toUpperCase() + " = " + value.toString()    }}assert new Foo("test").bar(BigDecimal.TEN) == "TEST = 10"new Foo(null).bar(BigDecimal.ONE) <i class="conum" data-value="2"></i><b>(2)</b></code></pre></div></div><div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td><code>@NullCheck</code> at the class level affects all constructors and methods.</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>This time we call a constructor with a <code>null</code> argument to get <code>IllegalArgumentException</code>.</td></tr></table></div><div class="paragraph"><p>Running the following example in the command line produces the expected result.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ groovy test.groovyCaught: java.lang.IllegalArgumentException: str cannot be nulljava.lang.IllegalArgumentException: str cannot be nullat Foo.&lt;init&gt;(test.groovy)at test.run(test.groovy:20)</code></pre></div></div></div></div><div class="sect1"><h2 id="limitations">Limitations</h2><div class="sectionbody"><div class="paragraph"><p>So far I have noticed one minor limitation - the <code>@NullCheck</code> annotation doesn&#8217;t work when combined with <code>@Canonical</code> or <code>@Immutable</code> annotations. If supported, it would allow us to skip constructor definition and simplify the code to something like this.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import groovy.transform.CompileStaticimport groovy.transform.NullCheckimport groovy.transform.Immutable@CompileStatic@NullCheck@Immutableclass Foo {    final String str    String bar(final BigDecimal value) {        return str.toUpperCase() + " = " + value.toString()    }}assert new Foo("test").bar(BigDecimal.TEN) == "TEST = 10"new Foo(null).bar(BigDecimal.ONE) <i class="conum" data-value="1"></i><b>(1)</b></code></pre></div></div><div class="paragraph"><p>In this case, we will get <code>NullPointerException</code> thrown by <code>str.toUpperCase()</code>, because there was no null-check in the generated constructor. <em class="conum" data-value="1"></em></p></div><div class="paragraph"><p>But I&#8217;m optimistic, and I think this limitation may get solved in one of the future Groovy updates. I definitely add <code>@NullCheck</code> to the <code>@CompileStatic</code> annotations arsenal I use on a daily basis. <span class="icon"><i class="fa fa-smile-o"></i></span></p></div></div></div>]]></content>
    
    <summary type="html">
    
      &lt;div class=&quot;paragraph&quot;&gt;&lt;p&gt;Groovy 3 helps you write less, but more secure code. Today I want to show you one of the features added in the latest release - &lt;code&gt;@NullCheck&lt;/code&gt; annotation.&lt;/p&gt;&lt;/div&gt;
    
    </summary>
    
    
      <category term="Groovy Cookbook" scheme="https://e.printstacktrace.blog/categories/groovy-cookbook/"/>
    
    
      <category term="groovy" scheme="https://e.printstacktrace.blog/tags/groovy/"/>
    
      <category term="groovy-3" scheme="https://e.printstacktrace.blog/tags/groovy-3/"/>
    
      <category term="annotation" scheme="https://e.printstacktrace.blog/tags/annotation/"/>
    
  </entry>
  
  <entry>
    <title>Groovy 3 String GDK improvements - takeRight, takeBetween, and a few others</title>
    <link href="https://e.printstacktrace.blog/groovy-3-string-gdk-improvements-takeright-takebetween-and-a-few-others/"/>
    <id>https://e.printstacktrace.blog/groovy-3-string-gdk-improvements-takeright-takebetween-and-a-few-others/</id>
    <published>2020-02-12T11:15:33.000Z</published>
    <updated>2020-02-12T11:15:33.000Z</updated>
    
    <content type="html"><![CDATA[<div class="paragraph"><p>Groovy 3 was released a few days ago<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>, and it introduced <a href="https://groovy-lang.org/releasenotes/groovy-3.0.html#Groovy3.0releasenotes-GDKimprovements" target="_blank" rel="noopener">a lot of important new features</a> to the language. Today I want to show you a few useful improvements in the GDK. We will take a closer look into methods like <code>takeRight</code>, <code>takeAfter</code>, <code>takeBetween</code>, and a few others that were added to the <code>java.lang.String</code> class.</p></div><a id="more"></a><div id="toc" class="toc"><div id="toctitle" class="title">Table of Contents</div><ul class="sectlevel1"><li><a href="#string-takerightint"><code>String.takeRight(int)</code></a></li><li><a href="#string-takeafterstr"><code>String.takeAfter(str)</code></a></li><li><a href="#string-takebeforestr"><code>String.takeBefore(str)</code></a></li><li><a href="#string-takebetweenfromto"><code>String.takeBetween(from,to)</code></a></li><li><a href="#string-droprightint"><code>String.dropRight(int)</code></a></li><li><a href="#string-startswithignorecasestr-and-similar"><code>String.startsWithIgnoreCase(str)</code> and similar</a></li><li><a href="#conclusion">Conclusion</a></li></ul></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">In this blog post we use <code>String</code> as a base class, but most (if not all) of presented methods are working with <code>String</code>, <code>CharSequence</code> and <code>GString</code> classes.</td></tr></table></div><div class="sect1"><h2 id="string-takerightint"><code>String.takeRight(int)</code></h2><div class="sectionbody"><div class="paragraph"><p>Let&#8217;s start with the first one - <code>takeRight</code>. This method allows you to extract <code>n</code> last characters from a given String (or all characters if the number is larger then the string length.)</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">final String text = "Groovy"assert text.takeRight(0) == ""assert text.takeRight(1) == "y"assert text.takeRight(3) == "ovy"assert text.takeRight(20) == "Groovy"</code></pre></div></div></div></div><div class="sect1"><h2 id="string-takeafterstr"><code>String.takeAfter(str)</code></h2><div class="sectionbody"><div class="paragraph"><p>This method allows you to extract the text that exists after the first occurrence of the <code>str</code>. Keep in mind that it is case-sensitive, so it looks for the exact match.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">final String text = "Groovy"assert text.takeAfter("G") == "roovy"assert text.takeAfter("g") == ""assert text.takeAfter("Gro") == "ovy"assert text.takeAfter("Groovy") == ""</code></pre></div></div></div></div><div class="sect1"><h2 id="string-takebeforestr"><code>String.takeBefore(str)</code></h2><div class="sectionbody"><div class="paragraph"><p>It is similar to <code>takeAfter</code>, but here it extracts the text that exists before the first occurrence of <code>str</code>.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">final String text = "Groovy"assert text.takeBefore("G") == ""assert text.takeBefore("g") == ""assert text.takeBefore("ovy") == "Gro"assert text.takeBefore("o") == "Gr"assert text.takeBefore("Groovy") == ""</code></pre></div></div></div></div><div class="sect1"><h2 id="string-takebetweenfromto"><code>String.takeBetween(from,to)</code></h2><div class="sectionbody"><div class="paragraph"><p>This method allows you to extract the text that exists between the first occurrence of <code>from</code> and <code>to</code>. It can be used with a single parameter, then <code>to</code> becomes <code>from</code>. There is also a third optional parameter - <code>occurrence</code> which defines which occurrence should be taken into account (default: the first occurrence of <code>from</code> and <code>to</code>).</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">final String text = "Lorem ipsum dolor sit amet"assert text.takeBetween("i") == "psum dolor s"assert text.takeBetween("i", "r") == "psum dolo"assert text.takeBetween("i", "a") == "psum dolor sit "assert text.takeBetween("l","o") == ""assert text.takeBetween("m")  == " ipsu"assert text.takeBetween("m", 1) == ""assert text.takeBetween("i", "m", 0) == "psu"assert text.takeBetween("i", "m", 1) == "t a"assert text.takeBetween("i", "m", 2) == ""</code></pre></div></div></div></div><div class="sect1"><h2 id="string-droprightint"><code>String.dropRight(int)</code></h2><div class="sectionbody"><div class="paragraph"><p>This is an equivalent of <code>String.drop(int)</code> method, but in this case it produces a new String that drops <code>n</code> characters from the right side.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">final String text = "Hello, World!"assert text.dropRight(4) == "Hello, Wo"assert text.dropRight(0) == "Hello, World!"assert text.dropRight(-10) == "Hello, World!"assert text.dropRight(20) == ""</code></pre></div></div></div></div><div class="sect1"><h2 id="string-startswithignorecasestr-and-similar"><code>String.startsWithIgnoreCase(str)</code> and similar</h2><div class="sectionbody"><div class="paragraph"><p>Groovy also adds "ignore case" variants to three popular String methods:</p></div><div class="ulist"><ul><li><p><code>String.startsWithIgnoreCase(str)</code></p></li><li><p><code>String.endsWithIgnoreCase(str)</code></p></li><li><p><code>String.containsIgnoreCase(str)</code></p></li></ul></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">final String text = "Hello, World!"assert text.startsWithIgnoreCase("he") == trueassert text.startsWithIgnoreCase("HE") == trueassert text.startsWithIgnoreCase("HEE") == falseassert text.endsWithIgnoreCase("D!") == trueassert text.endsWithIgnoreCase("LD!") == trueassert text.endsWithIgnoreCase("LLD!") == falseassert text.containsIgnoreCase("HELL") == trueassert text.containsIgnoreCase("OLD") == falseassert text.containsIgnoreCase("OrLd") == true</code></pre></div></div></div></div><div class="sect1"><h2 id="conclusion">Conclusion</h2><div class="sectionbody"><div class="paragraph"><p>Here are a few new interesting methods added to Groovy in the 3.0 release. The list of all changes is much more impressive, so please take a look at the release notes. You can expect some more Groovy 3 related content soon on my blog, as well as on <a href="https://www.youtube.com/channel/UCEf8e5YAYnowq-2deW4tpsw" target="_blank" rel="noopener">my YouTube channel</a>. See you next time!</p></div></div></div><div id="footnotes"><hr><div class="footnote" id="_footnotedef_1"><a href="#_footnoteref_1">1</a>. February 10th, 2020</div></div>]]></content>
    
    <summary type="html">
    
      &lt;div class=&quot;paragraph&quot;&gt;&lt;p&gt;Groovy 3 was released a few days ago&lt;sup class=&quot;footnote&quot;&gt;[&lt;a id=&quot;_footnoteref_1&quot; class=&quot;footnote&quot; href=&quot;#_footnotedef_1&quot; title=&quot;View footnote.&quot;&gt;1&lt;/a&gt;]&lt;/sup&gt;, and it introduced &lt;a href=&quot;https://groovy-lang.org/releasenotes/groovy-3.0.html#Groovy3.0releasenotes-GDKimprovements&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;a lot of important new features&lt;/a&gt; to the language. Today I want to show you a few useful improvements in the GDK. We will take a closer look into methods like &lt;code&gt;takeRight&lt;/code&gt;, &lt;code&gt;takeAfter&lt;/code&gt;, &lt;code&gt;takeBetween&lt;/code&gt;, and a few others that were added to the &lt;code&gt;java.lang.String&lt;/code&gt; class.&lt;/p&gt;&lt;/div&gt;
    
    </summary>
    
    
      <category term="Groovy Cookbook" scheme="https://e.printstacktrace.blog/categories/groovy-cookbook/"/>
    
    
      <category term="groovy" scheme="https://e.printstacktrace.blog/tags/groovy/"/>
    
      <category term="string" scheme="https://e.printstacktrace.blog/tags/string/"/>
    
      <category term="groovy-3" scheme="https://e.printstacktrace.blog/tags/groovy-3/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins Scripted Pipeline vs. Declarative Pipeline - the 4 practical differences</title>
    <link href="https://e.printstacktrace.blog/jenkins-scripted-pipeline-vs-declarative-pipeline-the-4-practical-differences/"/>
    <id>https://e.printstacktrace.blog/jenkins-scripted-pipeline-vs-declarative-pipeline-the-4-practical-differences/</id>
    <published>2020-01-22T00:31:55.000Z</published>
    <updated>2020-01-22T00:31:55.000Z</updated>
    
    <content type="html"><![CDATA[<div class="paragraph"><p>If you read this blog post, there is a high chance you&#8217;re looking for information about practical differences between scripted and declarative pipeline, correct? You couldn&#8217;t find a better place then. I&#8217;m going to show you the four most practical differences between those two. Stay with me for a few minutes and enjoy the ride!</p></div><a id="more"></a><div id="toc" class="toc"><div id="toctitle" class="title">Table of Contents</div><ul class="sectlevel1"><li><a href="#the-introduction">The introduction</a><ul class="sectlevel2"><li><a href="#1-pipeline-code-validation-at-startup">1. Pipeline code validation at startup</a></li><li><a href="#2-restart-from-stage">2. Restart from stage</a></li><li><a href="#3-declarative-pipeline-options-block">3. Declarative pipeline <code>options</code> block</a></li><li><a href="#4-skipping-stages-with-when-block">4. Skipping stages with <code>when</code> block.</a></li></ul></li><li><a href="#conclusion">Conclusion</a></li></ul></div><div class="sect1"><h2 id="the-introduction">The introduction</h2><div class="sectionbody"><div class="paragraph"><p>But let&#8217;s start with the following question - why are there two pipeline types in the first place? The scripted pipeline was the first implementation of the pipeline as a code in Jenkins. Even though it uses the underlying pipeline subsystem, it was designed more or less as <strong>a general-purpose DSL built with Groovy</strong>.<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> It means that it does not come with a fixed structure, and it is up to you how you will define your pipeline logic. The declarative pipeline, on the other hand, is more opinionated, and its structure is well-defined.<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> It may look a bit limiting, but in practice, you can achieve the same things using the scripted or declarative pipeline. So which one to choose?</p></div><div class="paragraph"><p>If you ask me this question and expect an answer different from <em>"it depends,"</em> I would say use the declarative pipeline. And here&#8217;s why.</p></div><div class="sect2"><h3 id="1-pipeline-code-validation-at-startup">1. Pipeline code validation at startup</h3><div class="paragraph"><p>Let&#8217;s consider the following pipeline code.</p></div><div class="listingblock"><div class="title">Listing 1. Jenkinsfile</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">pipeline {    agent any    stages {        stage("Build") {            steps {                echo "Some code compilation here..."            }        }        stage("Test") {            steps {                echo "Some tests execution here..."                echo 1            }        }    }}</code></pre></div></div><div class="paragraph"><p>If we try to execute the following pipeline, the validation will quickly fail the build. The <strong>echo</strong> step can be triggered only with the <code>String</code> parameter, so we get the error like.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/jenkins-declarative-pipeline-validation.png"><img src="/images/jenkins-declarative-pipeline-validation.png" alt="jenkins declarative pipeline validation"></a></div></div></div></div><div class="paragraph"><p>Notice that the pipeline didn&#8217;t execute any stage and just failed. This might save us a lot of time - imagine executing the <strong>Build</strong> stage for a couple of minutes, just to get the information that the <strong>echo</strong> step expects to get <code>java.lang.String</code> instead of <code>java.lang.Integer</code>.</p></div><div class="paragraph"><p>Now let&#8217;s take a look at the scripted pipeline equivalent of that example.</p></div><div class="listingblock"><div class="title">Listing 2. Jenkinsfile</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">node {    stage("Build") {        echo "Some code compilation here..."    }    stage("Test") {        echo "Some tests execution here..."        echo 1    }}</code></pre></div></div><div class="paragraph"><p>This pipeline executes the same stages, and the same steps. There is one significant difference however. Let&#8217;s execute it and see what result it produces.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/jenkins-scripted-pipeline-echo-error.png"><img src="/images/jenkins-scripted-pipeline-echo-error.png" alt="jenkins scripted pipeline echo error"></a></div></div></div></div><div class="paragraph"><p>It failed as expected. But this time the <strong>Build</strong> stage was executed, as well as the first step from the <strong>Test</strong> stage. As you can see, there was no validation of the pipeline code. The declarative pipeline in this case handles such use case much better.</p></div></div><div class="sect2"><h3 id="2-restart-from-stage">2. Restart from stage</h3><div class="paragraph"><p>Another cool feature that only declarative pipeline has is "Restart from stage" one. Let&#8217;s fix the pipeline from the previous example and see if we can restart the <strong>Test</strong> stage only.</p></div><div class="listingblock"><div class="title">Listing 3. Jenkinsfile</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">pipeline {    agent any    stages {        stage("Build") {            steps {                echo "Some code compilation here..."            }        }        stage("Test") {            steps {                echo "Some tests execution here..."            }        }    }}</code></pre></div></div><div class="paragraph"><p>Let&#8217;s execute it.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/jenkins-declarative-pipeline-restart-stage.png"><img src="/images/jenkins-declarative-pipeline-restart-stage.png" alt="jenkins declarative pipeline restart stage"></a></div></div></div></div><div class="paragraph"><p>Here you can see that the <strong>Test</strong> stage is selected. There is an option called "Restart Test" right above the steps list on the right side. Let&#8217;s click on it and see the result.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/jenkins-declarative-pipeline-restarted.png"><img src="/images/jenkins-declarative-pipeline-restarted.png" alt="jenkins declarative pipeline restarted"></a></div></div></div></div><div class="paragraph"><p>As you can see, Jenkins skipped the <strong>Build</strong> stage (it used the workspace from the previous build) and started the next pipeline execution from the <strong>Test</strong> stage. It might be useful when you execute some external tests and they fail because of some issues with the remote environment. You can fix the problem with the test environment and re-run the stage again, without the need to rebuild all artifacts. (The code of the app hasn&#8217;t change in such case.)</p></div><div class="paragraph"><p>Now, let&#8217;s look at the scripted pipeline example.</p></div><div class="listingblock"><div class="title">Listing 4. Jenkinsfile</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">node {    stage("Build") {        echo "Some code compilation here..."    }    stage("Test") {        echo "Some tests execution here..."    }}</code></pre></div></div><div class="paragraph"><p>Let&#8217;s execute it.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/jenkins-scripted-pipeline-no-restart-option.png"><img src="/images/jenkins-scripted-pipeline-no-restart-option.png" alt="jenkins scripted pipeline no restart option"></a></div></div></div></div><div class="paragraph"><p>No restart option as you can see. The declarative pipeline vs. scripted pipeline - 2:0.</p></div></div><div class="sect2"><h3 id="3-declarative-pipeline-options-block">3. Declarative pipeline <code>options</code> block</h3><div class="paragraph"><p>The third feature is supported by both pipeline types, however the declarative pipeline handles it a bit better in my opinion. Let&#8217;s say we have the following features to add to the previous pipeline.</p></div><div class="ulist"><ul><li><p>The timestamps in console log.</p></li><li><p>The ANSI color output.</p></li><li><p>The 1-minute timeout for the <strong>Build</strong> stage, and 2 minutes timeout for the <strong>Test</strong> stage.</p></li></ul></div><div class="paragraph"><p>Here is what does the declarative pipeline look like.</p></div><div class="listingblock"><div class="title">Listing 5. Jenkinsfile</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">pipeline {    agent any    options {        timestamps()        ansiColor("xterm")    }    stages {        stage("Build") {            options {                timeout(time: 1, unit: "MINUTES")            }            steps {                sh 'printf "\\e[31mSome code compilation here...\\e[0m\\n"'            }        }        stage("Test") {            options {                timeout(time: 2, unit: "MINUTES")            }            steps {                sh 'printf "\\e[31mSome tests execution here...\\e[0m\\n"'            }        }    }}</code></pre></div></div><div class="paragraph"><p>Let&#8217;s run it.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/jenkins-declarative-pipeline-options.png"><img src="/images/jenkins-declarative-pipeline-options.png" alt="jenkins declarative pipeline options"></a></div></div></div></div><div class="paragraph"><p>Here is the console log.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Started by user Szymon StepniakRunning in Durability level: MAX_SURVIVABILITY[Pipeline] Start of Pipeline[Pipeline] nodeRunning on Jenkins in /home/wololock/.jenkins/workspace/pipeline-sandbox[Pipeline] {[Pipeline] timestamps[Pipeline] {[Pipeline] ansiColor[Pipeline] {[Pipeline] stage[Pipeline] { (Build)[Pipeline] timeout15:10:04  Timeout set to expire in 1 min 0 sec[Pipeline] {[Pipeline] sh15:10:04  + printf '\e[31mSome code compilation here...\e[0m\n'15:10:04  Some code compilation here...[Pipeline] }[Pipeline] // timeout[Pipeline] }[Pipeline] // stage[Pipeline] stage[Pipeline] { (Test)[Pipeline] timeout15:10:04  Timeout set to expire in 2 min 0 sec[Pipeline] {[Pipeline] sh15:10:05  + printf '\e[31mSome tests execution here...\e[0m\n'15:10:05  Some tests execution here...[Pipeline] }[Pipeline] // timeout[Pipeline] }[Pipeline] // stage[Pipeline] }[Pipeline] // ansiColor[Pipeline] }[Pipeline] // timestamps[Pipeline] }[Pipeline] // node[Pipeline] End of PipelineFinished: SUCCESS</code></pre></div></div><div class="paragraph"><p>In the declarative pipeline, options are separated from the pipeline script logic. The scripted pipeline also supports <code>timestamps</code>, <code>ansiColor</code> and <code>timeout</code> options, but it requires a different code. Here is the same pipeline expressed using the scripted pipeline.</p></div><div class="listingblock"><div class="title">Listing 6. Jenkinsfile</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">node {    timestamps {        ansiColor("xterm") {            stage("Build") {                timeout(time: 1, unit: "MINUTES") {                    sh 'printf "\\e[31mSome code compilation here...\\e[0m\\n"'                }            }            stage("Test") {                timeout(time: 2, unit: "MINUTES") {                    sh 'printf "\\e[31mSome tests execution here...\\e[0m\\n"'                }            }        }    }}</code></pre></div></div><div class="paragraph"><p>I guess you see the problem. Here we used only <code>timestamps</code> and <code>ansiColor</code> Jenkins plugins. Imagine adding one or two more plugins. Declarative vs. scripted, 3:0.</p></div></div><div class="sect2"><h3 id="4-skipping-stages-with-when-block">4. Skipping stages with <code>when</code> block.</h3><div class="paragraph"><p>The last thing I would like to mention in this blog post is the <code>when</code> block that the declarative pipeline supports. Let&#8217;s improve the previous example and add a following condition:</p></div><div class="ulist"><ul><li><p>Execute <strong>Test</strong> stage only if <code>env.FOO</code> equals <code>bar</code>.</p></li></ul></div><div class="paragraph"><p>Here is what the declarative pipeline code looks like.</p></div><div class="listingblock"><div class="title">Listing 7. Jenkinsfile</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">pipeline {    agent any    options {        timestamps()        ansiColor("xterm")    }    stages {        stage("Build") {            options {                timeout(time: 1, unit: "MINUTES")            }            steps {                sh 'printf "\\e[31mSome code compilation here...\\e[0m\\n"'            }        }        stage("Test") {            when {                environment name: "FOO", value: "bar"            }            options {                timeout(time: 2, unit: "MINUTES")            }            steps {                sh 'printf "\\e[31mSome tests execution here...\\e[0m\\n"'            }        }    }}</code></pre></div></div><div class="paragraph"><p>And let&#8217;s execute it.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/jenkins-declarative-pipeline-when.png"><img src="/images/jenkins-declarative-pipeline-when.png" alt="jenkins declarative pipeline when"></a></div></div></div></div><div class="paragraph"><p>The <strong>Test</strong> stage was skipped as expected. Now let&#8217;s try to do the same thing in the scripted pipeline example.</p></div><div class="listingblock"><div class="title">Listing 8. Jenkinsfile</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">node {    timestamps {        ansiColor("xterm") {            stage("Build") {                timeout(time: 1, unit: "MINUTES") {                    sh 'printf "\\e[31mSome code compilation here...\\e[0m\\n"'                }            }            if (env.FOO == "bar") {                stage("Test") {                    timeout(time: 2, unit: "MINUTES") {                        sh 'printf "\\e[31mSome tests execution here...\\e[0m\\n"'                    }                }            }        }    }}</code></pre></div></div><div class="paragraph"><p>As you can see, we had to use if-condition to check if <code>env.FOO</code> equals <code>bar</code>, and only then add the <strong>Test</strong> stage. (It&#8217;s not a real skipping in this case unfortunately.) Let&#8217;s run it and see what is the result.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/jenkins-scripted-pipeline-stage-skip.png"><img src="/images/jenkins-scripted-pipeline-stage-skip.png" alt="jenkins scripted pipeline stage skip"></a></div></div></div></div><div class="paragraph"><p>This is not the same result. In the scripted pipeline use case, the <strong>Test</strong> stage is not even rendered. This might introduce some unnecessary confusion, the declarative pipeline handles it much better in my opinion. Declarative vs. scripted, 4:0.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">If you want to learn more about <strong>Jenkins</strong> and CI/CD pipelines, check out <a href="https://amzn.to/3b3diVl" target="_blank" rel="noopener" class="ga-track"><em>&quot;Continuous Delivery with Docker and Jenkins&quot;</em></a> book by Rafal Leszko. This book will guide you through the process of setting up continuous delivery pipelines using Jenkins and Docker. Highly recommended!</td></tr></table></div></div></div></div><div class="sect1"><h2 id="conclusion">Conclusion</h2><div class="sectionbody"><div class="paragraph"><p>Here are my top 4 differences between the declarative and scripted Jenkins pipeline. These are not the only differences, and I guess your list may look a little different. What is your choice? Do you prefer the declarative pipeline, or the scripted one? Please share your thoughts in the section down below.</p></div></div></div><div id="footnotes"><hr><div class="footnote" id="_footnotedef_1"><a href="#_footnoteref_1">1</a>. <a href="https://jenkins.io/doc/book/pipeline/syntax/#scripted-pipeline" target="_blank" rel="noopener" class="bare">https://jenkins.io/doc/book/pipeline/syntax/#scripted-pipeline</a></div><div class="footnote" id="_footnotedef_2"><a href="#_footnoteref_2">2</a>. <a href="https://jenkins.io/doc/book/pipeline/syntax/#declarative-pipeline" target="_blank" rel="noopener" class="bare">https://jenkins.io/doc/book/pipeline/syntax/#declarative-pipeline</a></div></div>]]></content>
    
    <summary type="html">
    
      &lt;div class=&quot;paragraph&quot;&gt;&lt;p&gt;If you read this blog post, there is a high chance you&amp;#8217;re looking for information about practical differences between scripted and declarative pipeline, correct? You couldn&amp;#8217;t find a better place then. I&amp;#8217;m going to show you the four most practical differences between those two. Stay with me for a few minutes and enjoy the ride!&lt;/p&gt;&lt;/div&gt;
    
    </summary>
    
    
      <category term="Jenkins Pipeline Cookbook" scheme="https://e.printstacktrace.blog/categories/jenkins-pipeline-cookbook/"/>
    
    
      <category term="groovy" scheme="https://e.printstacktrace.blog/tags/groovy/"/>
    
      <category term="jenkins" scheme="https://e.printstacktrace.blog/tags/jenkins/"/>
    
      <category term="jenkins-pipeline" scheme="https://e.printstacktrace.blog/tags/jenkins-pipeline/"/>
    
      <category term="cicd" scheme="https://e.printstacktrace.blog/tags/cicd/"/>
    
      <category term="pipeline" scheme="https://e.printstacktrace.blog/tags/pipeline/"/>
    
  </entry>
  
  <entry>
    <title>The blog development report - year 2019</title>
    <link href="https://e.printstacktrace.blog/the-blog-development-report-year-2019/"/>
    <id>https://e.printstacktrace.blog/the-blog-development-report-year-2019/</id>
    <published>2020-01-12T10:01:25.000Z</published>
    <updated>2020-01-12T10:01:25.000Z</updated>
    
    <content type="html"><![CDATA[<div class="paragraph"><p>2019 was a fantastic year for my blog. I didn&#8217;t manage to write articles every month, but it didn&#8217;t stop the growth. Today I would like to share with you some numbers. And the reason is simple - you&#8217;ve made those numbers possible, so I think you deserve to get some "behind the scenes" facts.</p></div><a id="more"></a><div class="sect1"><h2 id="113802-unique-visitors">113,802 unique visitors</h2><div class="sectionbody"><div class="paragraph"><p>Let&#8217;s start with the number of unique visitors. In 2019, the blog was visited by <strong>113,802</strong> unique visitors. The month with the lowest number of visitors was February - <strong>2,581</strong> unique visitors. The month with the highest number of visitors was December - <strong>17,443</strong> unique visitors.</p></div><div class="paragraph"><p>The blog has a very high bounce rate of <strong>91,61%</strong>, which means that only <strong>8,39%</strong> of visitors continue browsing the blog after opening the first page. This number does not surprise me - a vast majority of people find the blog using a search engine, and they visit it to find a specific solution to their problem. They find what they looked for, and they get back to their business. However, I would like to lower the bounce rate in 2020 to something like 80-85%.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/2019-unique-visitors.png"><img src="/images/2019-unique-visitors.png" alt="2019 unique visitors"></a></div></div></div></div></div></div><div class="sect1"><h2 id="organic-search-produced-918-traffic">Organic Search produced 91,8% traffic</h2><div class="sectionbody"><div class="paragraph"><p>There is no surprise here. The Google search engine is responsible for <strong>91,8%</strong> traffic on the blog. The second top channel is direct traffic with <strong>4,5%</strong> efficiency. The third top channel is the Social Media traffic with just <strong>1,6%</strong> efficiency.</p></div><div class="paragraph"><p>There is one interesting observation. The most engaging traffic comes from referrals - the bounce rate, in this case, is <strong>78,04%</strong>. The least engaging channel is, of course, Organic Search with <strong>92,22%</strong> bounce rate.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/2019-acquisition-summary.png"><img src="/images/2019-acquisition-summary.png" alt="2019 acquisition summary"></a></div></div></div></div></div></div><div class="sect1"><h2 id="partitioning-lists-in-java-8-wins">Partitioning lists in Java 8 wins</h2><div class="sectionbody"><div class="paragraph"><p>Now let&#8217;s take a look at the most popular blog posts in 2019. Here is the TOP 3:</p></div><div class="ulist"><ul><li><p><a href="/divide-a-list-to-lists-of-n-size-in-Java-8/" title="Divide a list to lists of n size in Java 8">Divide a list to lists of n size in Java 8</a> - <strong>42,078</strong> pageviews</p></li><li><p><a href="/groovy-regular-expressions-the-definitive-guide/" title="Groovy Regular Expressions - The Definitive Guide">Groovy Regular Expressions - The Definitive Guide</a> - <strong>37,119</strong> pageviews</p></li><li><p><a href="/how-to-avoid-no-tests-were-found-when-using-junit5-with-groovy/" title="How to avoid &quot;No tests were found&quot; when using JUnit 5 with Groovy?">How to avoid &quot;No tests were found&quot; when using JUnit 5 with Groovy?</a> - <strong>11,556</strong> pageviews</p></li></ul></div><div class="paragraph"><p>There is one honorable mention - <a href="/jenkins-pipeline-environment-variables-the-definitive-guide/" title="Jenkins Pipeline Environment Variables - The Definitive Guide">Jenkins Pipeline Environment Variables - The Definitive Guide</a> which generated <strong>5,334</strong> pageviews, but this blog post was published on November 2nd, so it is one of the candidates for the 2020 TOP 3 ranking winner.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/2019-pageviews-summary.png"><img src="/images/2019-pageviews-summary.png" alt="2019 pageviews summary"></a></div></div></div></div></div></div><div class="sect1"><h2 id="the-top-search-keyword-groovy-regex">The top search keyword - <code>groovy regex</code></h2><div class="sectionbody"><div class="paragraph"><p>And here is a summary from the Search Console. At the beginning of 2019, the blog was not ranked high in the Google index. It started changing in the middle of the year, and I started seeing more and more traffic coming from Google.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/2019-google-search-summary.png"><img src="/images/2019-google-search-summary.png" alt="2019 google search summary"></a></div></div></div></div><div class="paragraph"><p>And here are the TOP 10 search keywords for my blog:</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/2019-top-search-keywords.png"><img src="/images/2019-top-search-keywords.png" alt="2019 top search keywords"></a></div></div></div></div></div></div><div class="sect1"><h2 id="top-country-united-states">Top country - United States</h2><div class="sectionbody"><div class="paragraph"><p>Almost <strong>20%</strong> of the traffic comes from the United States. The second country in that ranking is India with almost <strong>9%</strong> score. The third place belongs to Germany with <strong>6.5%</strong> score.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/2019-geo-summary.png"><img src="/images/2019-geo-summary.png" alt="2019 geo summary"></a></div></div></div></div><div class="paragraph"><p>And here is the TOP 10:</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/2019-top-10-countries.png"><img src="/images/2019-top-10-countries.png" alt="2019 top 10 countries"></a></div></div></div></div></div></div><div class="sect1"><h2 id="internet-explorer-used-by-119-of-users">Internet Explorer used by 1,19% of users</h2><div class="sectionbody"><div class="paragraph"><p>And last but not least - the web browser ranking. Google Chrome wins with almost <strong>80%</strong> score. Firefox is used by <strong>12%</strong> of readers, which means that the first two browsers are used by <strong>~92%</strong> of readers. Here is the full ranking.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/2019-webbrowser-summary.png"><img src="/images/2019-webbrowser-summary.png" alt="2019 webbrowser summary"></a></div></div></div></div></div></div><div class="sect1"><h2 id="whats-coming-in-2020">What&#8217;s coming in 2020?</h2><div class="sectionbody"><div class="paragraph"><p>Don&#8217;t expect any revolution. I want to keep blogging about the things I&#8217;m genuinely interested in. I want to blog more often, but the quality of the content is more important to me than the quantity. There is one thing I can guarantee you - the blog remains ad-free. I love the User Experience I&#8217;ve built here, and I don&#8217;t want to change that. There will be some alternative (and optional) ways to support my work, but ads are not in this category.</p></div><div class="paragraph"><p>My goal for 2020 is to put more content on my small <a href="https://www.youtube.com/channel/UCEf8e5YAYnowq-2deW4tpsw/featured" target="_blank" rel="noopener">YouTube channel</a>. I recorded a few new videos already, so you should see a video posted every week. <em>(Consider subscribing if you&#8217;re not doing it already. <span class="icon"><i class="fa fa-smile-o"></i></span>)</em></p></div><div class="paragraph"><p>And that&#8217;s it for today. I wish you a fruitful year 2020! Define your own rules and live according to them, and everything will go smoothly. Take care, and see you in the next blog post!</p></div><div class="paragraph"><p>PS: If there is something that surprised you most regarding the 2019 performance of this blog, please let me know in the comments section down below.</p></div></div></div>]]></content>
    
    <summary type="html">
    
      &lt;div class=&quot;paragraph&quot;&gt;&lt;p&gt;2019 was a fantastic year for my blog. I didn&amp;#8217;t manage to write articles every month, but it didn&amp;#8217;t stop the growth. Today I would like to share with you some numbers. And the reason is simple - you&amp;#8217;ve made those numbers possible, so I think you deserve to get some &quot;behind the scenes&quot; facts.&lt;/p&gt;&lt;/div&gt;
    
    </summary>
    
    
      <category term="Blog Reports" scheme="https://e.printstacktrace.blog/categories/blog-reports/"/>
    
    
      <category term="2019" scheme="https://e.printstacktrace.blog/tags/2019/"/>
    
      <category term="summary" scheme="https://e.printstacktrace.blog/tags/summary/"/>
    
      <category term="blog" scheme="https://e.printstacktrace.blog/tags/blog/"/>
    
      <category term="google-analytics" scheme="https://e.printstacktrace.blog/tags/google-analytics/"/>
    
      <category term="report" scheme="https://e.printstacktrace.blog/tags/report/"/>
    
  </entry>
  
  <entry>
    <title>Three Groovy String methods that will make your life Groovier!</title>
    <link href="https://e.printstacktrace.blog/groovy-string-methods-that-will-make-your-life-groovier/"/>
    <id>https://e.printstacktrace.blog/groovy-string-methods-that-will-make-your-life-groovier/</id>
    <published>2019-12-18T21:19:20.000Z</published>
    <updated>2019-12-18T21:19:20.000Z</updated>
    
    <content type="html"><![CDATA[<div class="paragraph"><p>Groovy String API offers many useful methods to make working with strings much more pleasant. Today I would like to show you three, not so very popular, yet convenient methods. Let&#8217;s jump straight into it! <span class="icon"><i class="fa fa-smile-o"></i></span></p></div><a id="more"></a><div id="toc" class="toc"><div id="toctitle" class="title">Table of Contents</div><ul class="sectlevel1"><li><a href="#number-1-padleft-padright-and-center">Number #1: <code>padLeft</code>, <code>padRight</code>, and <code>center</code></a></li><li><a href="#number-2-and-operators">Number #2: <code>-</code> and <code>*</code> operators</a></li><li><a href="#number-3-string-translation-with-the-tr-method">Number #3: String translation with the <code>tr</code> method</a></li><li><a href="#bonus-string-countcharsequence">Bonus: <code>String.count(charSequence)</code></a></li><li><a href="#conclusion">Conclusion</a></li></ul></div><div class="sect1"><h2 id="number-1-padleft-padright-and-center">Number #1: <code>padLeft</code>, <code>padRight</code>, and <code>center</code></h2><div class="sectionbody"><div class="paragraph"><p>How many times you tried to format some console text using <code>printf</code>, and you have to google <em>" printf pad to right"</em>, etc.? I think I did that countless times in the past. Until I&#8217;ve found those three useful String methods in the Groovy SDK: <code>padLeft</code>, <code>padRight</code>, and <code>center</code>.</p></div><div class="paragraph"><p>The first two are quite self-descriptive - they add padding on the left/right side, relative to the actual string length. So, for instance, when we call <code>"abc" .padRight(10)</code>, seven spaces will be added after the last character in the string. The <code>center</code> method, on the other hand, places the string in the middle and adds equal paddings on both sides. For instance, <code>"abc".center(7,"-")</code> will produce a string like <code>--abc--</code></p></div><div class="paragraph"><p>Just look at the following example.</p></div><div class="listingblock"><div class="title">Listing 1. script.groovy</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">println " HEADER ".center(50, "-")println "Number:".padRight(20)      + "20"println "Name:".padRight(20)        + "John Doe"println "Address:".padRight(20)     + "34 Some Street, London"println "Subscriber:".padRight(20)  + "YES"println "Expired:".padRight(20)     + "NO"</code></pre></div></div><div class="paragraph"><p>And here is the output in the console when running this simple Groovy script.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ groovy script.groovy--------------------- HEADER ---------------------Number:             20Name:               John DoeAddress:            34 Some Street, LondonSubscriber:         YESExpired:            NO</code></pre></div></div></div></div><div class="sect1"><h2 id="number-2-and-operators">Number #2: <code>-</code> and <code>*</code> operators</h2><div class="sectionbody"><div class="paragraph"><p>Using <code>+</code> operator to concatenate two strings is nothing special. Groovy, however, adds support for <code>-</code> (subtraction) and <code>*</code> (multiplication) operators as well.</p></div><div class="paragraph"><p>The use case for <code>-</code> operator is simple. It creates a new string with the removed first occurrence of the right side string (if any). If the right side string occurs multiple times on the left side string, only the first one gets removed.</p></div><div class="paragraph"><p>Here are some examples from the <code>groovysh</code>:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">groovy:000&gt; text = "lorem ipsum dolor sit amet"===&gt; lorem ipsum dolor sit ametgroovy:000&gt; text - "dolor sit "===&gt; lorem ipsum ametgroovy:000&gt; text - "abc"===&gt; lorem ipsum dolor sit amet</code></pre></div></div><div class="paragraph"><p>The minus operator may be much more useful when combined with the range operator. Let&#8217;s assume we have a string, and we need to create a new one by removing some range from the input string.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">groovy:000&gt; text = "lorem ipsum dolor sit amet"===&gt; lorem ipsum dolor sit ametgroovy:000&gt; text - text[3..12]===&gt; lorolor sit amet</code></pre></div></div><div class="paragraph"><p>Clean and simple.</p></div><div class="paragraph"><p>The multiplication operator <code>*</code> provides a way to repeat strings or characters without much hustle. Let&#8217;s say you are building a command line tool and you want to draw some ASCII art shapes. You can use a combination of <code>*</code> and <code>+</code> operators to draw a rectangle with a single line of Groovy code.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">groovy:000&gt; "\n" + "" * 50 + "" + ("\n" + "" * 50 + "") * 10 + "\n" + "" * 50 + ""===&gt;</code></pre></div></div></div></div><div class="sect1"><h2 id="number-3-string-translation-with-the-tr-method">Number #3: String translation with the <code>tr</code> method</h2><div class="sectionbody"><div class="paragraph"><p>Groovy&#8217;s <a href="http://docs.groovy-lang.org/latest/html/api/org/codehaus/groovy/runtime/StringGroovyMethods.html#tr(java.lang.CharSequence,java.lang.CharSequence,java.lang.CharSequence)" target="_blank" rel="noopener">text translation</a> method seems to be unknown to many programmers. Some of you might think that it is just an equivalent of good old <code>String.replaceAll()</code> method. Nothing could be further from the truth. Let&#8217;s look at a few examples.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">groovy:000&gt; "John Doe".tr("a-z", "*")===&gt; J*** D**</code></pre></div></div><div class="paragraph"><p>Pfff, easy. Fair enough. What about this?</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">groovy:000&gt; "John Doe".tr("a-z", "z-a")===&gt; Jlsm Dlv</code></pre></div></div><div class="paragraph"><p>OK, so what happened here? In this second case, Groovy translated lower case letters from <code>a</code> to <code>z</code> to their representatives (letters at the same index position) from the range from <code>z</code> to <code>a</code>.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">groovy:000&gt; ('a'..'z').toList()===&gt; [a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z]groovy:000&gt; ('z'..'a').toList()===&gt; [z, y, x, w, v, u, t, s, r, q, p, o, n, m, l, k, j, i, h, g, f, e, d, c, b, a]</code></pre></div></div><div class="paragraph"><p>Here you can see that <code>o</code> translates to <code>l</code>, <code>h</code> translates to <code>s</code>, and so on.</p></div><div class="paragraph"><p>Of course, you can use more fancy translations, like:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">groovy:000&gt; "Lorem ipsum dolor sit amet".tr("a-zA-Z", "@-:a-[")===&gt; [[[&lt;\ `[[[\ =[][[ [`[ @\&lt;[</code></pre></div></div><div class="paragraph"><p>In this case replacement <code>@-:a-[</code> translates to combination of two ranges: <code>@-:</code>, and <code>a-[</code> which generates a list of the following characters:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">groovy:000&gt; ('@'..':').toList() + ('a'..'[').toList()===&gt; [@, ?, &gt;, =, &lt;, ;, :, a, `, _, ^, ], \, []</code></pre></div></div><div class="paragraph"><p>As you can see, the <code>tr</code> method does not invent anything new. You could achieve something similar with regular expressions but less simply.</p></div></div></div><div class="sect1"><h2 id="bonus-string-countcharsequence">Bonus: <code>String.count(charSequence)</code></h2><div class="sectionbody"><div class="paragraph"><p>One more cool method I discovered quite recently thanks to one question posted on the <a href="https://groovycommunity.com/" target="_blank" rel="noopener">Groovy Community Slack</a>. Groovy String API has one handy yet straightforward method - <code>count(charSequence)</code>. This method allows you to quickly discover how many occurrences of the given characters sequence exist in the input string. You can count single letters, as well as substrings, in a pretty efficient way.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">groovy:000&gt; "Lorem ipsum dolor sit amet".count("o")===&gt; 3groovy:000&gt; "Lorem ipsum dolor sit amet".count("or")===&gt; 2groovy:000&gt; "Lorem ipsum dolor sit amet".count("abc")===&gt; 0</code></pre></div></div><div class="paragraph"><p>Those small things make your life <span class="mark">Groovier</span>! <span class="icon"><i class="fa fa-smile-o"></i></span></p></div></div></div><div class="sect1"><h2 id="conclusion">Conclusion</h2><div class="sectionbody"><div class="paragraph"><p>This ranking only scratched the surface of useful Groovy string methods. I hope you have learned something new from this blog post, but I also encourage you to share feedback. What is your favorite string related method, that makes your life Groovy? <span class="icon"><i class="fa fa-smile-o"></i></span> Let&#8217;s create the Readers Choice Ranking containing other useful methods that were missing in today&#8217;s blog post. I can&#8217;t wait to see your suggestions!</p></div></div></div>]]></content>
    
    <summary type="html">
    
      &lt;div class=&quot;paragraph&quot;&gt;&lt;p&gt;Groovy String API offers many useful methods to make working with strings much more pleasant. Today I would like to show you three, not so very popular, yet convenient methods. Let&amp;#8217;s jump straight into it! &lt;span class=&quot;icon&quot;&gt;&lt;i class=&quot;fa fa-smile-o&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;
    
    </summary>
    
    
      <category term="Groovy Cookbook" scheme="https://e.printstacktrace.blog/categories/groovy-cookbook/"/>
    
    
      <category term="groovy" scheme="https://e.printstacktrace.blog/tags/groovy/"/>
    
      <category term="string" scheme="https://e.printstacktrace.blog/tags/string/"/>
    
  </entry>
  
  <entry>
    <title>Using Jenkins Pipeline parallel stages to build Maven project with different JDKs</title>
    <link href="https://e.printstacktrace.blog/using-jenkins-pipeline-parallel-stages-to-build-maven-project-with-different-jdks/"/>
    <id>https://e.printstacktrace.blog/using-jenkins-pipeline-parallel-stages-to-build-maven-project-with-different-jdks/</id>
    <published>2019-11-28T20:53:10.000Z</published>
    <updated>2019-11-28T20:53:10.000Z</updated>
    
    <content type="html"><![CDATA[<div class="paragraph"><p>In one of <a href="/building-java-and-maven-docker-images-using-parallelized-jenkins-pipeline-and-sdkman/" title="the latest blog posts">the latest blog posts</a>, I have shown you how you can build a Docker image with Java and Maven installed with the SDKMAN! command-line tool. Today I would like to continue the topic and show you, how you can compile your project using two different Java versions in parallel.</p></div><a id="more"></a><div class="sect1"><h2 id="using-dockerfile-agent">Using <code>dockerfile</code> agent</h2><div class="sectionbody"><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">Sample Maven application used in this article can be found here - <a href="https://github.com/wololock/simple-java-maven-app" target="_blank" rel="noopener" class="bare">https://github.com/wololock/simple-java-maven-app</a>.</td></tr></table></div><div class="paragraph"><p>To keep the example simple, I&#8217;m going to use Jenkins Pipeline&#8217;s <code>dockerfile</code> <a href="https://jenkins.io/doc/book/pipeline/syntax/#agent" target="_blank" rel="noopener">agent</a>. It executes given pipeline stage (or stages) in a docker container that gets started from a docker image created using local Dockerfile.</p></div><div class="listingblock"><div class="title">Listing 1. Dockerfile.build (<a href="https://github.com/wololock/simple-java-maven-app/blob/master/Dockerfile.build" target="_blank" rel="noopener">source</a>)</div><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-lang="dockerfile">FROM debian:stretch-slim# Defining default Java and Maven versionARG JAVA_VERSION="8.0.232-open"ARG MAVEN_VERSION="3.6.3"# Defining default non-root user UID, GID, and nameARG USER_UID="1000"ARG USER_GID="1000"ARG USER_NAME="jenkins"# Creating default non-userRUN groupadd -g $USER_GID $USER_NAME &amp;&amp; \   useradd -m -g $USER_GID -u $USER_UID $USER_NAME# Installing basic packagesRUN apt-get update &amp;&amp; \   apt-get install -y zip unzip curl &amp;&amp; \   rm -rf /var/lib/apt/lists/* &amp;&amp; \   rm -rf /tmp/*# Switching to non-root user to install SDKMAN!USER $USER_UID:$USER_GID# Downloading SDKMAN!RUN curl -s "https://get.sdkman.io" | bash# Installing Java and Maven, removing some unnecessary SDKMAN filesRUN bash -c "source $HOME/.sdkman/bin/sdkman-init.sh &amp;&amp; \    yes | sdk install java $JAVA_VERSION &amp;&amp; \    yes | sdk install maven $MAVEN_VERSION &amp;&amp; \    rm -rf $HOME/.sdkman/archives/* &amp;&amp; \    rm -rf $HOME/.sdkman/tmp/*"ENV MAVEN_HOME="/home/jenkins/.sdkman/candidates/maven/current"ENV JAVA_HOME="/home/jenkins/.sdkman/candidates/java/current"ENV PATH="$MAVEN_HOME/bin:$JAVA_HOME/bin:$PATH"</code></pre></div></div><div class="paragraph"><p>The Jenkins Pipeline contains two stages - <strong>Build</strong>, and <strong>Install</strong>. The <strong>Build</strong> stage has two parallel stages inside. The first one compiles the Maven project using OpenJDK 8, while the second one uses OpenJDK 11. Keep in mind that this is just an illustration. You could use the same approach to compile your project using e.g., two different Maven versions, or different JDK vendors.</p></div></div></div><div class="sect1"><h2 id="a-pipeline-with-the-parallel-java-8-and-java-11">A pipeline with the parallel Java 8 and Java 11</h2><div class="sectionbody"><div class="paragraph"><p>You have seen the Dockerfile we are going to use to create the build environment docker image. Here is the pipeline&#8217;s <code>Jenkinsfile</code>.</p></div><div class="listingblock"><div class="title">Listing 2. Jenkinsfile (<a href="https://github.com/wololock/simple-java-maven-app/blob/master/Jenkinsfile" target="_blank" rel="noopener">source</a>)</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">pipeline {    environment {        DOCKERFILE = "Dockerfile.build"    }    stages {        stage("Build") {            environment {                MVN_COMMAND = "mvn clean package"                TEST_REPORTS = "target/surefire-reports/*.xml"            }            parallel {                stage("openjdk-8.0.232") {                    agent {                        dockerfile { <i class="conum" data-value="1"></i><b>(1)</b>                            filename DOCKERFILE <i class="conum" data-value="2"></i><b>(2)</b>                            additionalBuildArgs "--build-arg JAVA_VERSION=8.0.232-open -t maven:8.0.232-open" <i class="conum" data-value="3"></i><b>(3)</b>                        }                    }                    steps {                        sh "${MVN_COMMAND} -P jdk8" <i class="conum" data-value="4"></i><b>(4)</b>                    }                    post {                        always {                            junit TEST_REPORTS                        }                    }                }                stage("openjdk-11.0.5") {                    agent {                        dockerfile {                            filename DOCKERFILE                            additionalBuildArgs "--build-arg JAVA_VERSION=11.0.5-open -t maven:11.0.5-open"                        }                    }                    steps {                        sh "${MVN_COMMAND} -P jdk11"                    }                    post {                        always {                            junit TEST_REPORTS                        }                    }                }            }        }        stage("Install") {            agent {                dockerfile {                    filename DOCKERFILE                    additionalBuildArgs "--build-arg JAVA_VERSION=8.0.232-open"                    args '-v $HOME/.m2/repository:/home/jenkins/.m2/repository:rw,z' <i class="conum" data-value="5"></i><b>(5)</b>                }            }            steps {                sh "mvn -DskipTests install -P jdk8"            }        }    }}</code></pre></div></div><div class="paragraph"><p>In this example, I used the Declarative Pipeline script. Each parallel stage inside the <strong>Build</strong> stage uses <em class="conum" data-value="1"></em> the <code>dockerfile</code> <a href="https://jenkins.io/doc/book/pipeline/syntax/#agent" target="_blank" rel="noopener">agent</a>. The Dockerfile name is specified <em class="conum" data-value="2"></em> using environment variable <code>DOCKERFILE</code> which stores the <code>Dockerfile.build</code> name. We also pass the additional build arguments <em class="conum" data-value="3"></em> - a <code>JAVA_VERSION</code> one especially. In the <em class="conum" data-value="4"></em> Maven build command we add a specific profile like <code>jdk8</code> and <code>jdk11</code> to configure the Maven compiler plugin accordingly to the Java version.</p></div><div class="paragraph"><p>The <strong>Install</strong> stage we use OpenJDK 8 only. This stage also uses the <code>dockerfile</code> agent, but this time <em class="conum" data-value="5"></em> we mount <code>~/.m2/repository</code> from the docker host to the container, so the installed artifact will be persisted on the Jenkins node.</p></div></div></div><div class="sect1"><h2 id="executing-the-pipeline">Executing the pipeline</h2><div class="sectionbody"><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/jenkins-pipeline-maven-parallel.png"><img src="/images/jenkins-pipeline-maven-parallel.png" alt="jenkins pipeline maven parallel"></a></div></div></div></div></div></div>]]></content>
    
    <summary type="html">
    
      &lt;div class=&quot;paragraph&quot;&gt;&lt;p&gt;In one of &lt;a href=&quot;/building-java-and-maven-docker-images-using-parallelized-jenkins-pipeline-and-sdkman/&quot; title=&quot;the latest blog posts&quot;&gt;the latest blog posts&lt;/a&gt;, I have shown you how you can build a Docker image with Java and Maven installed with the SDKMAN! command-line tool. Today I would like to continue the topic and show you, how you can compile your project using two different Java versions in parallel.&lt;/p&gt;&lt;/div&gt;
    
    </summary>
    
    
      <category term="Jenkins Pipeline Cookbook" scheme="https://e.printstacktrace.blog/categories/jenkins-pipeline-cookbook/"/>
    
    
      <category term="java" scheme="https://e.printstacktrace.blog/tags/java/"/>
    
      <category term="docker" scheme="https://e.printstacktrace.blog/tags/docker/"/>
    
      <category term="sdkman" scheme="https://e.printstacktrace.blog/tags/sdkman/"/>
    
      <category term="maven" scheme="https://e.printstacktrace.blog/tags/maven/"/>
    
      <category term="jenkins" scheme="https://e.printstacktrace.blog/tags/jenkins/"/>
    
      <category term="jenkins-pipeline" scheme="https://e.printstacktrace.blog/tags/jenkins-pipeline/"/>
    
      <category term="cicd" scheme="https://e.printstacktrace.blog/tags/cicd/"/>
    
  </entry>
  
  <entry>
    <title>Quicksort in Groovy - can it be as fast as implemented in Java?</title>
    <link href="https://e.printstacktrace.blog/quicksort-in-groovy-can-it-be-as-fast-as-implemented-in-java/"/>
    <id>https://e.printstacktrace.blog/quicksort-in-groovy-can-it-be-as-fast-as-implemented-in-java/</id>
    <published>2019-11-24T14:11:55.000Z</published>
    <updated>2019-11-24T14:11:55.000Z</updated>
    
    <content type="html"><![CDATA[<div class="paragraph"><p>I started reading <a href="https://amzn.to/2vZIxC3" target="_blank" rel="noopener" class="ga-track"><em>&quot;Cracking the Coding Interview, 6th Edition&quot;</em></a> book recently and it inspired me to experiment a bit. It&#8217;s been a while since I implemented the quicksort algorithm the last time, and I did that in Haskell. I remember some old and imperative implementations in Java, but I never tried to implement it in Groovy. Let&#8217;s give it a try! <span class="icon"><i class="fa fa-smile-o"></i></span></p></div><a id="more"></a><div class="sect1"><h2 id="quicksort-in-groovy">Quicksort in Groovy</h2><div class="sectionbody"><div class="paragraph"><p>The simplest implementation of the Quicksort algorithm in Groovy may look like this.</p></div><div class="listingblock"><div class="title">Listing 1. quicksort.groovy</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import groovy.transform.CompileStatic@CompileStatic&lt;T extends Comparable&gt; List&lt;T&gt; quicksort(final List&lt;T&gt; list) {    if (list.size() &lt;= 1) { <i class="conum" data-value="1"></i><b>(1)</b>        return list    }    final pivot = list.head() <i class="conum" data-value="2"></i><b>(2)</b>    final split = list.tail().split { el -&gt; el &lt; pivot } <i class="conum" data-value="3"></i><b>(3)</b>    return quicksort(split.get(0)) + [pivot] + quicksort(split.get(1)) <i class="conum" data-value="4"></i><b>(4)</b>}</code></pre></div></div><div class="paragraph"><p>The implementation is clean and simple. <em class="conum" data-value="1"></em> For any list of size equal or lower than <code>1</code>, it returns the input list. Otherwise, it takes the first element <em class="conum" data-value="2"></em> using <code>list.head()</code> method, and splits the remaining list <em class="conum" data-value="3"></em> into two list  the first that contains elements that are lower than the <code>pivot</code> value, and the second that contains elements that are equal to or greater than the <code>pivot</code> value. Then it recursively calls <code>quicksort</code> on both lists <em class="conum" data-value="4"></em>.</p></div><div class="paragraph"><p>We can run <code>groovysh</code> now to test this function with a few exemplary data sets.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ groovysh quicksortExamples.groovyGroovy Shell (2.5.8, JVM: 1.8.0_201)Type ':help' or ':h' for help.---------------------------------------------------------------------------------------------------groovy:000&gt; quicksort([])===&gt; []groovy:000&gt; quicksort([1])===&gt; [1]groovy:000&gt; quicksort([0,1])===&gt; [0, 1]groovy:000&gt; quicksort([1,0])===&gt; [0, 1]groovy:000&gt; random = new Random()===&gt; java.util.Random@64337702groovy:000&gt; list = (1..20).collect { random.nextInt(100) }===&gt; [9, 19, 41, 13, 66, 28, 12, 79, 71, 43, 6, 50, 56, 24, 84, 88, 38, 82, 36, 80]groovy:000&gt; quicksort(list)===&gt; [6, 9, 12, 13, 19, 24, 28, 36, 38, 41, 43, 50, 56, 66, 71, 79, 80, 82, 84, 88]groovy:000&gt;</code></pre></div></div></div></div><div class="sect1"><h2 id="the-benchmark">The benchmark</h2><div class="sectionbody"><div class="paragraph"><p>The implementation of the <code>quicksort</code> function in Groovy looks good. It&#8217;s short, clean, and simple. The only question is  is it efficient?</p></div><div class="paragraph"><p>We can measure it with a simple "benchmark". I haven&#8217;t use JMH on purpose here, I wanted to keep everything in a single Groovy script file. I decided to implement a simple benchmark-like test that measures computation time (in milliseconds.)</p></div><div class="listingblock"><div class="title">Listing 2. quicksort.groovy</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import groovy.transform.CompileStaticimport groovy.transform.Fieldimport java.util.stream.Collectorsimport java.util.stream.IntStream@CompileStatic&lt;T extends Comparable&gt; List&lt;T&gt; quicksort(final List&lt;T&gt; list) {    if (list.size() &lt;= 1) {        return list    }    final pivot = list.head()    final split = list.tail().split { el -&gt; el &lt; pivot }    return quicksort(split.get(0)) + [pivot] + quicksort(split.get(1))}@Fieldstatic final Random random = new Random()@CompileStaticprivate static List&lt;List&lt;Integer&gt;&gt; randomData(int numberOfLists, int listSize) {    return IntStream.range(0, numberOfLists)        .boxed()        .parallel()        .map { (1..listSize).collect { random.nextInt(1000) } }        .collect(Collectors.toList())}@CompileStaticlong iteration(int iterations, int size) {    final List&lt;List&lt;Integer&gt;&gt; lists = randomData(iterations, size)    final List&lt;List&lt;Integer&gt;&gt; sorted = new ArrayList&lt;&gt;(lists.size())    long start = System.currentTimeMillis()    for (List&lt;Integer&gt; it : lists) {        sorted.add(quicksort(it))    }    long time = System.currentTimeMillis() - start    println("Sorted in ${time} ms")    assert sorted.every { list -&gt; ((List) list).toSorted() == list &amp;&amp; ((List) list).size() == size }    return time}@CompileStaticvoid benchmark() {    final int iterations = 1000    final int randomListSize = 1000    final int repeat = 100    final int warmup = 40    final List&lt;Long&gt; times = (1..repeat).collect { iteration(iterations, randomListSize) }.drop(warmup)    println ("-" * 40)    println "Average: ${(times.sum() as double) / times.size()} ms"    println "Min: ${times.min()} ms"    println "Max: ${times.max()} ms"    println "Median: ${times.sort().get((times.size() / 2).toInteger())} ms"}benchmark()</code></pre></div></div><div class="paragraph"><p>This benchmark repeats a total of 1000 iterations 100 times. The first 40 repetitions are dropped  we treat them as a JVM warmup. Every repeated iteration produces a list of one thousand lists of one thousand random integers. Then it iterates and sorts each list of random numbers. The total time needed to sort all one thousand lists is recorder and printed out to console. The benchmark code also verifies if the <code>quicksort</code> implementation works  at the end of every iteration it checks if every list returned by the <code>quicksort</code> method is sorted.</p></div><div class="paragraph"><p>Running <code>quicksort.groovy</code> script produces the output similar to this one.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">$ groovy quicksort.groovySorted in 1315 msSorted in 1046 msSorted in 930 msSorted in 1077 msSorted in 943 msSorted in 952 msSorted in 949 msSorted in 919 msSorted in 943 msSorted in 927 msSorted in 936 msSorted in 932 msSorted in 972 msSorted in 979 msSorted in 976 msSorted in 982 msSorted in 978 msSorted in 944 msSorted in 922 msSorted in 921 msSorted in 926 msSorted in 922 msSorted in 927 msSorted in 924 msSorted in 987 msSorted in 930 msSorted in 919 msSorted in 926 msSorted in 930 msSorted in 923 msSorted in 923 msSorted in 928 msSorted in 917 msSorted in 976 msSorted in 986 msSorted in 985 msSorted in 978 msSorted in 993 msSorted in 975 msSorted in 936 msSorted in 929 msSorted in 932 msSorted in 923 msSorted in 920 msSorted in 921 msSorted in 917 msSorted in 929 msSorted in 927 msSorted in 927 msSorted in 919 msSorted in 962 msSorted in 939 msSorted in 933 msSorted in 931 msSorted in 925 msSorted in 933 msSorted in 961 msSorted in 930 msSorted in 924 msSorted in 924 msSorted in 921 msSorted in 928 msSorted in 935 msSorted in 918 msSorted in 922 msSorted in 942 msSorted in 918 msSorted in 927 msSorted in 1018 msSorted in 982 msSorted in 930 msSorted in 923 msSorted in 923 msSorted in 922 msSorted in 926 msSorted in 994 msSorted in 1020 msSorted in 1004 msSorted in 1000 msSorted in 1007 msSorted in 1007 msSorted in 1004 msSorted in 1009 msSorted in 995 msSorted in 1005 msSorted in 1007 msSorted in 1003 msSorted in 991 msSorted in 988 msSorted in 995 msSorted in 987 msSorted in 919 msSorted in 925 msSorted in 920 msSorted in 918 msSorted in 933 msSorted in 927 msSorted in 932 msSorted in 921 msSorted in 926 ms----------------------------------------Average: 949.6333333333333 msMin: 917 msMax: 1020 msMedian: 930 ms</code></pre></div></div><div class="paragraph"><p>It looks like sorting one thousand lists of one thousand random numbers with Groovy <code>quicksort</code> takes <strong>~930 milliseconds</strong>. It feels like it is slow, but to decide if this is true or false, we need to compare it with something. Let&#8217;s implement using imperative Java code and see how efficient it is.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content"><strong>ATTENTION</strong>: The goal of those benchmark tests is not to get specific and exact results, but rather to find an order of magnitude.</td></tr></table></div></div></div><div class="sect1"><h2 id="quicksort-in-java">Quicksort in Java</h2><div class="sectionbody"><div class="listingblock"><div class="title">Listing 3. Java.java</div><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.util.ArrayList;import java.util.List;public final class Java {    public static &lt;T extends Comparable&gt; List&lt;T&gt; quicksort(final List&lt;T&gt; list) {        if (list.size() &lt;= 1) {            return list;        }        final List&lt;T&gt; left = new ArrayList&lt;&gt;(list.size() - 1);        final List&lt;T&gt; right = new ArrayList&lt;&gt;(list.size() - 1);        final T pivot = list.get(0);        for (T el : list.subList(1, list.size())) {            if (pivot.compareTo(el) &gt;= 0) {                left.add(el);            } else {                right.add(el);            }        }        final List&lt;T&gt; result = new ArrayList&lt;&gt;(list.size());        result.addAll(quicksort(left));        result.add(pivot);        result.addAll(quicksort(right));        return result;    }}</code></pre></div></div><div class="paragraph"><p>Here is the same algorithm implemented using imperative Java. We can replace <code>quicksort(it)</code> method invocation inside the <code>iteration</code> method to <code>Java.quicksort(it)</code>.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">$ groovyc -j Java.java quicksort.groovyNote: /home/wololock/workspace/groovy-sandbox/src/Java.java uses unchecked or unsafe operations.Note: Recompile with -Xlint:unchecked for details.$ groovy quicksortSorted in 342 msSorted in 249 msSorted in 218 msSorted in 241 msSorted in 214 msSorted in 210 msSorted in 289 msSorted in 202 msSorted in 212 msSorted in 202 msSorted in 196 msSorted in 294 msSorted in 201 msSorted in 198 msSorted in 198 msSorted in 215 msSorted in 204 msSorted in 197 msSorted in 212 msSorted in 208 msSorted in 197 msSorted in 219 msSorted in 207 msSorted in 200 msSorted in 204 msSorted in 201 msSorted in 201 msSorted in 204 msSorted in 213 msSorted in 198 msSorted in 204 msSorted in 213 msSorted in 198 msSorted in 208 msSorted in 213 msSorted in 198 msSorted in 202 msSorted in 204 msSorted in 196 msSorted in 205 msSorted in 196 msSorted in 205 msSorted in 208 msSorted in 195 msSorted in 208 msSorted in 208 msSorted in 197 msSorted in 211 msSorted in 213 msSorted in 198 msSorted in 200 msSorted in 211 msSorted in 196 msSorted in 200 msSorted in 217 msSorted in 199 msSorted in 201 msSorted in 220 msSorted in 200 msSorted in 200 msSorted in 217 msSorted in 197 msSorted in 200 msSorted in 204 msSorted in 206 msSorted in 197 msSorted in 204 msSorted in 210 msSorted in 198 msSorted in 204 msSorted in 211 msSorted in 200 msSorted in 203 msSorted in 197 msSorted in 203 msSorted in 205 msSorted in 199 msSorted in 201 msSorted in 203 msSorted in 198 msSorted in 204 msSorted in 208 msSorted in 216 msSorted in 205 msSorted in 202 msSorted in 214 msSorted in 204 msSorted in 201 msSorted in 211 msSorted in 195 msSorted in 208 msSorted in 215 msSorted in 198 msSorted in 202 msSorted in 197 msSorted in 194 msSorted in 200 msSorted in 198 msSorted in 193 msSorted in 203 ms----------------------------------------Average: 203.46666666666667 msMin: 193 msMax: 220 msMedian: 203 ms</code></pre></div></div><div class="paragraph"><p>We can see that Java implementation is approximately <strong>4 times faster</strong> than the Groovy one.</p></div></div></div><div class="sect1"><h2 id="can-groovy-do-better-than-930-ms">Can Groovy do better than <code>~930 ms</code>?</h2><div class="sectionbody"><div class="paragraph"><p>I started wondering what makes Groovy slower compared to Java, and if it possible to make Groovy code faster? What would Groovy do with an imperative code similar to the Java one? Let&#8217;s give it a shot. I added the <code>quicksortImperative</code> method to <code>quicksort.groovy</code> and put it inside the <code>iteration</code> method to measure its efficiency.</p></div><div class="listingblock"><div class="title">Listing 4. quicksort.groovy</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@CompileStatic&lt;T extends Comparable&gt; List&lt;T&gt; quicksortImperative(final List&lt;T&gt; list) {    if (list.size() &lt;= 1) {        return list;    }    final List&lt;T&gt; left = (List&lt;T&gt;) new ArrayList&lt;T&gt;(list.size() - 1);    final List&lt;T&gt; right = (List&lt;T&gt;) new ArrayList&lt;T&gt;(list.size() - 1);    final T pivot = list.get(0);    for (T el : list.subList(1, list.size())) {        if (pivot.compareTo(el) &gt;= 0) {            left.add(el);        } else {            right.add(el);        }    }    final List&lt;T&gt; result = new ArrayList&lt;&gt;(list.size());    result.addAll(quicksortImperative(left));    result.add(pivot);    result.addAll(quicksortImperative(right));    return result;}</code></pre></div></div><div class="paragraph"><p>And here is the benchmark result.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">$ groovy quicksortSorted in 341 msSorted in 260 msSorted in 224 msSorted in 242 msSorted in 222 msSorted in 210 msSorted in 292 msSorted in 208 msSorted in 224 msSorted in 212 msSorted in 212 msSorted in 308 msSorted in 210 msSorted in 214 msSorted in 209 msSorted in 223 msSorted in 213 msSorted in 208 msSorted in 228 msSorted in 211 msSorted in 208 msSorted in 231 msSorted in 209 msSorted in 208 msSorted in 213 msSorted in 205 msSorted in 209 msSorted in 220 msSorted in 219 msSorted in 212 msSorted in 217 msSorted in 222 msSorted in 215 msSorted in 209 msSorted in 223 msSorted in 209 msSorted in 208 msSorted in 206 msSorted in 201 msSorted in 214 msSorted in 211 msSorted in 223 msSorted in 209 msSorted in 207 msSorted in 224 msSorted in 212 msSorted in 206 msSorted in 212 msSorted in 214 msSorted in 212 msSorted in 208 msSorted in 215 msSorted in 211 msSorted in 206 msSorted in 221 msSorted in 211 msSorted in 205 msSorted in 222 msSorted in 213 msSorted in 207 msSorted in 214 msSorted in 215 msSorted in 213 msSorted in 222 msSorted in 211 msSorted in 213 msSorted in 220 msSorted in 213 msSorted in 217 msSorted in 238 msSorted in 206 msSorted in 205 msSorted in 227 msSorted in 206 msSorted in 208 msSorted in 220 msSorted in 205 msSorted in 210 msSorted in 217 msSorted in 204 msSorted in 209 msSorted in 222 msSorted in 216 msSorted in 221 msSorted in 233 msSorted in 219 msSorted in 225 msSorted in 207 msSorted in 207 msSorted in 205 msSorted in 211 msSorted in 206 msSorted in 205 msSorted in 205 msSorted in 208 msSorted in 202 msSorted in 225 msSorted in 210 msSorted in 203 msSorted in 226 ms----------------------------------------Average: 213.3 msMin: 202 msMax: 238 msMedian: 212 ms</code></pre></div></div><div class="paragraph"><p>Hmm, Groovy imperative code is as fast as the Java one. What makes the Groovy 4-line implementation so much slower compared to this one?</p></div><div class="paragraph"><p>Here is the root cause:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">final split = list.tail().split { el -&gt; el &lt; pivot }</code></pre></div></div><div class="paragraph"><p>If we replace it with the for-each loop presented in the Java imperative example, it runs as fast as Java&#8217;s <code>quicksort</code>. If you read my blog post that <a href="/what-is-the-most-efficient-way-to-iterate-collection-in-groovy-jmh/" title="explains the most efficient iterations in Groovy">explains the most efficient iterations in Groovy</a>, you already know that a for-each loop is one of the most effective ways to iterate collections in both, Groovy and Java. Invoking the <code>list.split(closure)</code> method comes with a price. Here you can see what the call stack looks like when we attach a breakpoint inside the closure body.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/groovy-quicksort-debugger.png"><img src="/images/groovy-quicksort-debugger.png" alt="groovy quicksort debugger"></a></div></div></div></div><div class="paragraph"><p>And here is the imperative equivalent.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/groovy-quicksort-imperative-debugger.png"><img src="/images/groovy-quicksort-imperative-debugger.png" alt="groovy quicksort imperative debugger"></a></div></div></div></div></div></div><div class="sect1"><h2 id="is-the-slower-groovy-quicksort-a-problem">Is the slower Groovy Quicksort a problem?</h2><div class="sectionbody"><div class="paragraph"><p>It depends. For relatively small collections, the difference between Groovy and Java implementations may be barely noticeable. For instance, if we run a single <code>quicksort</code> on a random list of one thousand integers, Java would sort it in <strong>~0.5 ms</strong> while Groovy will need <strong>~1 ms</strong>. If your program would have to process large volumes of data, and you will search for any smallest optimizations, then you would probably go with the Java option. But if you use Groovy in Spock tests, Jenkins pipelines, or even with your Grails application, that handles a relatively small amount of data to process, you don&#8217;t have to rewrite your short and simple Groovy code to get those extra 1-5 milliseconds. The clean code that developers read daily is much more important than that.</p></div><div class="paragraph"><p>What do you think about it? Do you see an area for improvements? Would you implement a <code>quicksort</code> algorithm differently? Please share your thoughts in the comments section down below.</p></div></div></div>]]></content>
    
    <summary type="html">
    
      &lt;div class=&quot;paragraph&quot;&gt;&lt;p&gt;I started reading &lt;a href=&quot;https://amzn.to/2vZIxC3&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot; class=&quot;ga-track&quot;&gt;&lt;em&gt;&amp;quot;Cracking the Coding Interview, 6th Edition&amp;quot;&lt;/em&gt;&lt;/a&gt; book recently and it inspired me to experiment a bit. It&amp;#8217;s been a while since I implemented the quicksort algorithm the last time, and I did that in Haskell. I remember some old and imperative implementations in Java, but I never tried to implement it in Groovy. Let&amp;#8217;s give it a try! &lt;span class=&quot;icon&quot;&gt;&lt;i class=&quot;fa fa-smile-o&quot;&gt;&lt;/i&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;
    
    </summary>
    
    
      <category term="Groovy Cookbook" scheme="https://e.printstacktrace.blog/categories/groovy-cookbook/"/>
    
    
      <category term="groovy" scheme="https://e.printstacktrace.blog/tags/groovy/"/>
    
      <category term="java" scheme="https://e.printstacktrace.blog/tags/java/"/>
    
      <category term="benchmark" scheme="https://e.printstacktrace.blog/tags/benchmark/"/>
    
      <category term="quicksort" scheme="https://e.printstacktrace.blog/tags/quicksort/"/>
    
      <category term="algorithm" scheme="https://e.printstacktrace.blog/tags/algorithm/"/>
    
  </entry>
  
  <entry>
    <title>Using CircleCI to deploy Hexo blog to GitHub Pages - how to set it up?</title>
    <link href="https://e.printstacktrace.blog/using-circleci-to-deploy-hexo-blog-to-github-pages-how-to-set-it-up/"/>
    <id>https://e.printstacktrace.blog/using-circleci-to-deploy-hexo-blog-to-github-pages-how-to-set-it-up/</id>
    <published>2019-11-17T11:25:50.000Z</published>
    <updated>2020-03-28T06:45:27.000Z</updated>
    
    <content type="html"><![CDATA[<div class="paragraph"><p>I was using Travis CI to execute <a href="https://travis-ci.org/wololock/wololock.github.io/builds" target="_blank" rel="noopener">271 builds</a> and deployments of this blog. Last Friday, I decided to experiment with <a href="https://circleci.com/" target="_blank" rel="noopener">CircleCI</a> and see if this could be a viable alternative to my current solution. In this blog post, I explain why I decided to switch, and how to set up CircleCI to deploy Hexo blog to the GitHub Pages without much hustle.</p></div><a id="more"></a><div class="sect1"><h2 id="why-moving-away-from-travis-ci">Why moving away from Travis CI?</h2><div class="sectionbody"><div class="paragraph"><p>Travis CI is a great continuous integration server for any open source project. It&#8217;s <strong>easy</strong> to set up and use. It integrates with many <strong>popular building tools</strong> in a few steps. And the dashboard UI is <strong>clean</strong> and <strong>simple</strong>.</p></div><div class="paragraph"><p>However, I have found two significant reasons to start considering alternative solutions. Firstly, the overall build and deployment times regularly kept increasing. The recent builds took 3 minutes 30 seconds, on average. The main reason for that was the time needed to set up a NodeJS build environment. The same <code>hexo deploy</code> command executed from my local dev environment required less than 40 seconds to complete.</p></div><div class="paragraph"><p>Secondly, Travis CI <strong>does not support SSH keys</strong> for public projects. The only way to push changes back to the GitHub repository is such a circumstance was to use one of the Personal Access Tokens. The token grants write permission to not only your Hexo blog repository but to all repositories your GitHub account has access to. Travis CI encrypts environment variables for security reasons. However, if someone hijacks your token (in one way or another), you are in trouble.</p></div></div></div><div class="sect1"><h2 id="why-circleci">Why CircleCI?</h2><div class="sectionbody"><div class="paragraph"><p>I did some experiments, and it turned out that CircleCI could solve both problems. The build and deploy pipeline runs more than two times faster (1 minute and 30 seconds on average). CircleCI supports SSH keys I could use to grant write permissions to a single GitHub repository.</p></div></div></div><div class="sect1"><h2 id="how-to-set-up-circleci-to-deploy-hexo-blog">How to set up CircleCI to deploy Hexo blog?</h2><div class="sectionbody"><div class="paragraph"><p>Now when you know, what was the reason to migrate to CircleCI, let&#8217;s take a closer look at how to set the pipeline.</p></div><div class="sect2"><h3 id="configuration">Configuration</h3><div class="paragraph"><p>To set up CircleCI, you need to create a file <code>.circleci/config.yml</code> in your root folder. Here is what my configuration looks like.</p></div><div class="listingblock"><div class="title">Listing 1. .circleci/config.yml (<a href="https://github.com/wololock/wololock.github.io/blob/develop/.circleci/config.yml" target="_blank" rel="noopener">source</a>)</div><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">version: 2.1jobs:  build:    docker:      - image: circleci/node:10    steps:      - checkout      - run:          name: Update NPM          command: sudo npm install -g npm@latest      - run:          name: Install Hexo CLI          command: |            sudo npm install hexo-cli -g      - restore_cache:          key: node-cache-{{ checksum "package-lock.json" }}      - run:          name: Install NPM packages          command: npm ci      - save_cache:          key: node-cache-{{ checksum "package-lock.json" }}          paths:            - ./node_modules      - run:          name: Generate blog          command: hexo generate      - persist_to_workspace:          root: public          paths:            - "*"  deploy:    docker:      - image: circleci/node:10    steps:      - checkout      - run:          name: Install Hexo CLI          command: |            sudo npm install hexo-cli -g      - restore_cache:          key: node-cache-{{ checksum "package-lock.json" }}      - attach_workspace:          at: public      - add_ssh_keys:          fingerprints:            - "1d:0c:ea:28:8a:4f:f0:5d:98:e1:ca:93:0f:38:d6:ab"      - deploy:          name: Deploy website          command: |            git config --global user.name "Circle CI"            git config --global user.email "bot@circleci.com"            sh deploy.sh  verify:    docker:      - image: circleci/node:10    steps:      - run:          name: Install BLC          command: sudo npm install -g broken-link-checker      - run:          name: Check broken internal links          command: blc https://e.printstacktrace.blog -roeworkflows:  version: 2  build:    jobs:      - build:          filters:            branches:              ignore:                - master                - gh-pages      - deploy:          requires:            - build          filters:            branches:              only: develop      - verify:          requires:            - deploy</code></pre></div></div><div class="paragraph"><p>There are two jobs I defined in the pipeline  the build job, and the deploy job. The first one gets executed on every commit. It installs all required dependencies in the container and generates the Hexo blog from the source code. It also uses the <code>persist_to_workspace</code> step. We use it to attach persisted workspace in the "deploy" job.</p></div><div class="paragraph"><p>The second job performs the deployment. It gets executed only from the <code>develop</code> branch, and it requires the "Build" job to succeed first. Here we also use a fingerprint of the SSH key used to authenticate with the GitHub repository.</p></div></div></div></div><div class="sect1"><h2 id="what-ssh-key-to-use">What SSH key to use?</h2><div class="sectionbody"><div class="paragraph"><p>Don&#8217;t use your personal SSH key. Generate a new one with an <code>ssh-keygen</code> tool instead.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ssh-keygen -t rsa -m PEM -C "bot@github.com" -f github_rsaGenerating public/private rsa key pair.Enter passphrase (empty for no passphrase):Enter same passphrase again:Your identification has been saved in github_rsa.Your public key has been saved in github_rsa.pub.The key fingerprint is:SHA256:L94u73iniguI1ohlvraM1dYz8DUAf42PUbYxuFLB0Zw bot@github.comThe key's randomart image is:+---[RSA 3072]----+|    .  .o*=.     ||     o  +=E+     ||      o.+.o      ||      .o.+       ||  o .  .S .      ||.=oo + . o       ||oo+.+ = . .      ||.+.o . =.+. .    ||..+.  o.+B*o     |+----[SHA256]-----+</code></pre></div></div><div class="paragraph"><p>After running the command, files <code>github_rsa</code> (private key) and <code>github_rsa.pub</code> get created.</p></div></div></div><div class="sect1"><h2 id="setting-up-circleci-ssh-permissions">Setting up CircleCI SSH permissions</h2><div class="sectionbody"><div class="paragraph"><p>Go to your CircleCI project settings. You will find the "SSH Permissions" page under the "Permissions" label on the left side. Click on the "Add SSH Key" button. For the hostname, use <code>github.com</code> and paste your newly generated private key.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/circleci-new-ssh-key.jpg"><img src="/images/circleci-new-ssh-key.jpg" alt="circleci new ssh key"></a></div></div></div></div><div class="paragraph"><p>After adding the key, you will see its fingerprint on the SSH keys list.</p></div></div></div><div class="sect1"><h2 id="setting-up-github-deployment-key">Setting up GitHub deployment key</h2><div class="sectionbody"><div class="paragraph"><p>Go to your GitHub project&#8217;s settings page, and then go to "Deploy keys" section. Click on the "Add deploy key" button located in the top right corner. Use something like "CircleCI Deployer" in the title field, and paste your public key to the text area. Also, don&#8217;t forget to check the "Allow write access" checkbox.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/circleci-github-deploy-key.jpg"><img src="/images/circleci-github-deploy-key.jpg" alt="circleci github deploy key"></a></div></div></div></div></div></div><div class="sect1"><h2 id="how-to-skip-master-or-gh-pages-branches">How to skip <code>master</code> or <code>gh-pages</code> branches?</h2><div class="sectionbody"><div class="paragraph"><p>We are not done yet. If you run the CircleCI pipeline, you will see that the changes pushed back to the <code>master</code> branch executed the build, and it failed. You need to know that the branch that stores the generated blog does not contain any CircleCI configuration file. To stop building the <code>master</code> branch, we need to put the configuration file into that branch as well.</p></div><div class="paragraph"><p>Let&#8217;s start by creating a simple configuration that ignores the <code>master</code> branch. Here is the <code>source/.circleci/config.yml</code> file we want to put into the branch.</p></div><div class="listingblock"><div class="title">Listing 2. source/.circleci/config.yml (<a href="https://github.com/wololock/wololock.github.io/blob/develop/source/.circleci/config.yml" target="_blank" rel="noopener">source</a>)</div><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">version: 2jobs:  build:    branches:      ignore: master    docker:      - image: circleci/node:10    steps:      - run:          command: echo 1</code></pre></div></div><div class="paragraph"><p>We are almost there. As the last step, we need to update Hexo&#8217;s configuration file. Without extra configuration, Hexo would skip generating files from the hidden directories. Also, we need to turn off rendering YAML files to JSON files. Add the following two options to your <code>_config.yml</code> file.</p></div><div class="listingblock"><div class="title">Listing 3. _config.yml (<a href="https://github.com/wololock/wololock.github.io/blob/develop/_config.yml#L33-L36" target="_blank" rel="noopener">source</a>)</div><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">skip_render:  - ".circleci/*"include:  - ".circleci/config.yml"</code></pre></div></div><div class="paragraph"><p>There is one last thing we need to do. Hexo&#8217;s Git deployer ignores hidden files by default. We need to change that, so the <code>.circleci/config.yml</code> file can be deployed to GitHub.</p></div><div class="listingblock"><div class="title">Listing 4. _config.yml (<a href="https://github.com/wololock/wololock.github.io/blob/develop/_config.yml#L93-L97" target="_blank" rel="noopener">source</a>)</div><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">deploy:  type: git  repo: git@github.com:wololock/wololock.github.io.git  branch: master  <strong>ignore_hidden: false</strong></code></pre></div></div><div class="paragraph"><p>And that&#8217;s it. We can commit changes and add our GitHub repository as a project in the CircleCI.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/circleci-workflow.jpg"><img src="/images/circleci-workflow.jpg" alt="circleci workflow"></a></div></div></div></div><div class="paragraph"><p>And that&#8217;s it! You are ready to deploy the Hexo blog through CircleCI continuous integration server.</p></div></div></div>]]></content>
    
    <summary type="html">
    
      &lt;div class=&quot;paragraph&quot;&gt;&lt;p&gt;I was using Travis CI to execute &lt;a href=&quot;https://travis-ci.org/wololock/wololock.github.io/builds&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;271 builds&lt;/a&gt; and deployments of this blog. Last Friday, I decided to experiment with &lt;a href=&quot;https://circleci.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CircleCI&lt;/a&gt; and see if this could be a viable alternative to my current solution. In this blog post, I explain why I decided to switch, and how to set up CircleCI to deploy Hexo blog to the GitHub Pages without much hustle.&lt;/p&gt;&lt;/div&gt;
    
    </summary>
    
    
      <category term="How to" scheme="https://e.printstacktrace.blog/categories/how-to/"/>
    
    
      <category term="hexo" scheme="https://e.printstacktrace.blog/tags/hexo/"/>
    
      <category term="blogging" scheme="https://e.printstacktrace.blog/tags/blogging/"/>
    
      <category term="github" scheme="https://e.printstacktrace.blog/tags/github/"/>
    
      <category term="cicd" scheme="https://e.printstacktrace.blog/tags/cicd/"/>
    
      <category term="circleci" scheme="https://e.printstacktrace.blog/tags/circleci/"/>
    
      <category term="travisci" scheme="https://e.printstacktrace.blog/tags/travisci/"/>
    
      <category term="npm" scheme="https://e.printstacktrace.blog/tags/npm/"/>
    
  </entry>
  
  <entry>
    <title>Building Java and Maven docker images using parallelized Jenkins Pipeline and SDKMAN!</title>
    <link href="https://e.printstacktrace.blog/building-java-and-maven-docker-images-using-parallelized-jenkins-pipeline-and-sdkman/"/>
    <id>https://e.printstacktrace.blog/building-java-and-maven-docker-images-using-parallelized-jenkins-pipeline-and-sdkman/</id>
    <published>2019-11-11T21:28:10.000Z</published>
    <updated>2019-11-13T08:54:22.000Z</updated>
    
    <content type="html"><![CDATA[<div class="paragraph"><p>In <a href="/using-sdkman-as-a-docker-image-for-jenkins-pipeline-a-step-by-step-guide/" title="the last article">the last article</a>, I have shown you how you can build a docker image for Jenkins Pipeline using <a href="https://sdkman.io" target="_blank" rel="noopener">SDKMAN!</a> command-line tool. Today I will show you how you can build multiple different docker images using parallelized <a href="https://jenkins.io/doc/book/pipeline/getting-started/" target="_blank" rel="noopener">Jenkins Pipeline</a>.</p></div><a id="more"></a><div class="sect1"><h2 id="why-maven-and-java">Why Maven and Java?</h2><div class="sectionbody"><div class="paragraph"><p>Before we move forward, let me explain why I use Maven and Java docker image in this example. There is <a href="https://hub.docker.com/_/maven" target="_blank" rel="noopener">an official Maven docker hub repository</a> where you can download a specific Maven base image based on a particular Java version. It makes sense because you cannot use Maven without Java. However, this might become a bottleneck if you want to create your custom image (e.g., you need to install some additional tools that are missing in the official Maven image), and support different Maven versions at the same time. That is why we want to use a single <code>Dockerfile</code> to build, let&#8217;s say, three images with different Java inside  Amazon Corretto 11, Azul Zulu 13, and GraalVM CE 19.2.1.</p></div></div></div><div class="sect1"><h2 id="dockerfile">Dockerfile</h2><div class="sectionbody"><div class="paragraph"><p>Here is the <code>Dockerfile</code> we have prepared in the previous blog post.</p></div><div class="listingblock"><div class="title">Listing 1. Dockerfile</div><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-lang="dockerfile">FROM debian:stretch-slim# Defining default Java and Maven versionARG JAVA_VERSION="11.0.5-amzn"ARG MAVEN_VERSION="3.6.2"# Defining default non-root user UID, GID, and nameARG USER_UID="1000"ARG USER_GID="1000"ARG USER_NAME="jenkins"# Creating default non-userRUN groupadd -g $USER_GID $USER_NAME &amp;&amp; \useradd -m -g $USER_GID -u $USER_UID $USER_NAME# Installing basic packagesRUN apt-get update &amp;&amp; \apt-get install -y zip unzip curl &amp;&amp; \rm -rf /var/lib/apt/lists/* &amp;&amp; \rm -rf /tmp/*# Switching to non-root user to install SDKMAN!USER $USER_UID:$USER_GID# Downloading SDKMAN!RUN curl -s "https://get.sdkman.io" | bash# Installing Java and Maven, removing some unnecessary SDKMAN filesRUN bash -c "source $HOME/.sdkman/bin/sdkman-init.sh &amp;&amp; \    yes | sdk install java $JAVA_VERSION &amp;&amp; \    yes | sdk install maven $MAVEN_VERSION &amp;&amp; \    rm -rf $HOME/.sdkman/archives/* &amp;&amp; \    rm -rf $HOME/.sdkman/tmp/*"ENTRYPOINT bash -c "source $HOME/.sdkman/bin/sdkman-init.sh &amp;&amp; $0 $@"</code></pre></div></div><div class="paragraph"><p>We specify <code>JAVA_VERSION</code> and <code>MAVEN_VERSION</code> using <code>ARG</code> for one important reason  we want to allow overriding those values using <code>--build-arg</code> command-line parameter.</p></div></div></div><div class="sect1"><h2 id="jenkins-pipeline">Jenkins Pipeline</h2><div class="sectionbody"><div class="paragraph"><p>We are going to build three docker images containing different Java distribution. We could hardcode all different variants inside the Jenkins Pipeline code, but it could make the maintenance more problematic. It would be much better if we decouple the Jenkins Pipeline logic from the version variants we want to build ultimately. We could use YAML to declare all the images we want to build in the pipeline.</p></div><div class="listingblock"><div class="title">Listing 2. versions.yml</div><div class="content"><pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">images:  "3.6-amazoncorretto-11":    java: 11.0.5-amzn    maven: 3.6.2    tags:      - 3.6.2-amazoncorretto-11.0.5      - 3.6-amazoncorretto-11  "3.6-zulu-13":    java: 13.0.1-zulu    maven: 3.6.2    tags:      - 3.6.2-zulu-13.0.1      - 3.6-zulu-13      - latest  "3.6-graalvm-19":    java: 19.2.1-grl    maven: 3.6.2    tags:      - 3.6.2-graalvm-19.2.1      - 3.6-graalvm-19</code></pre></div></div><div class="paragraph"><p>The format for this file is straightforward. We define a Java version, Maven version, and a list of docker tags we want to use for each specific variant.</p></div><div class="paragraph"><p>Having docker image variants decoupled from the pipeline, we can now implement a simple Jenkins Pipeline that will build those images in parallel.</p></div><div class="listingblock"><div class="title">Listing 3. Jenkinsfile</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">pipeline {    agent any    environment {        IMAGE_NAME = "mymaven" <i class="conum" data-value="1"></i><b>(1)</b>    }    stages {        stage("Build docker images") {            steps {                script {                    def versions = readYaml file: "versions.yml" <i class="conum" data-value="2"></i><b>(2)</b>                    def stages = versions.images.collectEntries { label, props -&gt; <i class="conum" data-value="3"></i><b>(3)</b>                        [(label): {                            stage(label) {                                sh """docker build \                                --build-arg JAVA_VERSION=${props.java} \                                --build-arg MAVEN_VERSION=${props.maven} \                                ${collectTags(props.tags, env.IMAGE_NAME)} \                                .                            """                            }                        }]                    }                    parallel stages <i class="conum" data-value="4"></i><b>(4)</b>                }            }        }    }}@NonCPSString collectTags(final List&lt;String&gt; tags, final String imageName) {    return tags.collect { tag -&gt; "-t ${imageName}:${tag}" }.join(" ")}</code></pre></div></div><div class="paragraph"><p>This pipeline has only a single stage that executes three nested stages in parallel. Each parallelized stage is responsible for building and tagging one specific variant of <code>mymaven</code> docker image <em class="conum" data-value="1"></em>. We use <code>readYaml</code> pipeline utility step to read images configuration from the <code>versions.yml</code> file <em class="conum" data-value="2"></em>. Then we construct the stage for every image <em class="conum" data-value="3"></em> to run in parallel <em class="conum" data-value="4"></em>.</p></div><div class="paragraph"><p>When we execute this pipeline, we get something like this.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/sdkman-docker-pipeline.png"><img src="/images/sdkman-docker-pipeline.png" alt="sdkman docker pipeline"></a></div></div></div></div><div class="paragraph"><p>Every parallel stage has built a different docker image variant.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 3.6-amazoncorretto-11 stage:+ docker build --build-arg JAVA_VERSION=11.0.5-amzn --build-arg MAVEN_VERSION=3.6.2 -t mymaven:3.6.2-amazoncorretto-11.0.5 -t mymaven:3.6-amazoncorretto-11 .# 3.6-graalvm-19 stage:+ docker build --build-arg JAVA_VERSION=19.2.1-grl --build-arg MAVEN_VERSION=3.6.2 -t mymaven:3.6.2-graalvm-19.2.1 -t mymaven:3.6-graalvm-19 .# 3.6-zulu-13 stage:+ docker build --build-arg JAVA_VERSION=13.0.1-zulu --build-arg MAVEN_VERSION=3.6.2 -t mymaven:3.6.2-zulu-13.0.1 -t mymaven:3.6-zulu-13 -t mymaven:latest .</code></pre></div></div><div class="paragraph"><p>We can list existing <code>mymaven</code> docker images.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker images | grep mymavenmymaven            3.6-graalvm-19                32a1ea1dc8ee        38 minutes ago      1.01 GBmymaven            3.6.2-graalvm-19.2.1          32a1ea1dc8ee        38 minutes ago      1.01 GBmymaven            3.6-zulu-13                   8553ca3e7556        41 minutes ago      439 MBmymaven            3.6.2-zulu-13.0.1             8553ca3e7556        41 minutes ago      439 MBmymaven            latest                        8553ca3e7556        41 minutes ago      439 MBmymaven            3.6-amazoncorretto-11         1d38b0879ab0        5 days ago          407 MBmymaven            3.6.2-amazoncorretto-11.0.5   1d38b0879ab0        5 days ago          407 MB</code></pre></div></div><div class="paragraph"><p>And as the final step, we can execute <code>mvn -version</code> from each docker image to verify that everything worked.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"><strong>$ docker run --rm -u $(id -u) <span class="mark">mymaven:3.6-amazoncorretto-11</span> mvn -version</strong>Apache Maven 3.6.2 (40f52333136460af0dc0d7232c0dc0bcf0d9e117; 2019-08-27T15:06:16Z)Maven home: /home/jenkins/.sdkman/candidates/maven/currentJava version: 11.0.5, vendor: Amazon.com Inc., runtime: /home/jenkins/.sdkman/candidates/java/11.0.5-amznDefault locale: en_US, platform encoding: ANSI_X3.4-1968OS name: "linux", version: "5.3.8-200.fc30.x86_64", arch: "amd64", family: "unix"<strong>$ docker run --rm -u $(id -u) <span class="mark">mymaven:3.6-graalvm-19</span> mvn -version</strong>Apache Maven 3.6.2 (40f52333136460af0dc0d7232c0dc0bcf0d9e117; 2019-08-27T15:06:16Z)Maven home: /home/jenkins/.sdkman/candidates/maven/currentJava version: 1.8.0_232, vendor: Oracle Corporation, runtime: /home/jenkins/.sdkman/candidates/java/19.2.1-grl/jreDefault locale: en_US, platform encoding: ANSI_X3.4-1968OS name: "linux", version: "5.3.8-200.fc30.x86_64", arch: "amd64", family: "unix"<strong>$ docker run --rm -u $(id -u) <span class="mark">mymaven:3.6-zulu-13</span> mvn -version</strong>Apache Maven 3.6.2 (40f52333136460af0dc0d7232c0dc0bcf0d9e117; 2019-08-27T15:06:16Z)Maven home: /home/jenkins/.sdkman/candidates/maven/currentJava version: 13.0.1, vendor: Azul Systems, Inc., runtime: /home/jenkins/.sdkman/candidates/java/13.0.1-zuluDefault locale: en_US, platform encoding: ANSI_X3.4-1968OS name: "linux", version: "5.3.8-200.fc30.x86_64", arch: "amd64", family: "unix"</code></pre></div></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">You can download the source code presented in this blog post from the following Github repository  <a href="https://github.com/wololock/sdkman-docker-pipeline-example" target="_blank" rel="noopener" class="bare">https://github.com/wololock/sdkman-docker-pipeline-example</a>.</td></tr></table></div></div></div><div class="sect1"><h2 id="conclusion">Conclusion</h2><div class="sectionbody"><div class="paragraph"><p>That&#8217;s all for today. The pipeline I have shown you could be extended to run some parallelized smoke tests, and publish generated docker images to some remote hub. But this is maybe a subject for another story. Let me know what do you think about this blog post in the comments section down below. See you next time!</p></div></div></div>]]></content>
    
    <summary type="html">
    
      &lt;div class=&quot;paragraph&quot;&gt;&lt;p&gt;In &lt;a href=&quot;/using-sdkman-as-a-docker-image-for-jenkins-pipeline-a-step-by-step-guide/&quot; title=&quot;the last article&quot;&gt;the last article&lt;/a&gt;, I have shown you how you can build a docker image for Jenkins Pipeline using &lt;a href=&quot;https://sdkman.io&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;SDKMAN!&lt;/a&gt; command-line tool. Today I will show you how you can build multiple different docker images using parallelized &lt;a href=&quot;https://jenkins.io/doc/book/pipeline/getting-started/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Jenkins Pipeline&lt;/a&gt;.&lt;/p&gt;&lt;/div&gt;
    
    </summary>
    
    
      <category term="Jenkins Pipeline Cookbook" scheme="https://e.printstacktrace.blog/categories/jenkins-pipeline-cookbook/"/>
    
    
      <category term="groovy" scheme="https://e.printstacktrace.blog/tags/groovy/"/>
    
      <category term="java" scheme="https://e.printstacktrace.blog/tags/java/"/>
    
      <category term="docker" scheme="https://e.printstacktrace.blog/tags/docker/"/>
    
      <category term="sdkman" scheme="https://e.printstacktrace.blog/tags/sdkman/"/>
    
      <category term="devops" scheme="https://e.printstacktrace.blog/tags/devops/"/>
    
      <category term="maven" scheme="https://e.printstacktrace.blog/tags/maven/"/>
    
      <category term="jenkins" scheme="https://e.printstacktrace.blog/tags/jenkins/"/>
    
      <category term="jenkins-pipeline" scheme="https://e.printstacktrace.blog/tags/jenkins-pipeline/"/>
    
      <category term="cicd" scheme="https://e.printstacktrace.blog/tags/cicd/"/>
    
  </entry>
  
  <entry>
    <title>Using SDKMAN! as a docker image for Jenkins Pipeline - a step by step guide</title>
    <link href="https://e.printstacktrace.blog/using-sdkman-as-a-docker-image-for-jenkins-pipeline-a-step-by-step-guide/"/>
    <id>https://e.printstacktrace.blog/using-sdkman-as-a-docker-image-for-jenkins-pipeline-a-step-by-step-guide/</id>
    <published>2019-11-06T18:34:01.000Z</published>
    <updated>2019-11-06T18:34:01.000Z</updated>
    
    <content type="html"><![CDATA[<div class="paragraph"><p>A few days ago, I was struggling with some Docker images I use in my Jenkins CI environment. I run some Jenkins Pipelines, and I like to define build environment as code using custom Docker images. Everything was fine until I had to consider running different Java or Maven versions. I decided to use one of my favorite command-line tools - <a href="https://sdkman.io/" target="_blank" rel="noopener">SDKMAN!</a>, to build a highly configurable build environment.</p></div><a id="more"></a><div class="paragraph"><p>Let&#8217;s get directly into the details, and let&#8217;s start with defining a simple <code>Dockerfile</code> that installs SDKMAN! and expected Java and Maven versions.</p></div><div class="sect1"><h2 id="dockerfile">Dockerfile</h2><div class="sectionbody"><div class="listingblock"><div class="title">Listing 1. Dockerfile</div><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-lang="dockerfile">FROM debian:stretch-slim <i class="conum" data-value="1"></i><b>(1)</b># Defining default Java and Maven version <i class="conum" data-value="2"></i><b>(2)</b>ARG JAVA_VERSION="11.0.6-amzn"ARG MAVEN_VERSION="3.6.2"# Defining default non-root user UID, GID, and name <i class="conum" data-value="3"></i><b>(3)</b>ARG USER_UID="1000"ARG USER_GID="1000"ARG USER_NAME="jenkins"# Creating default non-user <i class="conum" data-value="4"></i><b>(4)</b>RUN groupadd -g $USER_GID $USER_NAME &amp;&amp; \useradd -m -g $USER_GID -u $USER_UID $USER_NAME# Installing basic packages <i class="conum" data-value="5"></i><b>(5)</b>RUN apt-get update &amp;&amp; \apt-get install -y zip unzip curl &amp;&amp; \rm -rf /var/lib/apt/lists/* &amp;&amp; \rm -rf /tmp/*# Switching to non-root user to install SDKMAN! <i class="conum" data-value="6"></i><b>(6)</b>USER $USER_UID:$USER_GID# Downloading SDKMAN! <i class="conum" data-value="7"></i><b>(7)</b>RUN curl -s "https://get.sdkman.io" | bash# Installing Java and Maven, removing some unnecessary SDKMAN files <i class="conum" data-value="8"></i><b>(8)</b>RUN bash -c "source $HOME/.sdkman/bin/sdkman-init.sh &amp;&amp; \    yes | sdk install java $JAVA_VERSION &amp;&amp; \    yes | sdk install maven $MAVEN_VERSION &amp;&amp; \    rm -rf $HOME/.sdkman/archives/* &amp;&amp; \    rm -rf $HOME/.sdkman/tmp/*"</code></pre></div></div><div class="paragraph"><p><em class="conum" data-value="1"></em> I use <code>debian:stretch-slim</code> in this example - a small 55 MB base docker image. It&#8217;s not the smallest available docker image, but it will work fine in our experiment. In our example, we will be using <a href="https://aws.amazon.com/corretto/" target="_blank" rel="noopener">Amazon Corretto JDK 11.0.6</a> - a distribution of OpenJDK from Amazon.com. We also want to install Maven 3.6.2 so we can run some <code>mvn clean install</code> command in the Jenkins Pipeline. We define both <em class="conum" data-value="2"></em> using <code>ARG</code> instruction<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> so we can easily override default versions from the command line.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker build --build-arg JAVA_VERSION=8.0.232-amzn ...</code></pre></div></div><div class="paragraph"><p>We are going to run the docker container as a non-root user. We define <em class="conum" data-value="3"></em> default <code>USER_UID</code>, <code>USER_GID</code> and <code>USER_NAME</code> using <code>ARG</code> instruction, and we create <em class="conum" data-value="4"></em> the user, his group and home directory. SDKMAN! requires tools like <code>curl</code>, <code>zip</code> and <code>unzip</code> - we need to install them <em class="conum" data-value="5"></em>.</p></div><div class="paragraph"><p>Before we install SDKMAN!, we are switching to our non-root user <em class="conum" data-value="6"></em> and we are ready to install SDKMAN! using <code>curl</code> <em class="conum" data-value="7"></em>. Th last step we need to do is to run <code>sdkman-init.sh</code> script and install expected Java and Maven <em class="conum" data-value="8"></em>.</p></div><div class="paragraph"><p>That&#8217;s our Dockerfile. Let&#8217;s build <code>sdkman:local</code> Docker image.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker build -t sdkman:local .</code></pre></div></div><div class="paragraph"><p>Let&#8217;s run the container in the interactive mode (<code>-it</code>) and attach a <code>bash</code> process:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"><strong>$ docker run -it --rm  -u $(id -u) sdkman:local bash</strong>jenkins@1c06914cb5ce:/<strong>$ java -version</strong>openjdk version "11.0.6" 2020-01-14 LTSOpenJDK Runtime Environment Corretto-11.0.6.10.1 (build 11.0.6+10-LTS)OpenJDK 64-Bit Server VM Corretto-11.0.6.10.1 (build 11.0.6+10-LTS, mixed mode)jenkins@1c06914cb5ce:/<strong>$ mvn -version</strong>Apache Maven 3.6.2 (40f52333136460af0dc0d7232c0dc0bcf0d9e117; 2019-08-27T15:06:16Z)Maven home: /home/jenkins/.sdkman/candidates/maven/currentJava version: 11.0.6, vendor: Amazon.com Inc., runtime: /home/jenkins/.sdkman/candidates/java/11.0.6-amznDefault locale: en_US, platform encoding: ANSI_X3.4-1968OS name: "linux", version: "5.5.10-100.fc30.x86_64", arch: "amd64", family: "unix"</code></pre></div></div><div class="paragraph"><p>It works like a charm! It&#8217;s time to set up a Jenkins Pipeline.</p></div></div></div><div class="sect1"><h2 id="jenkins-pipeline">Jenkins Pipeline</h2><div class="sectionbody"><div class="paragraph"><p>Let&#8217;s start by defining a simple Jenkins Pipeline.</p></div><div class="listingblock"><div class="title">Listing 2. Jenkinsfile</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">pipeline {    agent {        docker {            image "sdkman:local" <i class="conum" data-value="1"></i><b>(1)</b>        }    }    stages {        stage("Build") {            steps {                sh "java -version" <i class="conum" data-value="2"></i><b>(2)</b>                sh "mvn -version" <i class="conum" data-value="3"></i><b>(3)</b>            }        }    }}</code></pre></div></div><div class="paragraph"><p>We start slowly. Firstly, we configure a docker agent that will start a container from our <code>sdkman:local</code> docker image <em class="conum" data-value="1"></em>. Secondly, we define a single <code>Build</code> stage and we want to verify if running Java <em class="conum" data-value="2"></em> and Maven <em class="conum" data-value="3"></em> are working. We run the pipeline and we see:</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/jenkins-pipeline-sdkman-fail.png"><img src="/images/jenkins-pipeline-sdkman-fail.png" alt="jenkins pipeline sdkman fail"></a></div></div></div></div><div class="paragraph"><p>The pipeline cannot found <code>java</code>? What? We just tested it with <code>docker run &#8230;&#8203; bash</code> and it worked! We look at the console log, we see that Jenkins docker agent spawned the right container. What&#8217;s the problem then?</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">Started by user Szymon StepniakRunning in Durability level: MAX_SURVIVABILITY[Pipeline] Start of Pipeline[Pipeline] nodeRunning on Jenkins in /home/wololock/.jenkins/workspace/pipeline-with-sdkman[Pipeline] {[Pipeline] sh+ docker inspect -f . sdkman:local.[Pipeline] withDockerContainerJenkins does not seem to be running inside a container$ docker run -t -d -u 1000:1000 -w /home/wololock/.jenkins/workspace/pipeline-with-sdkman -v /home/wololock/.jenkins/workspace/pipeline-with-sdkman:/home/wololock/.jenkins/workspace/pipeline-with-sdkman:rw,z -v /home/wololock/.jenkins/workspace/pipeline-with-sdkman@tmp:/home/wololock/.jenkins/workspace/pipeline-with-sdkman@tmp:rw,z -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** sdkman:local cat$ docker top 064e63fd3795df643c4a7f676421b15ade9ae126f10efc6d3383509f7213c04b -eo pid,comm[Pipeline] {[Pipeline] stage[Pipeline] { (Build)[Pipeline] sh+ java -version/home/wololock/.jenkins/workspace/pipeline-with-sdkman@tmp/durable-ff41de0e/script.sh: 1: /home/wololock/.jenkins/workspace/pipeline-with-sdkman@tmp/durable-ff41de0e/script.sh: java: not found[Pipeline] }[Pipeline] // stage[Pipeline] }$ docker stop --time=1 064e63fd3795df643c4a7f676421b15ade9ae126f10efc6d3383509f7213c04b$ docker rm -f 064e63fd3795df643c4a7f676421b15ade9ae126f10efc6d3383509f7213c04b[Pipeline] // withDockerContainer[Pipeline] }[Pipeline] // node[Pipeline] End of PipelineERROR: script returned exit code 127Finished: FAILURE</code></pre></div></div><div class="paragraph"><p>What we missed? Could it be the entrypoint<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup>? In our <code>docker run &#8230;&#8203; bash</code> test we have executed Bash shell and the <code>.bashrc</code> script was executed, which added SDKMAN! candidates to the <code>PATH</code> environment variable. Let&#8217;s try to run <code>java -version</code> directly from the docker container and let&#8217;s see what happens:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"><strong>$ docker run --rm -u $(id -u) sdkman:local java -version</strong>container_linux.go:247: starting container process caused "exec: \"java\": executable file not found in $PATH"/usr/bin/docker-current: Error response from daemon: oci runtime error: container_linux.go:247: starting container process caused "exec: \"java\": executable file not found in $PATH".</code></pre></div></div><div class="paragraph"><p>OK, this is something. It looks like executing <code>java -version</code> without starting Bash shell makes <code>java</code> command missing in the <code>PATH</code> env variable. Let&#8217;s try to fix it by adding a simple <code>ENTRYPOINT</code> to our Dockerfile. For simplicity, we will use a command instead of a script file.</p></div><div class="listingblock"><div class="title">Listing 3. Dockerfile</div><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-lang="dockerfile">FROM debian:stretch-slim# Defining default Java and Maven versionARG JAVA_VERSION="11.0.6-amzn"ARG MAVEN_VERSION="3.6.2"# Defining default non-root user UID, GID, and nameARG USER_UID="1000"ARG USER_GID="1000"ARG USER_NAME="jenkins"# Creating default non-userRUN groupadd -g $USER_GID $USER_NAME &amp;&amp; \useradd -m -g $USER_GID -u $USER_UID $USER_NAME# Installing basic packagesRUN apt-get update &amp;&amp; \apt-get install -y zip unzip curl &amp;&amp; \rm -rf /var/lib/apt/lists/* &amp;&amp; \rm -rf /tmp/*# Switching to non-root user to install SDKMAN!USER $USER_UID:$USER_GID# Downloading SDKMAN!RUN curl -s "https://get.sdkman.io" | bash# Installing Java and Maven, removing some unnecessary SDKMAN filesRUN bash -c "source $HOME/.sdkman/bin/sdkman-init.sh &amp;&amp; \    yes | sdk install java $JAVA_VERSION &amp;&amp; \    yes | sdk install maven $MAVEN_VERSION &amp;&amp; \    rm -rf $HOME/.sdkman/archives/* &amp;&amp; \    rm -rf $HOME/.sdkman/tmp/*"ENTRYPOINT bash -c "source $HOME/.sdkman/bin/sdkman-init.sh &amp;&amp; $0 $@" <i class="conum" data-value="1"></i><b>(1)</b></code></pre></div></div><div class="paragraph"><p>In this example, we make sure that <code>sdkman-init.sh</code> script gets executed before any command triggered on the container. We can rebuild the docker image and try to run <code>java -version</code> again.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"><strong>$ docker build -t sdkman:local .</strong>Sending build context to Docker daemon 3.584 kBStep 1/12 : FROM debian:stretch-slim ---> c2f145c34384Step 2/12 : ARG JAVA_VERSION="11.0.6-amzn" ---> Using cache ---> 6a3e406a9502Step 3/12 : ARG MAVEN_VERSION="3.6.2" ---> Using cache ---> 15764ee0855aStep 4/12 : ARG USER_UID="1000" ---> Using cache ---> a69f8849b91eStep 5/12 : ARG USER_GID="1000" ---> Using cache ---> e58afc8d231fStep 6/12 : ARG USER_NAME="jenkins" ---> Using cache ---> 4b12ba6ffbb2Step 7/12 : RUN groupadd -g $USER_GID $USER_NAME && useradd -m -g $USER_GID -u $USER_UID $USER_NAME ---> Using cache ---> 4de53350c4bfStep 8/12 : RUN apt-get update && apt-get install -y zip unzip curl && rm -rf /var/lib/apt/lists/\* && rm -rf /tmp/\* ---> Using cache ---> a3aaaeb15bdaStep 9/12 : USER $USER_UID:$USER_GID ---> Using cache ---> b39d53a9c785Step 10/12 : RUN curl -s "https://get.sdkman.io" | bash ---> Using cache ---> 205c93608b5eStep 11/12 : RUN bash -c "source $HOME/.sdkman/bin/sdkman-init.sh &&     yes | sdk install java $JAVA_VERSION &&     yes | sdk install maven $MAVEN_VERSION &&     rm -rf $HOME/.sdkman/archives/\* &&     rm -rf $HOME/.sdkman/tmp/\*" ---> Using cache ---> 1b4af7eec712Step 12/12 : ENTRYPOINT bash -c "source $HOME/.sdkman/bin/sdkman-init.sh && $0 $@" ---> Using cache ---> 1d38b0879ab0Successfully built 1d38b0879ab0<strong>$ docker run --rm -u $(id -u) sdkman:local java -version</strong>openjdk version "11.0.6" 2020-01-14 LTSOpenJDK Runtime Environment Corretto-11.0.6.10.1 (build 11.0.6+10-LTS)OpenJDK 64-Bit Server VM Corretto-11.0.6.10.1 (build 11.0.6+10-LTS, mixed mode)</code></pre></div></div><div class="paragraph"><p>Now, this is what we expect! We can run <code>java</code> and <code>mvn</code> commands without running Bash shell. We should be ready to go with the Jenkins Pipeline. Let&#8217;s restart it and see what happens.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/jenkins-pipeline-sdkman-fail-again.png"><img src="/images/jenkins-pipeline-sdkman-fail-again.png" alt="jenkins pipeline sdkman fail again"></a></div></div></div></div><div class="paragraph"><p>The same <code>java: not found</code> error&#8230;&#8203;</p></div></div></div><div class="sect1"><h2 id="how-to-fix-java-not-found-error-in-jenkins-pipeline">How to fix <code>java: not found</code> error in Jenkins Pipeline?</h2><div class="sectionbody"><div class="paragraph"><p>Why does the Jenkins Pipeline <code>sh</code> step fail to execute <code>java</code> command in our pipeline? The main reason why <code>java</code> cannot be found is that the <code>PATH</code> environment variable seems to be missing SDKMAN! candidates. Here is what the <code>PATH</code> of the <code>sdkman:local</code> docker container looks like:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"><strong>$ docker run --rm -u $(id -u) sdkman:local printenv | grep PATH</strong>PATH=/home/jenkins/.sdkman/candidates/maven/current/bin:/home/jenkins/.sdkman/candidates/java/current/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</code></pre></div></div><div class="paragraph"><p>And here is what the <code>PATH</code> variable looks like when we call <code>printenv</code> using <code>sh</code> pipeline step:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[Pipeline] sh+ printenv+ grep PATHCLASSPATH=PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</code></pre></div></div><div class="paragraph"><p>There are at least two known issues<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup><sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup> that seem to make updating <code>PATH</code> environment variable impossible.</p></div><div class="paragraph"><p>But what if I tell you that there is a solution to that problem? There are some workarounds, but their main problem is that they require specifying additional <code>PATH</code> env variable like <code>PATH+EXTRA</code> which means that you need to explicitly prepare yourself for missing <code>PATH</code> locations. I would accept it if there was no other option, but ideally no such workarounds should be necessary. And I have found a way how to do it.</p></div></div></div><div class="sect1"><h2 id="override-path-in-your-dockerfile">Override <code>PATH</code> in your Dockerfile</h2><div class="sectionbody"><div class="paragraph"><p>There is at least one way how you can override <code>PATH</code> variable used by the docker container started in the Jenkins Pipeline. You can do it using <code>ENV</code> instruction in your Dockerfile. We can construct <code>JAVA_HOME</code> and <code>MAVEN_HOME</code> environment variables (we know exactly where SDKMAN! installed both candidates), and then we can use it to override <code>PATH</code> variable. Here is what the final Dockerfile looks like:</p></div><div class="listingblock"><div class="title">Listing 4. Dockerfile</div><div class="content"><pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-lang="dockerfile">FROM debian:stretch-slim# Defining default Java and Maven versionARG JAVA_VERSION="11.0.6-amzn"ARG MAVEN_VERSION="3.6.2"# Defining default non-root user UID, GID, and nameARG USER_UID="1000"ARG USER_GID="1000"ARG USER_NAME="jenkins"# Creating default non-userRUN groupadd -g $USER_GID $USER_NAME &amp;&amp; \useradd -m -g $USER_GID -u $USER_UID $USER_NAME# Installing basic packagesRUN apt-get update &amp;&amp; \apt-get install -y zip unzip curl &amp;&amp; \rm -rf /var/lib/apt/lists/* &amp;&amp; \rm -rf /tmp/*# Switching to non-root user to install SDKMAN!USER $USER_UID:$USER_GID# Downloading SDKMAN!RUN curl -s "https://get.sdkman.io" | bash# Installing Java and Maven, removing some unnecessary SDKMAN filesRUN bash -c "source $HOME/.sdkman/bin/sdkman-init.sh &amp;&amp; \    yes | sdk install java $JAVA_VERSION &amp;&amp; \    yes | sdk install maven $MAVEN_VERSION &amp;&amp; \    rm -rf $HOME/.sdkman/archives/* &amp;&amp; \    rm -rf $HOME/.sdkman/tmp/*"# ENTRYPOINT bash -c "source $HOME/.sdkman/bin/sdkman-init.sh &amp;&amp; $0 $@" <i class="conum" data-value="1"></i><b>(1)</b>ENV MAVEN_HOME="/home/jenkins/.sdkman/candidates/maven/current" <i class="conum" data-value="2"></i><b>(2)</b>ENV JAVA_HOME="/home/jenkins/.sdkman/candidates/java/current" <i class="conum" data-value="3"></i><b>(3)</b>ENV PATH="$MAVEN_HOME/bin:$JAVA_HOME/bin:$PATH" <i class="conum" data-value="4"></i><b>(4)</b></code></pre></div></div><div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>We can remove <code>ENTRYPOINT</code> at the moment.</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Here we define <code>MAVEN_HOME</code> using known Maven location.</td></tr><tr><td><i class="conum" data-value="3"></i><b>3</b></td><td>Here we define <code>JAVA_HOME</code> using known Java location.</td></tr><tr><td><i class="conum" data-value="4"></i><b>4</b></td><td>And last but not least - we override <code>PATH</code> using <code>$MAVEN_HOME/bin</code> and <code>$JAVA_HOME/bin</code>.</td></tr></table></div><div class="paragraph"><p>It&#8217;s time to rebuild the docker image.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ docker build -t sdkman:local .</code></pre></div></div><div class="paragraph"><p>Let&#8217;s check if <code>java -version</code> command works.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"><strong>$ docker run --rm -u $(id -u) sdkman:local java -version</strong>openjdk version "11.0.6" 2020-01-14 LTSOpenJDK Runtime Environment Corretto-11.0.6.10.1 (build 11.0.6+10-LTS)OpenJDK 64-Bit Server VM Corretto-11.0.6.10.1 (build 11.0.6+10-LTS, mixed mode)</code></pre></div></div><div class="paragraph"><p>It works! And now it is the time for the final test. Let&#8217;s restart the pipeline.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/jenkins-pipeline-sdkman-success.png"><img src="/images/jenkins-pipeline-sdkman-success.png" alt="jenkins pipeline sdkman success"></a></div></div></div></div></div></div><div class="sect1"><h2 id="why-even-bother-with-the-sdkman">Why even bother with the SDKMAN?</h2><div class="sectionbody"><div class="paragraph"><p>At this point, you may wonder why you should even consider using SDKMAN! instead of e.g. official Maven Docker image? As always - it depends. If you use a single Java/Maven/Gradle/"you name it" version in all your pipelines, then using one of the official docker images will do the trick for you. However, if you find yourself in a position where you need to run your e.g. Maven builds with different JDKs and different Maven versions, using the official Maven Docker image may become problematic. If you build your Dockerfile from the official Maven image, you are limited to a specific Java version, as well as a specific Maven version. When you want to use two different Maven versions with two different JDKs, you end up with 4 Dockerfiles - each one extends from different <code>maven</code> docker images.</p></div><div class="paragraph"><p>SDKMAN! solves that problem nicely. You can build a single Dockerfile, configure all your custom things in a single place, and you can use <code>ARG</code> instructions to build different versions from the same Dockerfile. Consider the following example.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"><strong>$ docker build -q --build-arg JAVA_VERSION=11.0.5-amzn --build-arg MAVEN_VERSION=3.5.4 -t sdkman:mvn-3.5.4-jdk-11.0.5-amzn .</strong>sha256:fc6006992d79314758b0726f226cc5e87355708b9b7348e89599594b2b881d7c<strong>$ docker build -q --build-arg JAVA_VERSION=11.0.5-amzn --build-arg MAVEN_VERSION=3.6.2 -t sdkman:mvn-3.6.2-jdk-11.0.5-amzn .</strong>sha256:1e1699b478f404c66ed9cf75d122cd941f49e74de3c6e14d25520edfd8fd204b<strong>$ docker build -q --build-arg JAVA_VERSION=13.0.1-zulu --build-arg MAVEN_VERSION=3.5.4 -t sdkman:mvn-3.5.4-jdk-13.0.1-zulu .</strong>sha256:e804b0e7a71bc630d9c590c0e6c714155a7fbc46353b626720f7e53e8e7808c0<strong>$ docker build -q --build-arg JAVA_VERSION=13.0.1-zulu --build-arg MAVEN_VERSION=3.6.2 -t sdkman:mvn-3.6.2-jdk-13.0.1-zulu .</strong>sha256:d08fbd4ef3f889b0739d83d71e1d1f9da9bbf09b5d50d9418b661db6d8be80c7<strong>$ docker run --rm -u $(id -u) sdkman:mvn-3.5.4-jdk-11.0.5-amzn mvn -version</strong>Apache Maven 3.5.4 (1edded0938998edf8bf061f1ceb3cfdeccf443fe; 2018-06-17T18:33:14Z)Maven home: /home/jenkins/.sdkman/candidates/maven/currentJava version: 11.0.5, vendor: Amazon.com Inc., runtime: /home/jenkins/.sdkman/candidates/java/11.0.5-amznDefault locale: en_US, platform encoding: ANSI_X3.4-1968OS name: "linux", version: "5.3.8-200.fc30.x86_64", arch: "amd64", family: "unix"<strong>$ docker run --rm -u $(id -u) sdkman:mvn-3.6.2-jdk-13.0.1-zulu mvn -version</strong>Apache Maven 3.6.2 (40f52333136460af0dc0d7232c0dc0bcf0d9e117; 2019-08-27T15:06:16Z)Maven home: /home/jenkins/.sdkman/candidates/maven/currentJava version: 13.0.1, vendor: Azul Systems, Inc., runtime: /home/jenkins/.sdkman/candidates/java/13.0.1-zuluDefault locale: en_US, platform encoding: ANSI_X3.4-1968OS name: "linux", version: "5.3.8-200.fc30.x86_64", arch: "amd64", family: "unix"</code></pre></div></div><div class="paragraph"><p>In this example, we have built four different docker images from the same Dockerfile. It makes the maintenance of all variants much more straightforward - when something requires fixing, we change a single Dockerfile and rebuild all tags.</p></div></div></div><div class="sect1"><h2 id="thats-all-folks">That&#8217;s all, folks!</h2><div class="sectionbody"><div class="paragraph"><p>I hope you liked this blog post, and you have learned something useful today. Please let me know in the comments section down below if you are interested in Jenkins Pipeline related topics. Expect more blog posts like this one shortly! See you all next time!</p></div></div></div><div id="footnotes"><hr><div class="footnote" id="_footnotedef_1"><a href="#_footnoteref_1">1</a>. <a href="https://docs.docker.com/engine/reference/builder/#arg" target="_blank" rel="noopener" class="bare">https://docs.docker.com/engine/reference/builder/#arg</a></div><div class="footnote" id="_footnotedef_2"><a href="#_footnoteref_2">2</a>. <a href="https://docs.docker.com/engine/reference/builder/#entrypoint" target="_blank" rel="noopener" class="bare">https://docs.docker.com/engine/reference/builder/#entrypoint</a></div><div class="footnote" id="_footnotedef_3"><a href="#_footnoteref_3">3</a>. <a href="https://issues.jenkins-ci.org/browse/JENKINS-45616" target="_blank" rel="noopener" class="bare">https://issues.jenkins-ci.org/browse/JENKINS-45616</a></div><div class="footnote" id="_footnotedef_4"><a href="#_footnoteref_4">4</a>. <a href="https://issues.jenkins-ci.org/browse/JENKINS-41339" target="_blank" rel="noopener" class="bare">https://issues.jenkins-ci.org/browse/JENKINS-41339</a></div></div>]]></content>
    
    <summary type="html">
    
      &lt;div class=&quot;paragraph&quot;&gt;&lt;p&gt;A few days ago, I was struggling with some Docker images I use in my Jenkins CI environment. I run some Jenkins Pipelines, and I like to define build environment as code using custom Docker images. Everything was fine until I had to consider running different Java or Maven versions. I decided to use one of my favorite command-line tools - &lt;a href=&quot;https://sdkman.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;SDKMAN!&lt;/a&gt;, to build a highly configurable build environment.&lt;/p&gt;&lt;/div&gt;
    
    </summary>
    
    
      <category term="Jenkins Pipeline Cookbook" scheme="https://e.printstacktrace.blog/categories/jenkins-pipeline-cookbook/"/>
    
    
      <category term="groovy" scheme="https://e.printstacktrace.blog/tags/groovy/"/>
    
      <category term="java" scheme="https://e.printstacktrace.blog/tags/java/"/>
    
      <category term="docker" scheme="https://e.printstacktrace.blog/tags/docker/"/>
    
      <category term="sdkman" scheme="https://e.printstacktrace.blog/tags/sdkman/"/>
    
      <category term="devops" scheme="https://e.printstacktrace.blog/tags/devops/"/>
    
      <category term="maven" scheme="https://e.printstacktrace.blog/tags/maven/"/>
    
      <category term="jenkins" scheme="https://e.printstacktrace.blog/tags/jenkins/"/>
    
      <category term="jenkins-pipeline" scheme="https://e.printstacktrace.blog/tags/jenkins-pipeline/"/>
    
      <category term="cicd" scheme="https://e.printstacktrace.blog/tags/cicd/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins Pipeline Environment Variables - The Definitive Guide</title>
    <link href="https://e.printstacktrace.blog/jenkins-pipeline-environment-variables-the-definitive-guide/"/>
    <id>https://e.printstacktrace.blog/jenkins-pipeline-environment-variables-the-definitive-guide/</id>
    <published>2019-11-02T17:27:57.000Z</published>
    <updated>2019-11-02T17:27:57.000Z</updated>
    
    <content type="html"><![CDATA[<div class="paragraph"><p>Welcome to the first blog post of the <strong>"Jenkins Pipeline Cookbook"</strong> series. Today we are focus on working with Jenkins Pipeline environment variables effectively. You will learn how to define env variables, how to updated them, and how to use them in boolean expressions correctly.</p></div><a id="more"></a><div id="toc" class="toc"><div id="toctitle" class="title">You can jump directly to...</div><ul class="sectlevel1"><li><a href="#list-environment-variables">List environment variables</a><ul class="sectlevel2"><li><a href="#using-env-vars-html">Using <code>env-vars.html</code></a></li><li><a href="#using-shell-command">Using shell command</a></li></ul></li><li><a href="#reading-environment-variables">Reading environment variables</a></li><li><a href="#setting-environment-variables">Setting environment variables</a></li><li><a href="#overriding-environment-variables">Overriding environment variables</a></li><li><a href="#storing-boolean-values-in-environment-variables">Storing <code>Boolean</code> values in environment variables</a></li><li><a href="#capturing-sh-command-output-in-the-env-variable">Capturing <code>sh</code> command output in the env variable</a></li></ul></div><div class="sect1"><h2 id="list-environment-variables"><a class="anchor" href="#list-environment-variables"></a>List environment variables</h2><div class="sectionbody"><div class="paragraph"><p>Lets start by listing all available environment variables. Two different ways allow you to do so.</p></div><div class="sect2"><h3 id="using-env-vars-html"><a class="anchor" href="#using-env-vars-html"></a>Using <code>env-vars.html</code></h3><div class="paragraph"><p>You can open <code>${YOUR_JENKINS_HOST}/env-vars.html</code> page on your Jenkins master server to get a list of all environment variables listed on an HTML page.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/jenkins-env-vars.png"><img src="/images/jenkins-env-vars.png" alt="jenkins env vars"></a></div></div></div></div></div><div class="sect2"><h3 id="using-shell-command"><a class="anchor" href="#using-shell-command"></a>Using shell command</h3><div class="paragraph"><p>Alternatively, you can list all environment variables by executing the <code>printenv</code> shell command.</p></div><div class="listingblock"><div class="title">Listing 1. Jenkinsfile</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">pipeline {    agent any    stages {        stage("Env Variables") {            steps {                sh "printenv"            }        }    }}</code></pre></div></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">It might be useful to use <code>printenv | sort</code> command combination to get a sorted list of env variables.</td></tr></table></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/jenkins-printenv.png"><img src="/images/jenkins-printenv.png" alt="jenkins printenv"></a></div></div></div></div></div></div></div><div class="sect1"><h2 id="reading-environment-variables"><a class="anchor" href="#reading-environment-variables"></a>Reading environment variables</h2><div class="sectionbody"><div class="paragraph"><p>You can access environment variables in pipeline steps through the <code>env</code> object, e.g., <code>env.BUILD_NUMBER</code> will return the current build number. You can also use a shorthand version <code>BUILD_NUMBER</code>, but in this variant may be confusing to some users - it misses the context that the <code>BUILD_NUMBER</code> comes from the environment variable.</p></div><div class="listingblock"><div class="title">Listing 2. Jenkinsfile</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">pipeline {    agent any    stages {        stage("Env Variables") {            steps {                echo "The build number is ${env.BUILD_NUMBER}"                echo "You can also use \${BUILD_NUMBER} -&gt; ${BUILD_NUMBER}"                sh 'echo "I can access $BUILD_NUMBER in shell command as well."'            }        }    }}</code></pre></div></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/jenkins-read-env-var.png"><img src="/images/jenkins-read-env-var.png" alt="jenkins read env var"></a></div></div></div></div></div></div><div class="sect1"><h2 id="setting-environment-variables"><a class="anchor" href="#setting-environment-variables"></a>Setting environment variables</h2><div class="sectionbody"><div class="paragraph"><p>The environment variables can be set declaratively using <code>environment { }</code> block, imperatively using <code>env.VARIABLE_NAME</code>, or using <code>withEnv(["VARIABLE_NAME=value"]) {}</code> block.</p></div><div class="listingblock"><div class="title">Listing 3. Jenkinsfile</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">pipeline {    agent any    environment {        FOO = "bar"    }    stages {        stage("Env Variables") {            environment {                NAME = "Alan"            }            steps {                echo "FOO = ${env.FOO}"                echo "NAME = ${env.NAME}"                script {                    env.TEST_VARIABLE = "some test value"                }                echo "TEST_VARIABLE = ${env.TEST_VARIABLE}"                withEnv(["ANOTHER_ENV_VAR=here is some value"]) {                    echo "ANOTHER_ENV_VAR = ${env.ANOTHER_ENV_VAR}"                }            }        }    }}</code></pre></div></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/jenkins-set-env-var.png"><img src="/images/jenkins-set-env-var.png" alt="jenkins set env var"></a></div></div></div></div></div></div><div class="sect1"><h2 id="overriding-environment-variables"><a class="anchor" href="#overriding-environment-variables"></a>Overriding environment variables</h2><div class="sectionbody"><div class="paragraph"><p>Jenkins Pipeline supports overriding environment variables. There are a few rules you need to be aware of.</p></div><div class="ulist"><ul><li><p>The <code>withEnv(["env=value]) { }</code> block can override any environment variable.</p></li><li><p>The variables set using <code>environment {}</code> block cannot be overridden using imperative <code>env.VAR = "value"</code> assignment.</p></li><li><p>The imperative <code>env.VAR = "value"</code> assignment can override only environment variables created using imperative assignment.</p></li></ul></div><div class="paragraph"><p>Here is an exemplary Jenkinsfile that shows all three different use cases.</p></div><div class="listingblock"><div class="title">Listing 4. Jenkinsfile</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">pipeline {    agent any    environment {        FOO = "bar"        NAME = "Joe"    }    stages {        stage("Env Variables") {            environment {                NAME = "Alan" // overrides pipeline level NAME env variable                BUILD_NUMBER = "2" // overrides the default BUILD_NUMBER            }            steps {                echo "FOO = ${env.FOO}" // prints "FOO = bar"                echo "NAME = ${env.NAME}" // prints "NAME = Alan"                echo "BUILD_NUMBER =  ${env.BUILD_NUMBER}" // prints "BUILD_NUMBER = 2"                script {                    env.SOMETHING = "1" // creates env.SOMETHING variable                }            }        }        stage("Override Variables") {            steps {                script {                    env.FOO = "IT DOES NOT WORK!" // it can't override env.FOO declared at the pipeline (or stage) level                    env.SOMETHING = "2" // it can override env variable created imperatively                }                echo "FOO = ${env.FOO}" // prints "FOO = bar"                echo "SOMETHING = ${env.SOMETHING}" // prints "SOMETHING = 2"                withEnv(["FOO=foobar"]) { // it can override any env variable                    echo "FOO = ${env.FOO}" // prints "FOO = foobar"                }                withEnv(["BUILD_NUMBER=1"]) {                    echo "BUILD_NUMBER = ${env.BUILD_NUMBER}" // prints "BUILD_NUMBER = 1"                }            }        }    }}</code></pre></div></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/jenkins-override-env-var.png"><img src="/images/jenkins-override-env-var.png" alt="jenkins override env var"></a></div></div></div></div></div></div><div class="sect1"><h2 id="storing-boolean-values-in-environment-variables"><a class="anchor" href="#storing-boolean-values-in-environment-variables"></a>Storing <code>Boolean</code> values in environment variables</h2><div class="sectionbody"><div class="paragraph"><p>There is one popular misconception when it comes to using environment variables. Every value that gets stored as an environment variable gets converted to a <code>String</code>. When you store boolean&#8217;s <code>false</code> value, it gets converted to <code>"false"</code>. If you want to use that value in the boolean expression correctly, you need to call <code>"false".toBoolean()</code> method.<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p></div><div class="listingblock"><div class="title">Listing 5. Jenkinsfile</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">pipeline {    agent any    environment {        IS_BOOLEAN = false    }    stages {        stage("Env Variables") {            steps {                script {                    if (env.IS_BOOLEAN) {                        echo "You can see this message, because \"false\" String evaluates to Boolean.TRUE value"                    }                    if (env.IS_BOOLEAN.toBoolean() == false) {                        echo "You can see this message, because \"false\".toBoolean() returns Boolean.FALSE value"                    }                }            }        }    }}</code></pre></div></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/jenkins-string-env-var.png"><img src="/images/jenkins-string-env-var.png" alt="jenkins string env var"></a></div></div></div></div></div></div><div class="sect1"><h2 id="capturing-sh-command-output-in-the-env-variable"><a class="anchor" href="#capturing-sh-command-output-in-the-env-variable"></a>Capturing <code>sh</code> command output in the env variable</h2><div class="sectionbody"><div class="paragraph"><p>You can also capture output of a shell command as an environment variable. Keep in mind that you need to use <code>sh(script: 'cmd', returnStdout:true)</code> format to force <code>sh</code> step<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> to return an output so it can be captured and stored in a variable.</p></div><div class="listingblock"><div class="title">Listing 6. Jenkinsile</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">pipeline {    agent any    environment {        LS = "${sh(script:'ls -lah', returnStdout: true)}"    }    stages {        stage("Env Variables") {            steps {                echo "LS = ${env.LS}"            }        }    }}</code></pre></div></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/jenkins-sh-in-env-var.png"><img src="/images/jenkins-sh-in-env-var.png" alt="jenkins sh in env var"></a></div></div></div></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">If you want to learn more about <strong>Jenkins</strong> and CI/CD pipelines, check out <a href="https://amzn.to/3b3diVl" target="_blank" rel="noopener" class="ga-track"><em>&quot;Continuous Delivery with Docker and Jenkins&quot;</em></a> book by Rafal Leszko. This book will guide you through the process of setting up continuous delivery pipelines using Jenkins and Docker. Highly recommended!</td></tr></table></div></div></div><div id="footnotes"><hr><div class="footnote" id="_footnotedef_1"><a href="#_footnoteref_1">1</a>. Read more about "The Groovy Truth" here - <a href="https://groovy-lang.org/semantics.html#_strings" target="_blank" rel="noopener" class="bare">https://groovy-lang.org/semantics.html#_strings</a></div><div class="footnote" id="_footnotedef_2"><a href="#_footnoteref_2">2</a>. <a href="https://jenkins.io/doc/pipeline/steps/workflow-durable-task-step/#sh-shell-script" target="_blank" rel="noopener" class="bare">https://jenkins.io/doc/pipeline/steps/workflow-durable-task-step/#sh-shell-script</a></div></div>]]></content>
    
    <summary type="html">
    
      &lt;div class=&quot;paragraph&quot;&gt;&lt;p&gt;Welcome to the first blog post of the &lt;strong&gt;&quot;Jenkins Pipeline Cookbook&quot;&lt;/strong&gt; series. Today we are focus on working with Jenkins Pipeline environment variables effectively. You will learn how to define env variables, how to updated them, and how to use them in boolean expressions correctly.&lt;/p&gt;&lt;/div&gt;
    
    </summary>
    
    
      <category term="Jenkins Pipeline Cookbook" scheme="https://e.printstacktrace.blog/categories/jenkins-pipeline-cookbook/"/>
    
    
      <category term="groovy" scheme="https://e.printstacktrace.blog/tags/groovy/"/>
    
      <category term="jenkins" scheme="https://e.printstacktrace.blog/tags/jenkins/"/>
    
      <category term="jenkins-pipeline" scheme="https://e.printstacktrace.blog/tags/jenkins-pipeline/"/>
    
      <category term="cicd" scheme="https://e.printstacktrace.blog/tags/cicd/"/>
    
      <category term="continuous-integration" scheme="https://e.printstacktrace.blog/tags/continuous-integration/"/>
    
  </entry>
  
  <entry>
    <title>Groovy Trampoline Closure - a step into recursive closures</title>
    <link href="https://e.printstacktrace.blog/groovy-trampoline-closure-a-step-into-recursive-closures/"/>
    <id>https://e.printstacktrace.blog/groovy-trampoline-closure-a-step-into-recursive-closures/</id>
    <published>2019-06-25T11:54:04.000Z</published>
    <updated>2019-06-25T11:54:04.000Z</updated>
    
    <content type="html"><![CDATA[<div class="paragraph"><p>A few weeks ago an interesting question was <a href="https://stackoverflow.com/q/56578937/2194470" target="_blank" rel="noopener">asked on the StackOverflow</a>. Someone experimented with a recursion in Groovy and stepped into <code>Closure.trampoline()</code> <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>. It quickly turned out that using <code>TrampolineClosure</code> makes a recursive execution slower. Is this a valid behavior, or do we do something wrong?</p></div><a id="more"></a><div class="sect1"><h2 id="why-closure-trampoline">Why <code>Closure.trampoline()</code>?</h2><div class="sectionbody"><div class="paragraph"><p>Recursive algorithms in Groovy (or Java in general) are quite tricky. Every recursive call adds a frame to the call stack. If we make too many recursive calls, we can hit the call stack limit and cause <code>StackOverflowError</code>. We used to use recursive method calls, but the same problem applies to recursive closure calls. Consider the following example.</p></div><div class="listingblock"><div class="title">Listing 1. Recursive factorial function defined as a closure</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">def factorialfactorial = { n, acc = 1G -&gt; 1 &gt;= n ? acc : factorial(n - 1, acc * n ) } <i class="conum" data-value="1"></i><b>(1)</b>assert factorial(13) == 6227020800</code></pre></div></div><div class="paragraph"><p>In this simple Groovy snippet we define a recursive closure call <em class="conum" data-value="1"></em> to compute the factorial of a given number. This recursive closure allows me to compute factorial of <code>706</code>, but it hits the <code>StackOverflowError</code> for any number starting from <code>707</code>.</p></div><div class="paragraph"><p>This is where <code>TrampolineClosure</code> comes with a help.</p></div><div class="quoteblock"><blockquote><div class="paragraph"><p>Closures are wrapped in a <code>TrampolineClosure</code>. Upon calling, a trampolined <code>Closure</code> will call the original <code>Closure</code> waiting for its result. If the outcome of the call is another instance of a <code>TrampolineClosure</code>, created perhaps as a result to a call to the <code>trampoline()</code> method, the <code>Closure</code> will again be invoked. This repetitive invocation of returned trampolined <code>Closures</code> instances will continue until a value other than a trampolined <code>Closure</code> is returned. That value will become the final result of the trampoline. That way, calls are made serially, rather than filling the stack.</p><hr>Source: <a href="http://groovy-lang.org/closures.html#_trampoline" target="_blank" rel="noopener" class="bare">http://groovy-lang.org/closures.html#_trampoline</a><p></p></div></blockquote></div><div class="paragraph"><p>The above example refactored to the trampoline version may look like this:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">def factorialfactorial = { n, acc = 1G -&gt; 1 &gt;= n ? acc : factorial.trampoline(n - 1, acc * n ) }.trampoline()assert factorial(13) == 6227020800</code></pre></div></div><div class="paragraph"><p>The <code>TrampolineClosure</code> makes all recursive calls serial, so in this case computing factorial of numbers larger than <code>707</code> is doable.</p></div></div></div><div class="sect1"><h2 id="the-performance">The performance</h2><div class="sectionbody"><div class="paragraph"><p>What about the performance? Running a quick JMH benchmark shows that:</p></div><div class="ulist"><ul><li><p>computing <code>factorial(500)</code> without the trampoline takes <strong>0.111 ms</strong> (in average) on my computer</p></li><li><p>computing <code>factorial(500)</code> with the trampoline takes <strong>0.196 ms</strong> (in average) on my computer</p></li></ul></div><div class="paragraph"><p>For a single call the difference is not huge. However, in the question asked on the StackOverflow we had to deal with a slightly different scenario. The person who asked this question compared the execution time of computing factorial 100,000 times for a pseudo-random number between 0 and 39.</p></div><div class="admonitionblock important"><table><tr><td class="icon"><i class="fa icon-important" title="Important"></i></td><td class="content"><strong>REMEMBER:</strong> The numbers below are just data. To gain reusable insights, you need to follow up on why the numbers are the way they are. Use profilers (see -prof, -lprof), design factorial experiments, perform baseline and negative tests that provide experimental control, make sure the benchmarking environment is safe on JVM/OS/HW level, ask for reviews from the domain experts. Do not assume the numbers tell you what you want them to tell.</td></tr></table></div></div></div><div class="sect1"><h2 id="the-benchmark">The benchmark</h2><div class="sectionbody"><div class="paragraph"><p>I created a benchmark that simulates a very similar scenario. In this test we benchmark the execution of calculating factorial 100,000 time using pseudo-random numbers from range <code>&lt;30,34&gt;</code>. This way we can eliminate anomalies (e.g. calculating <code>factorial(0)</code> or <code>factorial(1)</code>) and prevent JIT compiler from inlining method call with fixed argument.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">You can clone the JMH benchmark test source code from: <a href="https://github.com/wololock/groovy-closure-trampoline-example" target="_blank" rel="noopener" class="bare">https://github.com/wololock/groovy-closure-trampoline-example</a></td></tr></table></div><div class="paragraph"><p>The benchmark tests the following scenarios:</p></div><div class="ulist"><ul><li><p>calculating factorial using recursive closure call,</p></li><li><p>calculating factorial using recursive trampoline closure call,</p></li><li><p>calculating factorial using tail recursive method.</p></li></ul></div><div class="paragraph"><p>Each scenario is tested in the dynamic and statically compiled variant.</p></div><div class="listingblock"><div class="title">Listing 2. JMH benchmark test of a factorial function defined with closures</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">package benchimport groovy.transform.CompileStaticimport groovy.transform.TailRecursiveimport org.openjdk.jmh.annotations.Benchmarkimport org.openjdk.jmh.annotations.Scopeimport org.openjdk.jmh.annotations.State@State(Scope.Benchmark)class FactorialBench {    static final Random random = new Random()    static final int limit = 100000    @Benchmark    void a_standard() {        def factorial        factorial = { n, acc = 1G -&gt; 1 &gt;= n ? acc : factorial(n - 1, acc * n ) }        for (int i = 0; i &lt; limit; i++) {            factorial(30 + random.nextInt(5))        }    }    @Benchmark    @CompileStatic    void a_standard_sc() {        Closure factorial        factorial = { int n, acc = 1G -&gt; 1 &gt;= n ? acc : factorial(n - 1, ((BigInteger) acc) * BigInteger.valueOf((long) n)) }        for (int i = 0; i &lt; limit; i++) {            factorial(30 + random.nextInt(5))        }    }    @Benchmark    void b_trampoline() {        def factorial        factorial = { n, acc = 1G -&gt; 1 &gt;= n ? acc : factorial.trampoline(n - 1, acc * n ) }.trampoline()        for (int i = 0; i &lt; limit; i++) {            factorial(30 + random.nextInt(5))        }    }    @Benchmark    @CompileStatic    void b_trampoline_sc() {        Closure factorial        factorial = { int n, acc = 1G -&gt; 1 &gt;= n ? acc : factorial.trampoline(n - 1, ((BigInteger) acc) * BigInteger.valueOf((long) n)) }.trampoline()        for (int i = 0; i &lt; limit; i++) {            factorial(30 + random.nextInt(5))        }    }    @Benchmark    void c_tailRecursive() {        for (int i = 0; i &lt; limit; i++) {            factorialTailRecursive(30 + random.nextInt(5))        }    }    @Benchmark    @CompileStatic    void c_tailRecursive_sc() {        for (int i = 0; i &lt; limit; i++) {            factorialTailRecursiveSC(30 + random.nextInt(5))        }    }    @TailRecursive    static factorialTailRecursive(n, acc = 1G) {        1 &gt;= n ? acc : factorialTailRecursive(n - 1, n * acc)    }    @TailRecursive    @CompileStatic    static BigInteger factorialTailRecursiveSC(int n, BigInteger acc = 1G) {        1 &gt;= n ? acc : factorialTailRecursiveSC(n - 1, acc * BigInteger.valueOf((long) n))    }}</code></pre></div></div><div class="paragraph"><p>I use JMH Gradle plugin, so executing the following benchmark looks like this:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./gradlew clean jmh --no-daemon</code></pre></div></div></div></div><div class="sect1"><h2 id="the-results">The results</h2><div class="sectionbody"><div class="paragraph"><p>The execution of all benchmark scenarios takes about 8-9 minutes. I run it twice for Groovy 2.5.7 and for Groovy 3.0.0-beta-1 just to check if the upcoming version 3 introduces any performance improvements.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">Laptop specs: JDK 1.8.0_201 (Java HotSpot&#8482; 64-Bit Server VM, 25.201-b09), Groovy 2.5.7, Intel&#174; Core&#8482; i7-4900MQ CPU @ 2.80GHz (4 cores, cache size 8192 KB), 16 GB RAM, OS: Fedora 29 (64 bit)</td></tr></table></div><div class="sect2"><h3 id="1-standard-recursive-closure">1) Standard recursive closure</h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">Benchmark                                 Mode  Cnt     Score   Error  UnitsFactorialBench.a_standard                 avgt   42   472,114  1,315  ms/opFactorialBench.a_standard_sc              avgt   42   428,717  1,063  ms/op</code></pre></div></div><div class="paragraph"><p>This is our starting point. We can see that running statically compiled code is approximately <strong>9%</strong>&nbsp;faster.</p></div><div class="paragraph"><p>And here is the <code>stack</code> profiler output.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">....[Thread state: RUNNABLE]........................................................................ 43,6%  43,6% org.codehaus.groovy.runtime.metaclass.ClosureMetaClass.pickClosureMethod 21,6%  21,6% sun.reflect.DelegatingMethodAccessorImpl.invoke 21,2%  21,2% org.codehaus.groovy.runtime.callsite.PojoMetaMethodSite$PojoCachedMethodSiteNoUnwrap.invoke  5,5%   5,6% groovy.lang.MetaMethod.doMethodInvoke  3,6%   3,6% groovy.lang.MetaClassImpl.invokeMethod  3,1%   3,1% sun.reflect.GeneratedMethodAccessor2.invoke  0,4%   0,4% java.math.BigInteger.multiply  0,3%   0,3% org.codehaus.groovy.runtime.ArrayUtil.createArray  0,2%   0,2% java.util.Arrays.copyOf  0,2%   0,2% java.util.Arrays.copyOfRange  0,4%   0,4% &lt;other&gt;</code></pre></div></div></div><div class="sect2"><h3 id="2-trampoline-closure">2) Trampoline closure</h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">Benchmark                                 Mode  Cnt     Score   Error  UnitsFactorialBench.b_trampoline               avgt   42  1054,703  3,805  ms/opFactorialBench.b_trampoline_sc            avgt   42   683,293  2,191  ms/op</code></pre></div></div><div class="paragraph"><p>The benchmark test shows that the (dynamic) trampoline variant of the factorial function is about <strong>2.23 times</strong> slower compared to the standard recursive closure approach.</p></div><div class="paragraph"><p>Here is the <code>stack</code> profiler output for the trampoline closure variant:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">....[Thread state: RUNNABLE]........................................................................ 22,6%  22,6% org.codehaus.groovy.reflection.ParameterTypes.isValidMethod 21,8%  21,8% org.codehaus.groovy.reflection.ParameterTypes.coerceArgumentsToClasses 15,5%  15,5% org.codehaus.groovy.reflection.ParameterTypes.correctArguments 11,5%  11,5% groovy.lang.Closure.&lt;init&gt;  9,4%   9,4% sun.reflect.DelegatingMethodAccessorImpl.invoke  8,5%   8,5% groovy.lang.TrampolineClosure.&lt;init&gt;  7,1%   7,1% org.codehaus.groovy.runtime.metaclass.ClosureMetaClass.pickClosureMethod  0,4%   0,4% groovy.lang.MetaClassImpl.invokeMethod  0,3%   0,3% org.codehaus.groovy.runtime.callsite.PojoMetaMethodSite$PojoCachedMethodSiteNoUnwrap.invoke  0,3%   0,3% java.math.BigInteger.multiply  2,6%   2,6% &lt;other&gt;</code></pre></div></div><div class="paragraph"><p>There are two major differences between trampoline and the standard recursive closure:</p></div><div class="ulist"><ul><li><p>Creating <code>TrampolineClosure</code> objects for each recursive call comes with a cost. In this specific case it took <strong>210.8 ms</strong> (20% of the total time).</p></li><li><p>Calling <code>Closure.trampoline(args)</code> requires arguments coercion, which takes <strong>~393 ms</strong> (37.3% of the total time).</p></li></ul></div><div class="paragraph"><p>Static compilation helps a bit - it executes in <strong>683.293 ms</strong> average time. If we take a look at the call stack from the profiler, we see that static compilation removed the need of the arguments coercion. The main additional cost comes with the <code>TrampolineClosure</code> objects creation - it takes <strong>185.172 ms</strong> (27,1% of the total time).</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">....[Thread state: RUNNABLE]..................................................................... 29,2%  29,2% org.codehaus.groovy.reflection.ParameterTypes.isValidMethod 24,5%  24,5% java.math.BigInteger.multiply 16,7%  16,7% groovy.lang.Closure.&lt;init&gt; 10,4%  10,4% groovy.lang.TrampolineClosure.&lt;init&gt;  9,8%   9,8% org.codehaus.groovy.runtime.metaclass.ClosureMetaClass.pickClosureMethod  4,0%   4,0% org.codehaus.groovy.runtime.metaclass.MetaMethodIndex.getMethods  2,4%   2,4% org.codehaus.groovy.reflection.ParameterTypes.correctArguments  0,7%   0,7% sun.reflect.GeneratedMethodAccessor1.invoke  0,5%   0,5% groovy.lang.MetaClassImpl.invokeMethod  0,3%   0,3% java.util.Arrays.copyOf  1,3%   1,3% &lt;other&gt;</code></pre></div></div></div><div class="sect2"><h3 id="3-tail-recursive-method">3) Tail recursive method</h3><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">Benchmark                                 Mode  Cnt     Score   Error  UnitsFactorialBench.c_tailRecursive            avgt   42   322,019  1,409  ms/opFactorialBench.c_tailRecursive_sc         avgt   42   104,385  1,380  ms/op</code></pre></div></div><div class="paragraph"><p>The best performance comes with a tail recursive method. And it shouldn&#8217;t be a surprise - Groovy compiler compiles a method annotated with <code>@TailRecursive</code> to a bytecode that uses while-loop instead of the recursive calls. <em>(Read more about in the <a href="/tail-recursive-methods-in-groovy/" title="Tail-recursive methods in Groovy">Tail-recursive methods in Groovy</a> post.)</em> That is why the call stack is dominated by two operations:</p></div><div class="ulist"><ul><li><p><code>java.math.BigInteger</code> object initialization,</p></li><li><p>and <code>java.math.BigInteger.multiply()</code> method call.</p></li></ul></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">....[Thread state: RUNNABLE]........................................................................ 41,5%  41,5% java.math.BigInteger.&lt;init&gt; 26,8%  26,8% java.math.BigInteger.multiply 15,9%  15,9% java.lang.Integer.getChars 14,2%  14,2% java.lang.Integer.stringSize  0,5%   0,5% java.math.BigInteger.multiplyByInt  0,3%   0,3% bench.FactorialBench.factorialTailRecursive  0,2%   0,2% java.lang.Integer.toString  0,2%   0,2% org.codehaus.groovy.runtime.typehandling.NumberMath.toBigInteger  0,2%   0,2% java.util.Arrays.copyOfRange  0,0%   0,0% org.openjdk.jmh.runner.BenchmarkHandler$BenchmarkTask.call</code></pre></div></div><div class="paragraph"><p>The statically compiled variant of the tail recursive method does even better. In this case it spends 97.1% of the time calling <code>NumberMath.multiply</code>.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">....[Thread state: RUNNABLE]........................................................................ 97,1%  97,2% org.codehaus.groovy.runtime.typehandling.NumberMath.multiply  1,1%   1,1% bench.FactorialBench.factorialTailRecursiveSC  0,8%   0,8% java.math.BigInteger.multiplyByInt  0,2%   0,2% java.math.BigInteger.valueOf  0,2%   0,2% bench.FactorialBench.c_tailRecursive_sc  0,2%   0,2% java.util.Arrays.copyOfRange  0,1%   0,1% java.lang.Thread.isInterrupted  0,1%   0,1% java.math.BigInteger.&lt;init&gt;  0,1%   0,1% java.lang.System.nanoTime  0,0%   0,0% sun.misc.Unsafe.unpark</code></pre></div></div></div></div></div><div class="sect1"><h2 id="does-groovy-3-0-0-beta-1-do-better">Does Groovy <code>3.0.0-beta-1</code> do better?</h2><div class="sectionbody"><div class="paragraph"><p>Short answer - no. The results comparable. Even if Groovy 2.5.7 of 3.0.0-beta-1 does a little bit better in one variant or another, it doesn&#8217;t prove anything. The tendencies are the same in both cases.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/groovy-trampoline-01.png"><img src="/images/groovy-trampoline-01.png" alt="groovy trampoline 01"></a></div></div></div></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content"><div class="paragraph"><p>Here you can find the full console output from the benchmark tests I use:</p></div><div class="ulist"><ul><li><p><a href="https://gist.github.com/wololock/6e3c52785c412ef19444ecc549489110" target="_blank" rel="noopener">Groovy 2.5.7 output</a></p></li><li><p><a href="https://gist.github.com/wololock/4062fd3916c3278c27f60b21446fe5bf" target="_blank" rel="noopener">Groovy 3.0.0-beta-1 output</a></p></li></ul></div></td></tr></table></div></div></div><div class="sect1"><h2 id="conclusion">Conclusion</h2><div class="sectionbody"><div class="paragraph"><p>The final question is - should we avoid using <code>Closure.trampoline()</code> then? <strong>Absolutely not.</strong> If you use recursive calls in the closure, you should consider using the <code>TrampolineClosure</code> to avoid hitting the call stack size limit. The cost of using <code>TrampolineClosure</code> in the statically compiled Groovy code becomes a trouble only when you need to handle hundreds of thousands calls that invoke recursive closure. However, in this case you can also consider refactoring to the tail recursive method call for the best performance. But remember what Donald Knuth said: <em>"Premature optimization is the root of all evil."</em> <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> <span class="icon"><i class="fa fa-smile-o"></i></span> Use whatever programming construction that works for you (and your team) best, and solve performance problems when they start occurring.</p></div></div></div><div id="footnotes"><hr><div class="footnote" id="_footnotedef_1"><a href="#_footnoteref_1">1</a>. <a href="http://groovy-lang.org/closures.html#_trampoline" target="_blank" rel="noopener" class="bare">http://groovy-lang.org/closures.html#_trampoline</a></div><div class="footnote" id="_footnotedef_2"><a href="#_footnoteref_2">2</a>. Donald Knuth, "Computer Programming as an Art (1974)", p. 671</div></div>]]></content>
    
    <summary type="html">
    
      &lt;div class=&quot;paragraph&quot;&gt;&lt;p&gt;A few weeks ago an interesting question was &lt;a href=&quot;https://stackoverflow.com/q/56578937/2194470&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;asked on the StackOverflow&lt;/a&gt;. Someone experimented with a recursion in Groovy and stepped into &lt;code&gt;Closure.trampoline()&lt;/code&gt; &lt;sup class=&quot;footnote&quot;&gt;[&lt;a id=&quot;_footnoteref_1&quot; class=&quot;footnote&quot; href=&quot;#_footnotedef_1&quot; title=&quot;View footnote.&quot;&gt;1&lt;/a&gt;]&lt;/sup&gt;. It quickly turned out that using &lt;code&gt;TrampolineClosure&lt;/code&gt; makes a recursive execution slower. Is this a valid behavior, or do we do something wrong?&lt;/p&gt;&lt;/div&gt;
    
    </summary>
    
    
      <category term="Groovy Cookbook" scheme="https://e.printstacktrace.blog/categories/groovy-cookbook/"/>
    
    
      <category term="groovy" scheme="https://e.printstacktrace.blog/tags/groovy/"/>
    
      <category term="jmh" scheme="https://e.printstacktrace.blog/tags/jmh/"/>
    
      <category term="recursion" scheme="https://e.printstacktrace.blog/tags/recursion/"/>
    
      <category term="benchmark" scheme="https://e.printstacktrace.blog/tags/benchmark/"/>
    
      <category term="closures" scheme="https://e.printstacktrace.blog/tags/closures/"/>
    
      <category term="tail-recursive" scheme="https://e.printstacktrace.blog/tags/tail-recursive/"/>
    
  </entry>
  
  <entry>
    <title>GR8Conf EU 2019 Recap</title>
    <link href="https://e.printstacktrace.blog/gr8conf-eu-2019-recap/"/>
    <id>https://e.printstacktrace.blog/gr8conf-eu-2019-recap/</id>
    <published>2019-06-06T10:03:44.000Z</published>
    <updated>2019-06-06T10:03:44.000Z</updated>
    
    <content type="html"><![CDATA[<div class="paragraph"><p>It&#8217;s been a week since <a href="https://2019.gr8conf.eu/" target="_blank" rel="noopener">GR8Conf EU 2019</a> is over, so it is the right time to write some recap of this outstanding event. It was my first time at GR8Conf, both as a speaker and an attendee. I spent an awesome six days in the beautiful city of Copenhagen, and I brought a lot of good memories back home. I want to share them with you in this short blog post. Enjoy reading!</p></div><a id="more"></a><div class="sect1"><h2 id="what-is-gr8conf">What is GR8Conf?</h2><div class="sectionbody"><div class="paragraph"><p><strong>GR8Conf</strong> is a conference that focuses on Groovy related topics - Groovy programming language, frameworks (Grails, Micronaut, Ratpack), build tools (Gradle), testing libraries (Spock, Geb), or DevOps tools (Jenkins) to name a few. It all started in 2009 in Copenhagen, Denmark, and it is continued year after year up to this day. This year&#8217;s edition was the 11th European edition of GR8Conf. You can read more <a href="https://gr8conf.eu/about" target="_blank" rel="noopener">about its history here</a>.</p></div></div></div><div class="sect1"><h2 id="gr8conf-eu-2019">GR8Conf EU 2019</h2><div class="sectionbody"><div class="paragraph"><p>The 2019&#8217;s edition was a three-day conference - a mix of 50 minutes long lectures and 3 hours long workshops, spread among 3-4 tracks. <em>(The second day had 4 tracks, while others had "only" 3.)</em></p></div></div></div><div class="sect1"><h2 id="day-1">Day 1</h2><div class="sectionbody"><div class="paragraph"><p>It all started on Monday. I arrived at the venue, <a href="https://en.itu.dk/" target="_blank" rel="noopener">the IT-University of Copenhagen</a>, somewhere around 30 minutes before the opening to get some coffee and make a short tour around. I have to admit that it is one of the best venues for conferences I have ever seen. Big dual-screen, good sound, very comfortable seats, much space in the main hallway to grab something to drink, talk to people, and relax. Also, everything is pretty close to each other. Top level!</p></div><blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/hashtag/gr8conf?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#gr8conf</a> booting process started...  <a href="https://twitter.com/hashtag/allthingsgroovy?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#allthingsgroovy</a> <a href="https://twitter.com/hashtag/groovylang?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#groovylang</a> <a href="https://twitter.com/hashtag/conference?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#conference</a> <a href="https://t.co/NVCEafviVO" target="_blank" rel="noopener">pic.twitter.com/NVCEafviVO</a></p>&mdash; Szymon Stepniak  (@wololock) <a href="https://twitter.com/wololock/status/1132898540236300288?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">May 27, 2019</a></blockquote><div class="paragraph"><p><a href="https://twitter.com/sbglasius" target="_blank" rel="noopener">Sren</a> has opened the conference, and <a href="https://twitter.com/MichaelCarducci" target="_blank" rel="noopener">Michael Carducci</a> showed up on the stage to give a keynote speech. It was both entertaining and learning experience  a great mix of some magic tricks and topics around security.</p></div><blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/hashtag/gr8conf?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#gr8conf</a> keeps growing thanks to the crew, attendees, and sponsors. <a href="https://twitter.com/hashtag/gradle?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#gradle</a> is happy to be a partner in this years edition <a href="https://t.co/P5oYhP6Ir1" target="_blank" rel="noopener">pic.twitter.com/P5oYhP6Ir1</a></p>&mdash; Andres Almiray (@aalmiray) <a href="https://twitter.com/aalmiray/status/1132903552471523328?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">May 27, 2019</a></blockquote><div class="paragraph"><p>Right after the keynote, I have delivered my <a href="https://github.com/wololock/ratpack-gr8conf-demo" target="_blank" rel="noopener">live coding session on non-blocking I/O with Ratpack</a>. I was a little bit nervous  live coding demo is one of the hardest types of presentations, where everything might go wrong. Luckily enough, I knew my material well, and I have already done this presentation a few times before. Everything went smooth  I gave a glitch-free presentation, showing how to build a Ratpack application from scratch, explaining how (and where) to apply non-blocking HTTP requests processing, and how to improve fault tolerance by applying circuit breaker pattern. You can get the source code and some additional materials here.</p></div><blockquote class="twitter-tweet"><p lang="en" dir="ltr">Learning non blocking <a href="https://twitter.com/hashtag/ratpack?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#ratpack</a> from <a href="https://twitter.com/wololock?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@wololock</a> at <a href="https://twitter.com/hashtag/gr8conf?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#gr8conf</a><br>Is not magic but very close<br><br>Ratpack will be one of my next TODO <a href="https://t.co/Ite6rdCSKe" target="_blank" rel="noopener">pic.twitter.com/Ite6rdCSKe</a></p>&mdash; Jorge E= (@jagedn) <a href="https://twitter.com/jagedn/status/1132936630430519296?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">May 27, 2019</a></blockquote><div class="paragraph"><p>I have attended a few more presentations that day, but it wasn&#8217;t easy to decide which track to choose, because many exciting talks occurred in the parallel. Also, it was quite tough to leave the hallway discussions with old friends as well as with the new ones.</p></div></div></div><div class="sect1"><h2 id="hackergarten-on-tour">Hackergarten on tour</h2><div class="sectionbody"><div class="paragraph"><p>The first day closed with the Hackergarten. It was 3-4 hours hackathon-like event where people were contributing together to the bunch of different open source projects. The great thing about it was that you could sit down with the active contributors or projects leaders and enjoy coding stuff together. I was surprised (in a purely positive way) how many people decided to join Hackergarten and make some open source contribution. If you ever have a chance to participate in one of Hackergartens - don&#8217;t miss it!</p></div><blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/hashtag/Hackergarten?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#Hackergarten</a> at <a href="https://twitter.com/hashtag/Gr8Conf?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#Gr8Conf</a> is doing well <a href="https://twitter.com/hashtag/AllThingsGroovy?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#AllThingsGroovy</a> <a href="https://twitter.com/hashtag/groovylang?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#groovylang</a> <a href="https://t.co/8FYSbGlsgD" target="_blank" rel="noopener">pic.twitter.com/8FYSbGlsgD</a></p>&mdash; Szymon Stepniak  (@wololock) <a href="https://twitter.com/wololock/status/1133054529396776960?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">May 27, 2019</a></blockquote></div></div><div class="sect1"><h2 id="day-2">Day 2</h2><div class="sectionbody"><div class="paragraph"><p>The second day offered the additional track filled with interesting talks. I have missed a few I wanted to see live (e.g., <a href="https://twitter.com/marcinerdmann" target="_blank" rel="noopener">Marcin&#8217;s</a> Geb 3.0 update talk), but that&#8217;s the hidden cost of unexpected situations that happen when you mix the conference with the family vacation trip. Anyway, I look forward to watching all the missed talks on videos when they finally appear.</p></div><div class="paragraph"><p>I gave two talks on day 2. The first one was the 25-minutes <a href="https://github.com/wololock/groovy-and-graalvm" target="_blank" rel="noopener">"Groovy and GraalVM"</a> live-demo-like slides summarizing the current state of generating standalone native images from Groovy programs. I walked the audience through a relatively simple use case, showing all hidden pitfalls, and explaining how to solve them. Right after this presentation, I did my last talk called <a href="https://github.com/wololock/blogging-from-ide" target="_blank" rel="noopener">"Running developer&#8217;s blog directly from an IDE"</a>. Somehow I managed to finish this talk about 12 minutes before the time. However, I was lucky to have an engaged audience who have many interesting questions which filled the gap. Thank you!</p></div><blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/wololock?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@wololock</a> starting with his talk on running <a href="https://twitter.com/hashtag/groovylang?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#groovylang</a> on <a href="https://twitter.com/hashtag/graalvm?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#graalvm</a> <a href="https://twitter.com/hashtag/gr8conf?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#gr8conf</a> <a href="https://t.co/tQoKB1Xli8" target="_blank" rel="noopener">pic.twitter.com/tQoKB1Xli8</a></p>&mdash; Naresha (@naresha_k) <a href="https://twitter.com/naresha_k/status/1133331480283885573?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">May 28, 2019</a></blockquote></div></div><div class="sect1"><h2 id="meet-greet">Meet &amp; Greet</h2><div class="sectionbody"><div class="paragraph"><p>Tuesday closed with the Meet &amp; Greet after-party. Delicious food, GR8Beer (a few different types of beer brewed by GR8Conf crew) and friendly atmosphere - the day couldn&#8217;t end in a better way. Michael Carducci entertained us with some of his magic tricks - it was amazing to see him in action from very close and get tricked. Well done, Michael! <span class="icon"><i class="fa fa-smile-o"></i></span></p></div><blockquote class="twitter-tweet"><p lang="en" dir="ltr">Gr8beers at <a href="https://twitter.com/hashtag/gr8conf?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#gr8conf</a> and playing with this 360 camera. <a href="https://twitter.com/hashtag/micronautfw?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#micronautfw</a> <a href="https://twitter.com/hashtag/groovylang?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#groovylang</a> <a href="https://t.co/gD8fR8cXwm" target="_blank" rel="noopener">pic.twitter.com/gD8fR8cXwm</a></p>&mdash; Ryan Vanderwerf (@RyanVanderwerf) <a href="https://twitter.com/RyanVanderwerf/status/1133425209384558592?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">May 28, 2019</a></blockquote></div></div><div class="sect1"><h2 id="day-3">Day 3</h2><div class="sectionbody"><div class="paragraph"><p>The last day started with Paul King&#8217;s keynote on Groovy 2.5, 3.0, and plans for 4.0 version. The rest of the day was at the same top level if it comes to talks quality. I also participated in the "Boosting the Groovy Community" discussion panel, where we could share ideas on how to make the community even groovier. The good thing about it is that at least some of these ideas will be turned into action soon. The rest of the day went fast. Again I had to sacrifice one interesting talk to attend the other one or hang out at the hallway. At 15:45 local time, GR8Conf EU 2019 was over, and it became a part of history.</p></div><blockquote class="twitter-tweet"><p lang="en" dir="ltr">Groovy ecosystem! <a href="https://twitter.com/hashtag/gr8conf?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#gr8conf</a> How to improve, grow and be more successful! <a href="https://twitter.com/hashtag/sharingKnowledge?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#sharingKnowledge</a> <a href="https://twitter.com/hashtag/developer?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#developer</a> <a href="https://t.co/I7GX3lm3CY" target="_blank" rel="noopener">pic.twitter.com/I7GX3lm3CY</a></p>&mdash; ixchelruiz (@ixchelruiz) <a href="https://twitter.com/ixchelruiz/status/1133645285077463040?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">May 29, 2019</a></blockquote></div></div><div class="sect1"><h2 id="should-i-give-gr8conf-eu-2020-a-chance">Should I give GR8Conf EU 2020 a chance?</h2><div class="sectionbody"><div class="paragraph"><p>I don&#8217;t know how about you, but if I have to attend only a single conference next year, it is going to be GR8Conf EU. 100%. For various reasons.</p></div><div class="paragraph"><p>First of all, if you are interested in the Groovy programming language or any of the Groovy-based technologies, there is no better place to be. You can meet in person <strong>core contributors</strong> of Groovy, Grails, Micronaut, Geb, Spock, Codenarc, Testcontainers, Ratpack, and many, many others. You can learn a lot directly from people who have the best hands-on experience in those technologies.</p></div><div class="paragraph"><p>Secondly - <strong>the community</strong>. GR8Conf is not a crowded event where almost everyone is a stranger to others. I&#8217;m not skilled in networking, and I would even say that I&#8217;m terrible at it. That is why I feel like an outsider in most conferences. GR8Conf was different, however. I knew only 2 people in person, but it didn&#8217;t block me from having a great time with the people I just met in Copenhagen. Every single person I met was kind and friendly. I spent hours talking about different things, and I enjoyed every minute of it. I would say that GR8Conf, in this case, has much more from the friendly community meetup, instead of a large conference.</p></div><div class="paragraph"><p>The 3rd reason is <strong>the content</strong>. I learned something new from every talk I had a pleasure to attend. I don&#8217;t go to many conferences these days, because they are usually full of advocate- or/and marketing-oriented talks. I prefer much more talks prepared by practitioners - people who experienced tons of different weird use cases, and they are willing to share them with others. Almost every presentation I saw at GR8Conf was like that. It didn&#8217;t have to be perfectly crafted - it was about valuable lessons speakers trying to share with us. Kudos for that!</p></div><blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/hashtag/gr8conf?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#gr8conf</a> EU 2019 is over. Many thanks to all good people who made this beautiful event possible - organizers, sponsors, attendees, and speakers who traveled from all around the world. You made Copenhagen a capitol of <a href="https://twitter.com/ApacheGroovy?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">@ApacheGroovy</a> for the last 3 days. It was a pleasure (1/2) <a href="https://t.co/CJWK6k3Mfa" target="_blank" rel="noopener">pic.twitter.com/CJWK6k3Mfa</a></p>&mdash; Szymon Stepniak  (@wololock) <a href="https://twitter.com/wololock/status/1133750876773003264?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">May 29, 2019</a></blockquote><div class="paragraph"><p>And the last but not least - <strong>a generally great experience</strong>. Three-Day long conferences are usually pretty exhausting. They sometimes suffer from logistic and technical issues. I don&#8217;t know how it was in the previous years, but GR8Conf EU 2019 was free from such problems. I wasn&#8217;t tired at any time at the conference. I enjoyed every moment of it. I met many positive and friendly people who made my time at the conference very pleasant. Also, the organizers did a great job making the whole experience as smooth as possible. They paid attention to every small detail - this is how you make your attendees happy.</p></div><div class="paragraph"><p>These are the reasons why I can&#8217;t wait for the 2020&#8217;s edition. Many good things will happen in the upcoming year in the Groovy ecosystem - I guess those things will inspire people to prepare excellent talks and share their experience. I will be there, no doubt about that. If you use anything from the Groovy ecosystem and you are interested in all those GR8 things, you should definitely consider attending GR8Conf EU next year. I won&#8217;t regret it I can guarantee!</p></div></div></div><div class="sect1"><h2 id="thank-you">Thank you!</h2><div class="sectionbody"><div class="paragraph"><p>I would like to thank all the people who were involved in making GR8Conf EU 2019 possible. It&#8217;s hard to name you all, and I would like to avoid missing anyone. Big thanks to <strong>organizers</strong> for doing an indisputably great job. Big thanks to <strong>all sponsors</strong> who invest in the community growth by supporting such events. Big thanks to <strong>all attendees</strong> - you are the spirit of the conference and the main ingredient of its excellent atmosphere. Big thanks to <strong>all speakers</strong> for delivering high-quality talks, workshops, and driving inspiring discussions between each session. Kudos to all of you! <span class="icon"><i class="fa fa-thumbs-up"></i></span></p></div><div class="paragraph"><p>And big thanks to you - a person who reads this blog post up to this paragraph. I hope this short recap helped you understand the phenomenon of GR8Conf better. If you attended GR8Conf EU 2019, please share your thoughts and memories in the comments section below. Many good people volunteer to make this wonderful community meeting year after year. They deserve getting some kudos from us, the attendees, and speakers.</p></div><div class="paragraph"><p>See you all next year at the latest!</p></div><blockquote class="twitter-tweet"><p lang="en" dir="ltr">Goodbye, Copenhagen  Hope to see you again next year! <a href="https://twitter.com/hashtag/Copenhagen?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#Copenhagen</a> <a href="https://twitter.com/hashtag/Denmark?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#Denmark</a> <a href="https://twitter.com/hashtag/gr8conf?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#gr8conf</a> <a href="https://twitter.com/hashtag/AllThingsGroovy?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#AllThingsGroovy</a> <a href="https://t.co/4JvL7v3LKd" target="_blank" rel="noopener">pic.twitter.com/4JvL7v3LKd</a></p>&mdash; Szymon Stepniak  (@wololock) <a href="https://twitter.com/wololock/status/1134111032895561734?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">May 30, 2019</a></blockquote><div class="paragraph"><p><br></p></div><div class="video-container"><iframe width="560" height="315" src="https://www.youtube.com/embed/ZbTXrCrjNRw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div><br><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div></div>]]></content>
    
    <summary type="html">
    
      &lt;div class=&quot;paragraph&quot;&gt;&lt;p&gt;It&amp;#8217;s been a week since &lt;a href=&quot;https://2019.gr8conf.eu/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;GR8Conf EU 2019&lt;/a&gt; is over, so it is the right time to write some recap of this outstanding event. It was my first time at GR8Conf, both as a speaker and an attendee. I spent an awesome six days in the beautiful city of Copenhagen, and I brought a lot of good memories back home. I want to share them with you in this short blog post. Enjoy reading!&lt;/p&gt;&lt;/div&gt;
    
    </summary>
    
    
      <category term="Conferences" scheme="https://e.printstacktrace.blog/categories/conferences/"/>
    
    
      <category term="grails" scheme="https://e.printstacktrace.blog/tags/grails/"/>
    
      <category term="groovy" scheme="https://e.printstacktrace.blog/tags/groovy/"/>
    
      <category term="ratpack" scheme="https://e.printstacktrace.blog/tags/ratpack/"/>
    
      <category term="gr8conf" scheme="https://e.printstacktrace.blog/tags/gr8conf/"/>
    
      <category term="conference" scheme="https://e.printstacktrace.blog/tags/conference/"/>
    
      <category term="micronaut" scheme="https://e.printstacktrace.blog/tags/micronaut/"/>
    
      <category term="copenhagen" scheme="https://e.printstacktrace.blog/tags/copenhagen/"/>
    
  </entry>
  
  <entry>
    <title>GR8Conf EU 2019 - what can you expect from my talks?</title>
    <link href="https://e.printstacktrace.blog/gr8conf-eu-2019-what-can-you-expect-from-my-talks/"/>
    <id>https://e.printstacktrace.blog/gr8conf-eu-2019-what-can-you-expect-from-my-talks/</id>
    <published>2019-05-14T06:40:36.000Z</published>
    <updated>2019-05-14T06:40:36.000Z</updated>
    
    <content type="html"><![CDATA[<div class="paragraph"><p><a href="https://gr8conf.eu" target="_blank" rel="noopener">GR8Conf EU 2019</a> starts precisely in 13 days (on May 27th). Each year Copenhagen becomes a heart of Groovy vibrant community for 3 days. The conference offers both talks and workshops, focused on Groovy related topics such as upcoming Groovy 3 release, building DSLs, using Micronaut in the cloud-native environment, or testing applications with Spock and Geb, to name a few. And that&#8217;s not even a quarter of great stuff you can expect from it. This year you can also attend one of my three talks I&#8217;m going to deliver.</p></div><a id="more"></a><div class="sect1"><h2 id="the-invitation">The invitation</h2><div class="sectionbody"><div class="paragraph"><p>If you wonder if it is worth dedicating your time to attend one of my presentations, here is a short video I recorded yesterday. I explain what the goals of each talk are, what you can expect from them, and what kind of things you can learn during the presentation.</p></div><div class="video-container"><iframe width="560" height="315" src="https://www.youtube.com/embed/eFX02DssGLc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div><div class="paragraph"><p>Here is the schedule.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">Be aware, that date, time and/or room might change, so please double-check the agenda a day before.</td></tr></table></div><div class="paragraph"><p><strong>"Practical quickstart to non-blocking I/O with Ratpack"</strong><br>Monday, May 27th, 10:40-11:30, room <code>AUD-2</code></p></div><div class="paragraph"><p><strong>"GraalVM and Groovy"</strong><br>Tuesday, May 28th, 13:15-13:40, room <code>AUD-2</code></p></div><div class="paragraph"><p><strong>"Running developer&#8217;s blog directly from an IDE"</strong><br>Tuesday, May 28th, 14:05-14:55, room <code>AUD-1</code></p></div><div class="paragraph"><p>See you in Copenhagen! <span class="icon"><i class="fa fa-smile-o"></i></span></p></div></div></div>]]></content>
    
    <summary type="html">
    
      &lt;div class=&quot;paragraph&quot;&gt;&lt;p&gt;&lt;a href=&quot;https://gr8conf.eu&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;GR8Conf EU 2019&lt;/a&gt; starts precisely in 13 days (on May 27th). Each year Copenhagen becomes a heart of Groovy vibrant community for 3 days. The conference offers both talks and workshops, focused on Groovy related topics such as upcoming Groovy 3 release, building DSLs, using Micronaut in the cloud-native environment, or testing applications with Spock and Geb, to name a few. And that&amp;#8217;s not even a quarter of great stuff you can expect from it. This year you can also attend one of my three talks I&amp;#8217;m going to deliver.&lt;/p&gt;&lt;/div&gt;
    
    </summary>
    
    
      <category term="Conferences" scheme="https://e.printstacktrace.blog/categories/conferences/"/>
    
    
      <category term="groovy" scheme="https://e.printstacktrace.blog/tags/groovy/"/>
    
      <category term="ratpack" scheme="https://e.printstacktrace.blog/tags/ratpack/"/>
    
      <category term="graalvm" scheme="https://e.printstacktrace.blog/tags/graalvm/"/>
    
      <category term="gr8conf" scheme="https://e.printstacktrace.blog/tags/gr8conf/"/>
    
      <category term="conference" scheme="https://e.printstacktrace.blog/tags/conference/"/>
    
      <category term="video" scheme="https://e.printstacktrace.blog/tags/video/"/>
    
  </entry>
  
  <entry>
    <title>Debugging Teams - book review</title>
    <link href="https://e.printstacktrace.blog/debugging-teams-book-review/"/>
    <id>https://e.printstacktrace.blog/debugging-teams-book-review/</id>
    <published>2019-04-16T13:19:41.000Z</published>
    <updated>2019-04-16T13:19:41.000Z</updated>
    
    <content type="html"><![CDATA[<div class="paragraph"><p><em>"Geniuses still make mistakes and having brilliant ideas and elite programming skills don&#8217;t guarantee that your software will be a hit. What&#8217;s going to make or break your career is how well you collaborate with others"</em>, say <a href="https://twitter.com/therealfitz" target="_blank" rel="noopener">Brian Fitzpatrick</a> and <a href="https://twitter.com/sussman" target="_blank" rel="noopener">Ben Collins-Sussman</a> in their book <em>"Debugging Teams. Better productivity through collaboration"</em>. It shows that crafting the ability to collaborate is equally important as learning new programming languages and mastering the ones we already know. Let&#8217;s take a quick look at how this book can help us to become a better team player and a better team leader.</p></div><a id="more"></a><div class="sect1"><h2 id="whats-inside">What&#8217;s inside?</h2><div class="sectionbody"><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/debugging-teams-01.jpg"><img src="/images/debugging-teams-01.jpg" alt="debugging teams 01"></a></div></div></div></div><div class="paragraph"><p><strong>Chapter one</strong> <em>(The Myth of the Genius Programmer)</em> focuses on software development as a team sport discipline. It debunks a myth of a so-called <strong>Genius Programmer</strong>, and it explains the role of great teams and their leaders in collective achievements. It also introduces three principles of social skills: Humility, Respect, and Trust. It explains how to use these principles in practice to achieve the following:</p></div><div class="ulist"><ul><li><p>lose your ego</p></li><li><p>learn to deal out and handle criticism</p></li><li><p>fail fast, iterate, and recover</p></li><li><p>leave time for learning and improving</p></li><li><p>learn patience</p></li><li><p>be open to influence</p></li></ul></div><div class="paragraph"><p><strong>Chapter two</strong> <em>(Building an Awesome Team Culture)</em> focuses on building a solid and healthy team culture. It explains that team culture is <em>"a set of shared experiences, values and goals that are unique to every engineering team."</em> A <em>"strong culture,"</em> by definition, is open to any changes that improve it, yet is resistant to any radical change that harms it. It explains how to initialize the culture development process, how to maintain it and improve it cooperatively with other team members. We can also learn about communication patterns of successful cultures. These principles apply to synchronous and asynchronous communication, and they explain the importance of making all information visible to everyone.</p></div><div class="paragraph"><p>There is also a section related to mission statements as something opposite to the overhyped marketing-speak statements. Authors prove that preparing an accurate mission statement for the team helps to find all differences and agree on the product&#8217;s development direction.</p></div><div class="paragraph"><p>The last part of this chapter focuses on efficient communication inside the team. It covers topics like running productive meetings, working in geographically distributed teams, or making the day-to-day discussions and communication simple.</p></div><div class="paragraph"><p><strong>Chapter three</strong> <em>(Every Boat Needs a Captain)</em> focuses on the role of a leader in the team. It compares bad managers versus servant leaders and shows the impact both types make on the team and organization growth. Authors also share a huge list of antipatterns and leadership patterns worth following. They explain the role of a great leader, his/her duties, challenges, or impact, to name a few. This chapter also describes how to work with different people and their unique motivations and abilities.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/debugging-teams-02.jpg"><img src="/images/debugging-teams-02.jpg" alt="debugging teams 02"></a></div></div></div></div><div class="paragraph"><p><strong>Chapter four</strong> <em>(Dealing with Poisonous People)</em> explains the importance of preventing poisonous people from destroying the team culture you and your team members built. It describes a few different destructive behaviors that put your team&#8217;s integrity in risk. People with a huge ego, behaving immaturely, unrespectful to other&#8217;s people time - these are a few of the signals and patterns you should watch for. This chapter also gives you a few principles and tricks on how to fix harmful behavior - we have to assume that some people may not be aware that their behavior is wrong.</p></div><div class="paragraph"><p><strong>Chapter five</strong> <em>(The Art of Organizational Manipulation)</em> describes the difference between an ideal organization (unafraid to take the risk, everyone behaves like an adult, extra responsibility pursued) and a typical workplace with micromanagement, fear of failure, political games, managers that have to take part in every conversation, and infamous command and control management model. It explains how to influence a positive change starting from your team up to the organization level.</p></div><div class="paragraph"><p>The <strong>final chapter</strong> <em>(Users Are People, Too)</em> shows how to apply all previous principles and techniques at the customer communication level. The development teams don&#8217;t build products for their own - they build software for the end users. It&#8217;s important to understand that the organization growth is correlated with the benefits that user get from using our software. (It shows the importance of measuring a real usage, not the number of users.) Being patient, helpful, communicating with HRT principles creates trust and engagement.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/debugging-teams-03.jpg"><img src="/images/debugging-teams-03.jpg" alt="debugging teams 03"></a></div></div></div></div></div></div><div class="sect1"><h2 id="what-have-i-learned">What have I learned?</h2><div class="sectionbody"><div class="paragraph"><p>This short review does not cover every detail of this book. It&#8217;s not that long, but it contains a lot of useful information, presented in a very easy-to-consume and anecdotal style. It confirmed that:</p></div><div class="ulist"><ul><li><p>building strong and healthy teams is not a simple job,</p></li><li><p>collective effort in software development can produce better results than single person excellent performance,</p></li><li><p>dealing with people is hard and applying HRT principles helps to build strong relationships,</p></li><li><p>debugging teams is a process that never ends.</p></li></ul></div></div></div><div class="sect1"><h2 id="where-can-i-get-this-book-from">Where can I get this book from?</h2><div class="sectionbody"><div class="paragraph"><p>You can read "Debugging Teams" on <a href="https://www.oreilly.com/library/view/debugging-teams/9781491932049/" target="_blank" rel="noopener">Safari Online platform</a>. You can also download the PDF format for free <a href="https://conferences.oreilly.com/fluent/fl-ca/public/content/debugging-teams" target="_blank" rel="noopener">directly from O&#8217;Reilly website</a>.</p></div></div></div>]]></content>
    
    <summary type="html">
    
      &lt;div class=&quot;paragraph&quot;&gt;&lt;p&gt;&lt;em&gt;&quot;Geniuses still make mistakes and having brilliant ideas and elite programming skills don&amp;#8217;t guarantee that your software will be a hit. What&amp;#8217;s going to make or break your career is how well you collaborate with others&quot;&lt;/em&gt;, say &lt;a href=&quot;https://twitter.com/therealfitz&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Brian Fitzpatrick&lt;/a&gt; and &lt;a href=&quot;https://twitter.com/sussman&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Ben Collins-Sussman&lt;/a&gt; in their book &lt;em&gt;&quot;Debugging Teams. Better productivity through collaboration&quot;&lt;/em&gt;. It shows that crafting the ability to collaborate is equally important as learning new programming languages and mastering the ones we already know. Let&amp;#8217;s take a quick look at how this book can help us to become a better team player and a better team leader.&lt;/p&gt;&lt;/div&gt;
    
    </summary>
    
    
      <category term="Programmer&#39;s Bookshelf" scheme="https://e.printstacktrace.blog/categories/programmer-s-bookshelf/"/>
    
    
      <category term="book" scheme="https://e.printstacktrace.blog/tags/book/"/>
    
      <category term="review" scheme="https://e.printstacktrace.blog/tags/review/"/>
    
      <category term="reading" scheme="https://e.printstacktrace.blog/tags/reading/"/>
    
      <category term="team" scheme="https://e.printstacktrace.blog/tags/team/"/>
    
      <category term="oreilly" scheme="https://e.printstacktrace.blog/tags/oreilly/"/>
    
      <category term="safari-online" scheme="https://e.printstacktrace.blog/tags/safari-online/"/>
    
      <category term="leadership" scheme="https://e.printstacktrace.blog/tags/leadership/"/>
    
      <category term="communication" scheme="https://e.printstacktrace.blog/tags/communication/"/>
    
  </entry>
  
  <entry>
    <title>Spock random order of tests - how to?</title>
    <link href="https://e.printstacktrace.blog/spock-random-order-of-tests-how-to/"/>
    <id>https://e.printstacktrace.blog/spock-random-order-of-tests-how-to/</id>
    <published>2019-04-06T08:52:11.000Z</published>
    <updated>2019-04-09T06:58:20.000Z</updated>
    
    <content type="html"><![CDATA[<div class="paragraph"><p><a href="http://spockframework.org/" target="_blank" rel="noopener">Spock Framework</a> executes test methods <em>(features)</em> in a single class <em>(specification)</em> in the declaration order. There is nothing wrong in this default behavior - we should write tests with their isolation in mind. However, in some cases, we would like to randomize test methods execution. Today we are going to learn how to do it.</p></div><a id="more"></a><div class="sect1"><h2 id="introduction">Introduction</h2><div class="sectionbody"><div class="paragraph"><p>Let&#8217;s start with a reasonably simple specification that prints a number to the console.</p></div><div class="listingblock"><div class="title">Listing 1. src/test/groovy/com/github/wololock/RandomSpockSpec.groovy</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">package com.github.wololockimport spock.lang.Specificationclass RandomSpockSpec extends Specification {    def "test 1"() {        when:        def number = 1        then:        println "[${new Date().format("HH:mm:ss.SSS")}] number ${number}"    }    def "test 2"() {        when:        def number = 2        then:        println "[${new Date().format("HH:mm:ss.SSS")}] number ${number}"    }    def "test 3"() {        when:        def number = 3        then:        println "[${new Date().format("HH:mm:ss.SSS")}] number ${number}"    }    def "test 4"() {        when:        def number = 4        then:        println "[${new Date().format("HH:mm:ss.SSS")}] number ${number}"    }    def "test 5"() {        when:        def number = 5        then:        println "[${new Date().format("HH:mm:ss.SSS")}] number ${number}"    }}</code></pre></div></div><div class="paragraph"><p>When we execute this specification, we get all numbers printed in the ascending order.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/spock-random-tests-01.jpg"><img src="/images/spock-random-tests-01.jpg" alt="spock random tests 01"></a></div></div></div></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">You can find the source code of this example in the <a href="https://github.com/wololock/spock-random-order-demo" target="_blank" rel="noopener">following repository</a>.</td></tr></table></div></div></div><div class="sect1"><h2 id="forcing-random-order">Forcing random order</h2><div class="sectionbody"><div class="paragraph"><p>Now let&#8217;s try to randomize the execution order. One way to do it is to use Spock&#8217;s extensions - an <a href="http://spockframework.org/spock/docs/1.1/extensions.html#_annotation_driven_local_extensions" target="_blank" rel="noopener">annotation-driven local extensions</a> in this case. Let&#8217;s create a new annotation called <code>@RandomizedOrder</code> with the following content.</p></div><div class="listingblock"><div class="title">Listing 2. src/test/groovy/com/github/wololock/RandomizedOrder.groovy</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">package com.github.wololockimport org.spockframework.runtime.extension.ExtensionAnnotationimport java.lang.annotation.ElementTypeimport java.lang.annotation.Retentionimport java.lang.annotation.RetentionPolicyimport java.lang.annotation.Target@Retention(RetentionPolicy.RUNTIME)@Target(ElementType.TYPE)@ExtensionAnnotation(RandomizedOrderExtension)@interface RandomizedOrder {}</code></pre></div></div><div class="paragraph"><p>After creating annotation interface, we can create the extension class. This class implements <code>visitSpecAnnotation</code> interceptor method that gets executed right before specification executes any feature.</p></div><div class="listingblock"><div class="title">Listing 3. src/test/groovy/com/github/wololock/RandomizedOrderExtension.groovy</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">package com.github.wololockimport org.spockframework.runtime.extension.AbstractAnnotationDrivenExtensionimport org.spockframework.runtime.model.SpecInfofinal class RandomizedOrderExtension extends AbstractAnnotationDrivenExtension&lt;RandomizedOrder&gt; {    public static final String SPOCK_RANDOM_ORDER_SEED = "spock.random.order.seed"    private static final long seed = System.getProperty(SPOCK_RANDOM_ORDER_SEED)?.toLong() ?: System.nanoTime()    static {        println "Random seed used: ${seed}\nYou can re-run the test with predefined seed by passing -D${SPOCK_RANDOM_ORDER_SEED}=${seed}\n\n"    }    @Override    void visitSpecAnnotation(RandomizedOrder annotation, SpecInfo spec) {        final Random random = new Random(seed) <i class="conum" data-value="1"></i><b>(1)</b>        final List&lt;Integer&gt; order = (0..(spec.features.size())) as ArrayList <i class="conum" data-value="2"></i><b>(2)</b>        Collections.shuffle(order, random) <i class="conum" data-value="3"></i><b>(3)</b>        spec.features.each { feature -&gt;            feature.executionOrder = order.pop() <i class="conum" data-value="4"></i><b>(4)</b>        }    }}</code></pre></div></div><div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>We want to be able to reproduce issues, so we support <code>-Dspock.random.order.seed</code> parameter which allows us to provide a predefined seed value. For instance, running the test with the parameter <code>-Dspock.random.order.seed=42</code> will always produce the same methods orders permutation.</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>A list of all possible orders (0..n).</td></tr><tr><td><i class="conum" data-value="3"></i><b>3</b></td><td>Here we shuffle the list to get its random permutation.</td></tr><tr><td><i class="conum" data-value="4"></i><b>4</b></td><td>For each feature method iterated in the declaration order we assign a unique order popped from the shuffled list.</td></tr></table></div><div class="paragraph"><p>This way we override the default execution order of each feature. By default, every feature uses execution order set based on the declaration order. <em>(The first method gets <code>executionOrder == 0</code>, the second one gets <code>executionOrder == 1</code> and so on.)</em></p></div><div class="paragraph"><p>The last thing we need to do is to add <code>@RandomizedOrder</code> annotation to our specification class.</p></div><div class="listingblock"><div class="title">Listing 4. <code>@RandomizedOrder</code> annotationed specification class</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">package com.github.wololockimport spock.lang.Specification@RandomizedOrderclass RandomSpockSpec extends Specification {    def "test 1"() {        when:        def number = 1        then:        println "[${new Date().format("HH:mm:ss.SSS")}] number ${number}"    }    def "test 2"() {        when:        def number = 2        then:        println "[${new Date().format("HH:mm:ss.SSS")}] number ${number}"    }    def "test 3"() {        when:        def number = 3        then:        println "[${new Date().format("HH:mm:ss.SSS")}] number ${number}"    }    def "test 4"() {        when:        def number = 4        then:        println "[${new Date().format("HH:mm:ss.SSS")}] number ${number}"    }    def "test 5"() {        when:        def number = 5        then:        println "[${new Date().format("HH:mm:ss.SSS")}] number ${number}"    }}</code></pre></div></div><div class="paragraph"><p>We are ready to run the test now. Let&#8217;s see if the execution order has changed.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/spock-random-tests-02.jpg?v=1"><img src="/images/spock-random-tests-02.jpg?v=1" alt="spock random tests 02"></a></div></div></div></div><div class="paragraph"><p><strong>It worked!</strong> We can see that in the above example the execution order was: Test 4, Test 3, Test 5, Test&nbsp;1, and Test 2. And what&#8217;s even more important - the solution is simple and clean.</p></div></div></div><div class="sect1"><h2 id="why-the-random-execution">Why the random execution?</h2><div class="sectionbody"><div class="paragraph"><p>Is there any specific reason to run tests in the random order? It depends. In general, every feature in the specification should live in <strong>isolation</strong>. It means that it <strong>should not depend on any side effects or any state</strong>, and should not cause any side effects either. <em>(If we need to rely on specific state and order, Spock&#8217;s <code>@Stepwise</code> <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> and <code>@Shared</code> <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> annotations are our best friends.)</em> If we follow this rule, it doesn&#8217;t matter in which order the specification executes all features. However, sometimes we have to jump into the ongoing project, and we have to deal with existing unit tests we didn&#8217;t see before. Switching to a random order execution in the unit tests might help us verifying if they are correctly written. <em>(We can also use Spock&#8217;s <a href="http://spockframework.org/spock/docs/1.1/extensions.html#_global_extensions" target="_blank" rel="noopener">Global Extension</a> mechanism to add the new extension without annotating classes - might be useful if we have tons of test classes to deal with.)</em> In other cases, we might also benefit from the random execution order as a safeguard that always forces us (and our teammates) to write tests that are isolated and atomic.</p></div><br><div class="row"><div class="col-md-10 col-md-offset-1"><div class="video-container"><iframe width="560" height="315" src="https://www.youtube.com/embed/lwlfUGkTf8c" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div></div></div></div></div><div id="footnotes"><hr><div class="footnote" id="_footnotedef_1"><a href="#_footnoteref_1">1</a>. <a href="http://spockframework.org/spock/javadoc/1.1/spock/lang/Stepwise.html" target="_blank" rel="noopener" class="bare">http://spockframework.org/spock/javadoc/1.1/spock/lang/Stepwise.html</a></div><div class="footnote" id="_footnotedef_2"><a href="#_footnoteref_2">2</a>. <a href="http://spockframework.org/spock/javadoc/1.1/spock/lang/Shared.html" target="_blank" rel="noopener" class="bare">http://spockframework.org/spock/javadoc/1.1/spock/lang/Shared.html</a></div></div>]]></content>
    
    <summary type="html">
    
      &lt;div class=&quot;paragraph&quot;&gt;&lt;p&gt;&lt;a href=&quot;http://spockframework.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Spock Framework&lt;/a&gt; executes test methods &lt;em&gt;(features)&lt;/em&gt; in a single class &lt;em&gt;(specification)&lt;/em&gt; in the declaration order. There is nothing wrong in this default behavior - we should write tests with their isolation in mind. However, in some cases, we would like to randomize test methods execution. Today we are going to learn how to do it.&lt;/p&gt;&lt;/div&gt;
    
    </summary>
    
    
      <category term="Groovy Cookbook" scheme="https://e.printstacktrace.blog/categories/groovy-cookbook/"/>
    
    
      <category term="groovy" scheme="https://e.printstacktrace.blog/tags/groovy/"/>
    
      <category term="spock" scheme="https://e.printstacktrace.blog/tags/spock/"/>
    
      <category term="unit-test" scheme="https://e.printstacktrace.blog/tags/unit-test/"/>
    
      <category term="junit" scheme="https://e.printstacktrace.blog/tags/junit/"/>
    
      <category term="random" scheme="https://e.printstacktrace.blog/tags/random/"/>
    
  </entry>
  
  <entry>
    <title>GraalVM and heap size of the native image - how to set it?</title>
    <link href="https://e.printstacktrace.blog/graalvm-heap-size-of-native-image-how-to-set-it/"/>
    <id>https://e.printstacktrace.blog/graalvm-heap-size-of-native-image-how-to-set-it/</id>
    <published>2019-04-02T13:38:38.000Z</published>
    <updated>2019-04-02T13:38:38.000Z</updated>
    
    <content type="html"><![CDATA[<div class="paragraph"><p>In this short blog post, I would like to show you how to set a heap size of the application executed from the native image generated with <a href="https://www.graalvm.org/" target="_blank" rel="noopener">GraalVM</a>. We will also take a quick look at the effects caused the maximum heap size change.</p></div><a id="more"></a><div class="sect1"><h2 id="graalvm-heap-size-setting">GraalVM heap size setting</h2><div class="sectionbody"><div class="paragraph"><p>If you want to set up the maximum heap size of the application executed from the native image, use&nbsp; <code>-Xmx{n}</code> command line option. For instance, if we want to set up a maximum heap size to <strong>128 MB</strong> we can do the following:</p></div><div class="listingblock"><div class="title">Listing 1. Setting maximum heap size to 128 MB</div><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./your-native-image-executable -Xmx128m</code></pre></div></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">This blog post is published when the most recent version of GraalVM is <strong>1.0.0-RC14</strong>.</td></tr></table></div></div></div><div class="sect1"><h2 id="an-example">An example</h2><div class="sectionbody"><div class="paragraph"><p>In the following example, I will use the native image I&#8217;ve <a href="/ratpack-graalvm-how-to-start/" title="created for my demo Ratpack">created for my demo Ratpack</a> application. The only difference is that this time I have configured this application to use a single thread for handling event loop events. <em>(HTTP requests in particular.)</em></p></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">In the following example I also use <code>-XX:+PrintGC</code>, <code>-XX:+PrintGCTimeStamps</code>, <code>-XX:+VerboseGC</code> and <code>+XX:+PrintHeapShape</code> flags to log verbose garbage collector activity to the console.</td></tr></table></div><div class="paragraph"><p>For testing purpose, I&#8217;m going to execute <strong>200</strong> parallel requests, repeated <strong>100</strong> times, so our application will have to handle <strong>20,000</strong> requests in total. I use <code>siege</code> <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> tool to execute those requests. Firstly, let&#8217;s do this test with the application executed without specifying the heap size. However, what is the <strong>default maximum heap size</strong>? You can find it out using GraalVM polyglot launcher for instance:</p></div><div class="listingblock"><div class="title">Listing 2. Finding the default maximum heap size</div><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ polyglot --native --help:vm | grep HeapSize  --vm.XX:MaximumHeapSizePercent=80            The maximum heap size as percent of physical memory.  --vm.Xmx&lt;value&gt;                              Sets the maximum size of the heap, in bytes. Default: MaximumHeapSizePercent * physical memory.</code></pre></div></div><div class="paragraph"><p>As you can see, it&#8217;s set to <strong>80%</strong> of the physical memory. In my case it is something around <strong>12.29 GB</strong>. Let&#8217;s run the application.</p></div><div class="listingblock"><div class="title">Listing 3. Running Ratpack application with the default max heap size</div><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./ratpack-graalvm-demo -XX:+PrintGC -XX:+PrintGCTimeStamps -XX:+VerboseGC +XX:+PrintHeapShape[main] INFO ratpack.server.RatpackServer - Starting server...[main] INFO ratpack.server.RatpackServer - Building registry...[main] INFO ratpack.server.RatpackServer - Ratpack started for http://localhost:5050</code></pre></div></div><div class="paragraph"><p>We can execute <strong>20,000</strong> requests now.</p></div><div class="listingblock"><div class="title">Listing 4. Executing 20k requests using <code>siege</code></div><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ siege -c 200 -r 100 http://localhost:5050/...HTTP/1.1 200     0.01 secs:      53 bytes ==&gt; GET  /HTTP/1.1 200     0.01 secs:      53 bytes ==&gt; GET  /HTTP/1.1 200     0.00 secs:      53 bytes ==&gt; GET  /Transactions:       20000 hitsAvailability:      100.00 %Elapsed time:        4.31 secsData transferred:        1.01 MBResponse time:        0.03 secsTransaction rate:     4640.37 trans/secThroughput:        0.23 MB/secConcurrency:      143.19Successful transactions:       20000Failed transactions:           0Longest transaction:        3.14Shortest transaction:        0.02</code></pre></div></div><div class="paragraph"><p>Let&#8217;s take a look at the console where the application is running.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./ratpack-graalvm-demo -XX:+PrintGC -XX:+PrintGCTimeStamps -XX:+VerboseGC +XX:+PrintHeapShape[main] INFO ratpack.server.RatpackServer - Starting server...[main] INFO ratpack.server.RatpackServer - Building registry...[main] INFO ratpack.server.RatpackServer - Ratpack started for http://localhost:5050[Heap policy parameters:  YoungGenerationSize: 268435456      MaximumHeapSize: 13193507600      MinimumHeapSize: 536870912     AlignedChunkSize: 1048576  LargeArrayThreshold: 131072][[36323 msec:  GC: before  epoch: 1  cause: CollectOnAllocation.Sometimes][36333 msec: Incremental GC (CollectOnAllocation.Sometimes) 261172K-&gt;17403K, 0.0105428 secs] [36333 msec:  GC: after   epoch: 1  cause: CollectOnAllocation.Sometimes  policy: by time: 50% in incremental collections  type: incremental  collection time: 10542877 nanoSeconds]]</code></pre></div></div><div class="paragraph"><p>As you can see, there was no much activity from the garbage collector. Here what does the memory consumption of this process looks like:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ps ef -o command,vsize,rss,%mem,size | grep ratpack | head -n 1 \_ ./ratpack-graalvm-demo  525924 280148  1.7 307328</code></pre></div></div><div class="paragraph"><p>It consumed <strong>280 MB</strong> RSS. Is it much? Maybe. Let&#8217;s run the same application with <code>-Xmx64m</code> and check if it makes any difference.</p></div><div class="listingblock"><div class="title">Listing 5. Running Ratpack application with max heap size set to 64 MB</div><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./ratpack-graalvm-demo -XX:+PrintGC -XX:+PrintGCTimeStamps -XX:+VerboseGC +XX:+PrintHeapShape -Xmx64m[main] INFO ratpack.server.RatpackServer - Starting server...[main] INFO ratpack.server.RatpackServer - Building registry...[main] INFO ratpack.server.RatpackServer - Ratpack started for http://localhost:5050</code></pre></div></div><div class="paragraph"><p>Application started. It&#8217;s time to execute the same amount of requests.</p></div><div class="listingblock"><div class="title">Listing 6. Executing 20k requests using <code>siege</code></div><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ siege -c 200 -r 100 http://localhost:5050/...HTTP/1.1 200     0.01 secs:      53 bytes ==&gt; GET  /HTTP/1.1 200     0.01 secs:      53 bytes ==&gt; GET  /HTTP/1.1 200     0.00 secs:      53 bytes ==&gt; GET  /Transactions:       20000 hitsAvailability:      100.00 %Elapsed time:        3.86 secsData transferred:        1.01 MBResponse time:        0.03 secsTransaction rate:     5181.35 trans/secThroughput:        0.26 MB/secConcurrency:      152.01Successful transactions:       20000Failed transactions:           0Longest transaction:        3.09Shortest transaction:        0.01</code></pre></div></div><div class="paragraph"><p>This time the garbage collector was much more active - here is the console log generated while the application was handling 20k requests:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./ratpack-graalvm-demo -XX:+PrintGC -XX:+PrintGCTimeStamps -XX:+VerboseGC +XX:+PrintHeapShape -Xmx64m[main] INFO ratpack.server.RatpackServer - Starting server...[main] INFO ratpack.server.RatpackServer - Building registry...[main] INFO ratpack.server.RatpackServer - Ratpack started for http://localhost:5050[Heap policy parameters:  YoungGenerationSize: 6710880      MaximumHeapSize: 67108864      MinimumHeapSize: 13421760     AlignedChunkSize: 1048576  LargeArrayThreshold: 131072][[1768 msec:  GC: before  epoch: 1  cause: CollectOnAllocation.Sometimes][1772 msec: Incremental GC (CollectOnAllocation.Sometimes) 20463K-&gt;17403K, 0.0040444 secs] [1772 msec:  GC: after   epoch: 1  cause: CollectOnAllocation.Sometimes  policy: by time: 50% in incremental collections  type: incremental  collection time: 4044472 nanoSeconds]][[1845 msec:  GC: before  epoch: 2  cause: CollectOnAllocation.Sometimes][1850 msec: Full GC (CollectOnAllocation.Sometimes) 24543K-&gt;17403K, 0.0049823 secs] [1850 msec:  GC: after   epoch: 2  cause: CollectOnAllocation.Sometimes  policy: by time: 50% in incremental collections  type: complete  collection time: 4982361 nanoSeconds]]### [removed 200 lines for a better readability] ###[[5479 msec:  GC: before  epoch: 53  cause: CollectOnAllocation.Sometimes][5483 msec: Full GC (CollectOnAllocation.Sometimes) 24543K-&gt;17403K, 0.0042101 secs] [5483 msec:  GC: after   epoch: 53  cause: CollectOnAllocation.Sometimes  policy: by time: 50% in incremental collections  type: complete  collection time: 4210195 nanoSeconds]][[5549 msec:  GC: before  epoch: 54  cause: CollectOnAllocation.Sometimes][5551 msec: Incremental GC (CollectOnAllocation.Sometimes) 24543K-&gt;17403K, 0.0022523 secs] [5551 msec:  GC: after   epoch: 54  cause: CollectOnAllocation.Sometimes  policy: by time: 50% in incremental collections  type: incremental  collection time: 2252302 nanoSeconds]]</code></pre></div></div><div class="paragraph"><p>And now let&#8217;s take a look at the memory consumption.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ps ef -o command,vsize,rss,%mem,size | grep ratpack | head -n 1 \_ ./ratpack-graalvm-demo  281188 35812  0.2 62592</code></pre></div></div><div class="paragraph"><p>We could expect that. The application run with much smaller maximum heap size consumed <strong>eight times</strong> less memory - <strong>35 MB</strong> in this case.</p></div></div></div><div class="sect1"><h2 id="what-is-the-right-size">What is the right size?</h2><div class="sectionbody"><div class="paragraph"><p>It depends. You need to experiment with the optimal settings for your application. The good news is that you can compile the native image once and run tests with different settings without recompiling the image. I&#8217;ve run several tests with my demo Ratpack application, and I was able to limit max heap size to <strong>32 MB</strong>. However, if I kept the default size of the even loop group <em>(16 in my case)</em>, then I couldn&#8217;t get lower than <strong>256 MB</strong>. Otherwise, the application pretty quickly started crashing with <code>OutOfMemoryError</code>.</p></div></div></div><div class="sect1"><h2 id="conclusion">Conclusion</h2><div class="sectionbody"><div class="paragraph"><p>I hope you have learned something useful from this blog post. Please let me know in the comment section below what is your experience with the GraalVM. Take care and see you next time!</p></div></div></div><div id="footnotes"><hr><div class="footnote" id="_footnotedef_1"><a href="#_footnoteref_1">1</a>. <a href="https://github.com/JoeDog/siege" target="_blank" rel="noopener" class="bare">https://github.com/JoeDog/siege</a></div></div>]]></content>
    
    <summary type="html">
    
      &lt;div class=&quot;paragraph&quot;&gt;&lt;p&gt;In this short blog post, I would like to show you how to set a heap size of the application executed from the native image generated with &lt;a href=&quot;https://www.graalvm.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;GraalVM&lt;/a&gt;. We will also take a quick look at the effects caused the maximum heap size change.&lt;/p&gt;&lt;/div&gt;
    
    </summary>
    
    
      <category term="How to" scheme="https://e.printstacktrace.blog/categories/how-to/"/>
    
    
      <category term="ratpack" scheme="https://e.printstacktrace.blog/tags/ratpack/"/>
    
      <category term="java" scheme="https://e.printstacktrace.blog/tags/java/"/>
    
      <category term="graalvm" scheme="https://e.printstacktrace.blog/tags/graalvm/"/>
    
      <category term="xmx" scheme="https://e.printstacktrace.blog/tags/xmx/"/>
    
  </entry>
  
  <entry>
    <title>Using the same prefix with different HTTP methods in Ratpack</title>
    <link href="https://e.printstacktrace.blog/using-the-same-prefix-with-different-http-methods-in-ratpack/"/>
    <id>https://e.printstacktrace.blog/using-the-same-prefix-with-different-http-methods-in-ratpack/</id>
    <published>2019-04-01T08:12:52.000Z</published>
    <updated>2019-04-01T08:12:52.000Z</updated>
    
    <content type="html"><![CDATA[<div class="paragraph"><p><a href="https://ratpack.io/" target="_blank" rel="noopener">Ratpack</a> is an excellent tool for building RESTful<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> applications. However, to benefit most of it, we need to know the tool a little bit better. It applies to Ratpack handler&#8217;s mechanism - it is much different compared to what we have learned by using many popular MVC frameworks. In today&#8217;s blog post I would like to show you a relatively simple example that confused many newcomers.</p></div><a id="more"></a><div class="sect1"><h2 id="an-example">An example</h2><div class="sectionbody"><div class="paragraph"><p>Let&#8217;s consider the following example. We have a simple API with the <code>/users</code> endpoint. This endpoint handles <code>GET</code> and <code>POST</code> requests. Sounds familiar, right? Here is how we might try to implement it in Ratpack.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">In this example, we use Ratpack&#8217;s excellent <a href="https://ratpack.io/manual/current/quick-start.html#using_a_groovy_script" target="_blank" rel="noopener">integration with Groovy</a>. Instead of creating an application with Gradle or Maven, we create a single Groovy script file with Ratpack Grape item, and we are ready to go. Just a few lines of code and we have a working REST application.</td></tr></table></div><div class="listingblock"><div class="title">Listing 1. Ratpack application as a Groovy script called <code>ratpack.groovy</code></div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Grab('io.ratpack:ratpack-groovy:1.6.0')import static ratpack.groovy.Groovy.ratpackratpack {    handlers {        prefix("users") {            get {                response.send("A list of users...")            }            post {                response.send("Create a new user...")            }        }    }}</code></pre></div></div><div class="paragraph"><p>Let&#8217;s run the application.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ groovy ratpack.groovy</code></pre></div></div><div class="paragraph"><p>We are ready to send some HTTP requests with curl.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -i -X GET http://localhost:5050/usersHTTP/1.1 200 OKcontent-type: text/plain;charset=UTF-8content-length: 18A list of users...%$ curl -i -X POST http://localhost:5050/usersHTTP/1.1 405 Method Not Allowedcontent-type: text/plain;charset=UTF-8content-length: 16Client error 405%</code></pre></div></div><div class="paragraph"><p>Something went wrong. The <code>GET</code> request gets handled correctly, but when we send the <code>POST</code> request, it gets HTTP <strong>405 Method Not Allowed</strong>. Why is that?</p></div><div class="paragraph"><p>The problem is that the <code>prefix</code> method creates a handler (or handlers) that handle requests based on the relative path - it matches all requests starting with a given prefix. In this case, sending requests with the same URI path, but with different HTTP method does not make any difference for our application. Both kinds of requests match the same relative URI path, so Ratpack delegates them to the first handler in the queue. It happens that the first handler is the one that processes <code>GET</code> requests - it accepts any <code>GET</code> request but returns 405 HTTP status if an incorrect method was set.</p></div><div class="paragraph"><p>This is where <code>byMethod</code> helper method comes with help. It creates a chain of handlers that accept the same relative path but handle different HTTP methods. Let&#8217;s use it inside the <code>prefix</code> method and see how it works.</p></div><div class="listingblock"><div class="title">Listing 2. A first approach to use <code>byMethod</code> helper method.</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Grab('io.ratpack:ratpack-groovy:1.6.0')import static ratpack.groovy.Groovy.ratpackratpack {    handlers {        prefix("users") {            byMethod {                get {                    response.send("A list of users...")                }                post {                    response.send("Create a new user...")                }            }        }    }}</code></pre></div></div><div class="paragraph"><p>Now we can run the updated application and test the <code>GET</code> request.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -i -X POST http://localhost:5050/usersHTTP/1.1 500 Internal Server Errorcontent-type: text/plain;charset=UTF-8content-length: 5388groovy.lang.MissingMethodException: No signature of method: ratpack.byMethod() is applicable for argument types: (ratpack$_run_closure1$_closure2$_closure3$_closure4) values: [ratpack$_run_closure1$_closure2$_closure3$_closure4@28289a28]at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.unwrap(ScriptBytecodeAdapter.java:70)at org.codehaus.groovy.runtime.callsite.PogoMetaClassSite.callCurrent(PogoMetaClassSite.java:76)at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCallCurrent(CallSiteArray.java:51)at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callCurrent(AbstractCallSite.java:156)at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callCurrent(AbstractCallSite.java:168)at ratpack$_run_closure1$_closure2$_closure3.doCall(ratpack.groovy:8)at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</code></pre></div></div><div class="paragraph"><p>Oops. Something went wrong. The <code>MissingMethodException</code> seems like trying to tell us, that there is no option to use <code>byMethod</code> inside the <code>prefix</code> method. Does it mean that we can create separate handlers for different HTTP methods under the same prefix?</p></div></div></div><div class="sect1"><h2 id="the-solution">The solution</h2><div class="sectionbody"><div class="paragraph"><p>The answer is - yes, we can. The problem with the above solution is simple - a closure created for the <code>prefix</code> method does not have access to the context object (it delegates to <code>ratpack.handling.Chain</code> instead). The <code>byMethod</code> method is exposed by the <code>ratpack.handling.Context</code> thus we need something that delegates to it. Luckily, there is a method that delegates to the context object, and that can be used in our example. It&#8217;s <code>path</code> helper method that creates a chain of handlers that match the same relative path. Let&#8217;s take a look at the final example.</p></div><div class="listingblock"><div class="title">Listing 3. The final application code with <code>prefix</code> and <code>byMethod</code> methods combination.</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Grab('io.ratpack:ratpack-groovy:1.6.0')import static ratpack.groovy.Groovy.ratpackratpack {    handlers {        prefix("users") {            path {                byMethod {                    get {                        response.send("A list of users...")                    }                    post {                        response.send("Create a new user...")                    }                }            }        }    }}</code></pre></div></div><div class="paragraph"><p>Let&#8217;s execute <code>GET</code> and <code>POST</code> requests to see if it works as we expect.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -i -X GET http://localhost:5050/usersHTTP/1.1 200 OKcontent-type: text/plain;charset=UTF-8content-length: 18A list of users...%$ curl -i -X POST http://localhost:5050/usersHTTP/1.1 200 OKcontent-type: text/plain;charset=UTF-8content-length: 20Create a new user...%</code></pre></div></div><div class="paragraph"><p>Cowabunga! It works like a charm.</p></div></div></div><div class="sect1"><h2 id="conclusion">Conclusion</h2><div class="sectionbody"><div class="paragraph"><p>I hope you have learned something new from this blog post. The reason I wrote it is that I couldn&#8217;t find any example in the documentation that covered an example of combining <code>prefix</code> and <code>byMethod</code> methods. However, it is a quite common use case, and people get confused by it.</p></div></div></div><div id="footnotes"><hr><div class="footnote" id="_footnotedef_1"><a href="#_footnoteref_1">1</a>. <a href="https://en.wikipedia.org/wiki/Representational_state_transfer" target="_blank" rel="noopener" class="bare">https://en.wikipedia.org/wiki/Representational_state_transfer</a></div></div>]]></content>
    
    <summary type="html">
    
      &lt;div class=&quot;paragraph&quot;&gt;&lt;p&gt;&lt;a href=&quot;https://ratpack.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Ratpack&lt;/a&gt; is an excellent tool for building RESTful&lt;sup class=&quot;footnote&quot;&gt;[&lt;a id=&quot;_footnoteref_1&quot; class=&quot;footnote&quot; href=&quot;#_footnotedef_1&quot; title=&quot;View footnote.&quot;&gt;1&lt;/a&gt;]&lt;/sup&gt; applications. However, to benefit most of it, we need to know the tool a little bit better. It applies to Ratpack handler&amp;#8217;s mechanism - it is much different compared to what we have learned by using many popular MVC frameworks. In today&amp;#8217;s blog post I would like to show you a relatively simple example that confused many newcomers.&lt;/p&gt;&lt;/div&gt;
    
    </summary>
    
    
      <category term="Ratpack Cookbook" scheme="https://e.printstacktrace.blog/categories/ratpack-cookbook/"/>
    
    
      <category term="groovy" scheme="https://e.printstacktrace.blog/tags/groovy/"/>
    
      <category term="ratpack" scheme="https://e.printstacktrace.blog/tags/ratpack/"/>
    
      <category term="rest" scheme="https://e.printstacktrace.blog/tags/rest/"/>
    
      <category term="netty" scheme="https://e.printstacktrace.blog/tags/netty/"/>
    
      <category term="http" scheme="https://e.printstacktrace.blog/tags/http/"/>
    
      <category term="curl" scheme="https://e.printstacktrace.blog/tags/curl/"/>
    
  </entry>
  
  <entry>
    <title>Pragmatic Thinking and Learning - book review</title>
    <link href="https://e.printstacktrace.blog/pragmatic-thinking-and-learning-book-review/"/>
    <id>https://e.printstacktrace.blog/pragmatic-thinking-and-learning-book-review/</id>
    <published>2019-03-26T16:50:06.000Z</published>
    <updated>2019-03-26T16:50:06.000Z</updated>
    
    <content type="html"><![CDATA[<div class="paragraph"><p>There are books you read once, and you don&#8217;t plan to read them back again any time soon. However, some books are so influential and valuable that when you decide to study them the second time, you realize that it was the right choice, and you could make this call a few years earlier. Today I would like to show you a book that belongs to this second group  no doubts about that.</p></div><a id="more"></a><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">The two links to Amazon.com in the following blog posts are <strong>affiliate links</strong>. If you decide to purchase a book through those links, I will earn a small commission, without affecting the regular price. This way you can support the work I do on this blog. Thanks for your understanding!</td></tr></table></div><div class="sect1"><h2 id="introduction">Introduction</h2><div class="sectionbody"><div class="paragraph"><p>I bought my paperback copy of <a href="https://amzn.to/2wajzj9" target="_blank" rel="noopener" class="ga-track"><em>"Pragmatic Thinking and Learning"</em></a> book six years ago (March 27th, 2013), and it has blown my mind during the first read. It was written by <a href="https://twitter.com/PragmaticAndy" target="_blank" rel="noopener">Andy Hunt</a> and was published by the <a href="https://pragprog.com/" target="_blank" rel="noopener">Pragmatic Bookshelf</a> in 2008. It introduced me to the entirely new ways of learning, practicing and crafting technical skills, the existence of I was unaware. Like most of the people, I was blindly following unpractical learning techniques we all have learned in the school. I was consuming the content without studying and experiencing it. <em>"Pragmatic Thinking and Learning"</em> has changed me profoundly. I started questioning the traditional learning techniques, and I started benefiting from more pragmatic and practical ways of learning.</p></div><div class="paragraph"><p>It was one of the most influential books I read back in 2013. Six years later, in early 2019, I&#8217;ve decided to study this book again. It&#8217;s funny how many important lessons I have already forgotten. I quickly realized that getting back to this book was one of the best decisions I could make.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/pragmatic-thinking-and-learning-03.jpg"><img src="/images/pragmatic-thinking-and-learning-03.jpg" alt="pragmatic thinking and learning 03"></a></div></div></div></div></div></div><div class="sect1"><h2 id="whats-inside">What&#8217;s inside?</h2><div class="sectionbody"><div class="paragraph"><p><strong>Chapter one</strong> <em>(Introduction)</em> explains the importance of developing communication, learning and thinking skills. Software developers (and any knowledge workers) have to learn continuously to make good use of their abilities. This chapter also briefly describes the content of all the following chapters. <strong>Chapter two</strong> <em>(Journey from Novice to Expert)</em> uses <em>The Five Dreyfus Model Stages</em> to explain the differences between novices and experts. Those stages are:</p></div><div class="ulist"><ul><li><p><strong>Novice</strong> <em>(a person who requires explicit and context-free recipes to follow)</em></p></li><li><p><strong>Advanced Beginner</strong> <em>(a person who wants to process fast information and is not interested in the bigger picture)</em></p></li><li><p><strong>Competent</strong> <em>(a person who can troubleshoot and start solving problems he/she hasn&#8217;t faced before)</em></p></li><li><p><strong>Proficient</strong> <em>(a person who needs to understand the big picture and can self-correct their previous poor task performance)</em></p></li><li><p><strong>Expert</strong> <em>(a person who works from intuition, not from reason)</em></p></li></ul></div><div class="paragraph"><p>The following sections of this chapter explain how to use this model effectively to success and level-up. It also reveals that the Dreyfus Model applies to all your skills - you can be Novice in some areas, while you are <em>Proficient</em> or <em>Expert</em> in a few others.</p></div><div class="paragraph"><p><strong>Chapter three</strong> <em>(This Is Your Brain)</em> focuses on our central processing unit - the brain. It describes two different processing modes: a linear mode (called <em>L-mode</em>) and non-linear mode (called <em>R-mode</em>, from <em>rich mode</em>). It explains how the brain works, how it memorizes the information, and how it works in the write-only mode all the time (each read is a read-write operation). Learning more about your brain allows you to use it more effectively. Especially the non-linear processing mode is critical in becoming an expert in a specific field. It also provides positive information - our brain is neuroplastic, so we can learn how to rewire it. <em>(An example from page 70 with a blind man blown my mind).</em></p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/pragmatic-thinking-and-learning-02.jpg"><img src="/images/pragmatic-thinking-and-learning-02.jpg" alt="pragmatic thinking and learning 02"></a></div></div></div></div><div class="paragraph"><p><strong>Chapter four</strong> <em>(Get in Your Right Mind)</em> teaches us how to engage a non-linear processing mode to the linear one flow. It gives tons of examples and exercises on how to take advantage of the <em>R-mode</em> and how to harvest from it even more. <strong>Chapter five</strong> <em>(Debug Your Mind)</em> starts with explaining a bunch of cognitive biases that affect our perception and decision making. Some of them are influenced by the generation we have born in, or by our personality tendencies. They are also affected by so-called <em>"lizard logic"</em> - the primitive reactions that were very useful 50,000 years ago. The chapter ends with a few ideas and guidance on how to turn on the debug mode to understand better the source of our reactions to prevent (or at least limit) the destructive ones.</p></div><div class="paragraph"><p><strong>Chapter six</strong> <em>(Learn Deliberately)</em> introduces a <strong>Pragmatic Investment Plan</strong> - an approach that helps to learn more effectively. It explains various learning techniques and helps to find ones that work best in our case. It describes the <strong>SQ3R</strong> reading technique, mind mapping visualizing method<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>, or <em>"Learn By Teaching"</em> approach, to name a few.</p></div><div class="admonitionblock tip"><table><tr><td class="icon"><i class="fa icon-tip" title="Tip"></i></td><td class="content"><em>"Teaching clarifies your understanding and reveals many of your underlying assumptions."</em></td></tr></table></div><div class="paragraph"><p><strong>Chapter seven</strong> <em>(Gain Experience)</em> explains how important it is to explore <em>("play with")</em> the learning material before studying the facts. This exploration and experience are essential to building mental models in our brain. Those models make the learning process more effective. <strong>Chapter eight</strong> <em>(Manage Focus)</em> gives several practical advice on how to increase the level of attention, manage our knowledge portfolio, and optimize the process of loading information in the current context. It covers some tips and tricks that help to stay in the "zone". <strong>The final chapter</strong> <em>(Beyond Expertise)</em> summarizes the book and recommends to <em>start with a plan</em>, <em>accept errors</em> (inaction is the real enemy), <em>recognize that developing new habits take time</em>, <em>believe in own capabilities</em>, <em>and always take small next steps.</em></p></div></div></div><div class="sect1"><h2 id="what-are-my-main-takeaways-from-this-book">What are my main takeaways from this book?</h2><div class="sectionbody"><div class="paragraph"><p>I enjoyed reading <em>"Pragmatic Thinking and Learning"</em>, but apart from that it encouraged me to do the following things:</p></div><div class="ulist"><ul><li><p>I started using the <strong>SQ3R</strong> books studying technique <em>(survey, question, read, recite, review)</em> to all books I read. I already used a few other books studying techniques, but the SQ3R sounds like an approach that makes the learning process more effective.</p></li><li><p>I created my <strong>Pragmatic Investment Plan</strong> in the three key areas for my professional career. I started by <em>"reverse-engineering"</em> myself and applying the Dreyfus Model stages to several skills I want to work out. I created a concrete plan using <em>S.M.A.R.T.</em> objectives. I also researched and experimented with different ways of absorbing the knowledge and crafting experience to progress.</p></li><li><p>I decided to give the <strong>mind mapping</strong> a try. A few years ago I tried it, but I failed. This time I want to use hand-drawn mind maps with the one crucial thing in mind - <strong>the documenting</strong> is more important than documentation.</p></li><li><p>According to the minimal user interface rule I removed a few distractions from my work environment. <em>(I already practice "no notifications" principles for a couple of years).</em></p></li><li><p>I started exploring and playing around with the new things before getting deep into the details and facts.</p></li></ul></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/pragmatic-thinking-and-learning-04.jpg"><img src="/images/pragmatic-thinking-and-learning-04.jpg" alt="pragmatic thinking and learning 04"></a></div></div></div></div></div></div><div class="sect1"><h2 id="you-may-ask-yourself-should-i-read-it">You may ask yourself - should I read it?</h2><div class="sectionbody"><div class="paragraph"><p>It depends. If you have already read a few positions from the bibliography, you might not benefit much from reading the book, because you already know the things it covers. However, if you find yourself in a position where you feel stuck in the learning progression, and a portion of practical advises could give you a real shot of motivation, this book is definitely for you. When I started studying this book for the second time, I felt like I need some <em>"code review"</em> of methods and techniques I use for learning and becoming a more experienced programmer. This book offered me the guidance I needed most at the moment.</p></div><div class="paragraph"><p>I hope you enjoyed reading this blog post and you have found valuable information in it. Don&#8217;t hesitate to leave a comment below if you have any question related to the book. I tried to express my feelings and opinions about it most accurately, but I accept that I might miss something important. Let me know, and I will do my best to help you find the answers you are looking for. Or maybe you have also read the <a href="https://amzn.to/2wajzj9" target="_blank" rel="noopener" class="ga-track"><em>"Pragmatic Thinking and Learning"</em></a> book and you have a different opinion? Please share it with us. I&#8217;d love to hear it from you.</p></div></div></div><div class="sect1 get-the-book"><h2 id="get-the-book">Get the book</h2><div class="sectionbody"><div class="exampleblock"><div class="content"><div class="paragraph"><p><strong>Paperback</strong></p></div><div class="paragraph"><p><span class="image"><img src="/images/flags/us.png" alt="United States" title="United States"></span>Amazon.com: <a href="https://www.amazon.com/gp/product/1934356050?ie=UTF8&amp;tag=eprintstacktr-20&amp;camp=1789&amp;linkCode=xm2&amp;creativeASIN=1934356050" target="_blank" rel="noopener" class="ga-track">Pragmatic Thinking and Learning: Refactor Your Wetware</a></p></div><div class="paragraph"><p><span class="image"><img src="/images/flags/gb.png" alt="United Kingdom" title="United Kingdom"></span>Amazon.co.uk: <a href="https://www.amazon.co.uk/gp/product/1934356050?ie=UTF8&amp;tag=eprintstack07-21&amp;camp=1634&amp;linkCode=xm2&amp;creativeASIN=1934356050" target="_blank" rel="noopener" class="ga-track">Pragmatic Thinking and Learning: Refactor Your Wetware</a></p></div><div class="paragraph"><p><span class="image"><img src="/images/flags/de.png" alt="Germany" title="Germany"></span>Amazon.de: <a href="https://www.amazon.de/gp/product/1934356050?ie=UTF8&amp;tag=eprintstac0c4-21&amp;camp=1638&amp;linkCode=xm2&amp;creativeASIN=1934356050" target="_blank" rel="noopener" class="ga-track">Pragmatic Thinking and Learning: Refactor Your Wetware (Eng.)</a></p></div><hr><div class="paragraph"><p><span class="small">NOTE: Above links are affiliate links. If you decide to buy a book using my affiliate link, I will get a small percentage from your purchase. The&nbsp;affiliate link does not affect the final price of the product. Using it costs you nothing.</span></p></div></div></div></div></div><div id="footnotes"><hr><div class="footnote" id="_footnotedef_1"><a href="#_footnoteref_1">1</a>. <a href="https://en.wikipedia.org/wiki/Mind_map" target="_blank" rel="noopener" class="bare">https://en.wikipedia.org/wiki/Mind_map</a></div></div>]]></content>
    
    <summary type="html">
    
      &lt;div class=&quot;paragraph&quot;&gt;&lt;p&gt;There are books you read once, and you don&amp;#8217;t plan to read them back again any time soon. However, some books are so influential and valuable that when you decide to study them the second time, you realize that it was the right choice, and you could make this call a few years earlier. Today I would like to show you a book that belongs to this second group  no doubts about that.&lt;/p&gt;&lt;/div&gt;
    
    </summary>
    
    
      <category term="Programmer&#39;s Bookshelf" scheme="https://e.printstacktrace.blog/categories/programmer-s-bookshelf/"/>
    
    
      <category term="learning" scheme="https://e.printstacktrace.blog/tags/learning/"/>
    
      <category term="book" scheme="https://e.printstacktrace.blog/tags/book/"/>
    
      <category term="review" scheme="https://e.printstacktrace.blog/tags/review/"/>
    
      <category term="reading" scheme="https://e.printstacktrace.blog/tags/reading/"/>
    
      <category term="affiliate" scheme="https://e.printstacktrace.blog/tags/affiliate/"/>
    
      <category term="pragmatic" scheme="https://e.printstacktrace.blog/tags/pragmatic/"/>
    
      <category term="mind-mapping" scheme="https://e.printstacktrace.blog/tags/mind-mapping/"/>
    
      <category term="brain" scheme="https://e.printstacktrace.blog/tags/brain/"/>
    
  </entry>
  
  <entry>
    <title>Installing GraalVM EE 1.0.0-RC14 with SDKMAN!</title>
    <link href="https://e.printstacktrace.blog/installing-graalvm-ee-1-0-0-rc14-with-sdkman/"/>
    <id>https://e.printstacktrace.blog/installing-graalvm-ee-1-0-0-rc14-with-sdkman/</id>
    <published>2019-03-20T09:15:56.000Z</published>
    <updated>2019-03-20T09:15:56.000Z</updated>
    
    <content type="html"><![CDATA[<div class="paragraph"><p>I love <a href="https://sdkman.io/" target="_blank" rel="noopener"><strong><em>SDKMAN!</em></strong></a>. It made using multiple different Java distributions in a single operating system much more comfortable. You can install Java across different versions (from 6 to 13.EA) and different vendors (OpenJDK, Oracle, Zulu, Corretto or GraalVM CE to name a few). Switching between those versions is as simple as executing a single <code>sdk use java {version}</code> command and you are ready to use whatever Java you want. However, not all Java versions are available by default, but luckily, <em>SDKMAN!</em> has a simple solution to this problem.</p></div><a id="more"></a><div class="sect1"><h2 id="installing-graalvm-ee-1-0-0-rc14">Installing GraalVM EE 1.0.0-RC14</h2><div class="sectionbody"><div class="paragraph"><p>I run some experiments with <a href="https://www.graalvm.org/" target="_blank" rel="noopener">GraalVM</a> and the only version I can install directly with <em>SDKMAN!</em> is GraalVM Community Edition. However, there is also GraalVM Enterprise Edition which provides some additional features, like improved performance. The main reason GraalVM EE is not available in <em>SDKMAN!</em> is that it is distributed over OTN (Oracle Technology Network) only, so you need to accept OTN license agreement<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> and log in to start the file download. OK, so I downloaded <strong>graalvm-ee-1.0.0-rc14-linux-amd64.tar.gz</strong> file successfully. What&#8217;s next?</p></div><div class="paragraph"><p>Let&#8217;s start with the extracting files from the downloaded archive.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ tar -xvf graalvm-ee-1.0.0-rc14-linux-amd64.tar.gz</code></pre></div></div><div class="paragraph"><p>After extracting all files, we can install local Java distribution with the following command.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ sdk install java graal-ee-rc14 /path/to/graalvm-ee-1.0.0-rc14</code></pre></div></div><div class="paragraph"><p>In the above example, <strong>graal-ee-rc14</strong> is a version used by <em>SDKMAN!</em> we want to associate with the Java installation located in <strong>/path/to/graalvm-ee-1.0.0-rc14</strong>.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content"><em>SDKMAN!</em> limits version to 15 characters.</td></tr></table></div><div class="paragraph"><p>When you execute <code>sdk list java</code> command, you will see local GraalVM EE added to SDKMAN&#8217;s Java distributions list.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ sdk list java================================================================================Available Java Versions================================================================================   + graal-ee-rc14     * 8.0.202-amzn     13.ea.11-open       8.0.202.j9-adpt     12.0.0-open         8.0.202.hs-adpt     11.0.2-sapmchn      8.0.202-zulufx     11.0.2-zulu     &gt; * 8.0.201-oracle   * 11.0.2-open         7.0.211-zulu     11.0.2-amzn         6.0.119-zulu     11.0.2.j9-adpt    * 1.0.0-rc-14-grl     11.0.2.hs-adpt    * 1.0.0-rc-13-grl     11.0.2-zulufx       1.0.0-rc-12-grl     10.0.2-zulu         1.0.0-rc-11-grl     10.0.2-open         1.0.0-rc-10-grl     9.0.7-zulu          1.0.0-rc-9-grl     9.0.4-open          1.0.0-rc-8-grl   * 8.0.202-zulu================================================================================+ - local version* - installed&gt; - currently in use================================================================================</code></pre></div></div><div class="paragraph"><p>The last thing to do to use GraalVM EE is to switch to a proper Java version, and you are ready to go.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ sdk use java graal-ee-rc14Using java version graal-ee-rc14 in this shell.$ java -versionjava version "1.8.0_202"Java(TM) SE Runtime Environment (build 1.8.0_202-b08)Java HotSpot(TM) GraalVM EE 1.0.0-rc14 (build 25.202-b08-jvmci-0.56, mixed mode)</code></pre></div></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">If you don&#8217;t know where to keep extracted GraalVM EE sources, there is one workaround that allows keeping all Java distributions together. Instead of extracting <em>graalvm-ee-1.0.0-rc14-linux-amd64.tar.gz</em> at some random location, extract it directly to <code>~/.sdkman/candidates/java/graal-ee-rc14</code> directory. After doing so, you don&#8217;t have to execute <code>sdk install java &#8230;&#8203;</code> command, because your GraalVM EE is already available on <code>sdk list java</code> distributions list.</td></tr></table></div><script id="asciicast-235036" src="https://asciinema.org/a/235036.js" async></script></div></div><div class="sect1"><h2 id="conclusion">Conclusion</h2><div class="sectionbody"><div class="paragraph"><p>I hope you have learned something useful from this short blog post. <em>SDKMAN!</em> is a powerful tool that makes developer&#8217;s life easier. I use it to manage in a convenient way all my Java, Groovy, or Gradle installations. If you haven&#8217;t used it so far, I strongly recommend giving <em>SDKMAN!</em> a chance.</p></div></div></div><div id="footnotes"><hr><div class="footnote" id="_footnotedef_1"><a href="#_footnoteref_1">1</a>. <a href="https://www.oracle.com/technetwork/licenses/early-adopter-license-2299792.html" target="_blank" rel="noopener" class="bare">https://www.oracle.com/technetwork/licenses/early-adopter-license-2299792.html</a></div></div>]]></content>
    
    <summary type="html">
    
      &lt;div class=&quot;paragraph&quot;&gt;&lt;p&gt;I love &lt;a href=&quot;https://sdkman.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;strong&gt;&lt;em&gt;SDKMAN!&lt;/em&gt;&lt;/strong&gt;&lt;/a&gt;. It made using multiple different Java distributions in a single operating system much more comfortable. You can install Java across different versions (from 6 to 13.EA) and different vendors (OpenJDK, Oracle, Zulu, Corretto or GraalVM CE to name a few). Switching between those versions is as simple as executing a single &lt;code&gt;sdk use java {version}&lt;/code&gt; command and you are ready to use whatever Java you want. However, not all Java versions are available by default, but luckily, &lt;em&gt;SDKMAN!&lt;/em&gt; has a simple solution to this problem.&lt;/p&gt;&lt;/div&gt;
    
    </summary>
    
    
      <category term="How to" scheme="https://e.printstacktrace.blog/categories/how-to/"/>
    
    
      <category term="java" scheme="https://e.printstacktrace.blog/tags/java/"/>
    
      <category term="graalvm" scheme="https://e.printstacktrace.blog/tags/graalvm/"/>
    
      <category term="graalvm-ee" scheme="https://e.printstacktrace.blog/tags/graalvm-ee/"/>
    
      <category term="sdkman" scheme="https://e.printstacktrace.blog/tags/sdkman/"/>
    
  </entry>
  
</feed>
